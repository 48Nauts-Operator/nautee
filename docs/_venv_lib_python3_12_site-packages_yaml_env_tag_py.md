<!-- Auto-generated by Claude on 2025-05-31 20:18 -->

# YAML Environment Variable Tag

A custom YAML tag implementation that enables referencing environment variables directly within YAML files.

## Overview

This module provides functionality to use a custom `!ENV` tag in YAML files to dynamically resolve environment variables during YAML parsing. It supports both single environment variable references and fallback chains with default values.

**Version:** 1.1

## Features

- Reference environment variables in YAML files using the `!ENV` tag
- Support for fallback chains (multiple environment variables)
- Default value support when environment variables are not found
- Automatic type resolution using YAML's implicit type system
- Integration with PyYAML's loader system

## Functions

### `construct_env_tag(loader, node)`

The core constructor function that resolves environment variable references.

```python
def construct_env_tag(loader: yaml.Loader, node: yaml.Node) -> Any:
```

**Parameters:**
- `loader` (`yaml.Loader`): The YAML loader instance
- `node` (`yaml.Node`): The YAML node containing the environment variable reference

**Returns:**
- `Any`: The resolved environment variable value, automatically converted to appropriate Python type, or the default value if specified

**Behavior:**
- **Scalar nodes**: Single environment variable reference
  ```yaml
  database_url: !ENV DATABASE_URL
  ```
- **Sequence nodes**: Environment variable chain with optional default
  ```yaml
  port: !ENV [PORT, DEFAULT_PORT, 8080]
  ```
- **Error handling**: Raises `ConstructorError` for unsupported node types

**Processing Logic:**
1. Parses the node to extract environment variable names
2. Extracts default value (if provided as last item in sequence)
3. Iterates through environment variables until one is found
4. Applies YAML's implicit type resolution to the found value
5. Returns the resolved value or default if no variables are set

### `add_env_tag(loader)`

Registers the `!ENV` tag constructor with a YAML loader.

```python
def add_env_tag(loader: yaml.Loader) -> yaml.Loader:
```

**Parameters:**
- `loader` (`yaml.Loader`): The YAML loader to modify

**Returns:**
- `yaml.Loader`: The modified loader with `!ENV` tag support

## Usage Examples

### Basic Environment Variable Reference

```yaml
# YAML file
database:
  host: !ENV DB_HOST
  port: !ENV DB_PORT
  name: !ENV DB_NAME
```

### With Default Values

```yaml
# YAML file with fallbacks
server:
  port: !ENV [PORT, SERVER_PORT, 3000]
  debug: !ENV [DEBUG_MODE, false]
```

### Python Implementation

```python
import yaml
from your_module import add_env_tag

# Create loader with ENV tag support
loader = add_env_tag(yaml.SafeLoader)

# Load YAML with environment variable resolution
with open('config.yaml', 'r') as file:
    config = yaml.load(file, Loader=loader)
```

## Type Resolution

The module automatically converts environment variable string values to appropriate Python types using YAML's implicit type resolution:

- `"true"` / `"false"` → `bool`
- `"123"` → `int`
- `"3.14"` → `float`
- `"null"` → `None`
- Other values remain as `str`

## Dependencies

- `os`: For environment variable access
- `yaml`: PyYAML library for YAML processing
- `typing`: Type hints support