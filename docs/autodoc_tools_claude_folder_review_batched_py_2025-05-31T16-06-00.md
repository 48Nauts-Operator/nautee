<!--
This documentation was auto-generated by Claude on 2025-05-31T16-06-00.
Source file: ./tools/claude_folder_review_batched.py
-->

# Code Review Script Documentation

## Overview

This script provides automated code review functionality using Anthropic's Claude AI model. It analyzes source code files within a specified directory, organizes them into batches to respect API token limits, and generates comprehensive review reports in Markdown format.

**Author:** André Wolke  
**Version:** 1.0.0  
**Date:** 2025-05-31

## Features

- **Multi-language Support**: Reviews Python, JavaScript, TypeScript, HTML, CSS, JSON, Go, Java, and YAML files
- **Intelligent Batching**: Automatically groups files to stay within Claude's token limits (~10k tokens per batch)
- **Test File Exclusion**: Automatically excludes test files from review
- **Structured Output**: Generates organized Markdown reports for each batch
- **Progress Tracking**: Provides real-time feedback on processing status

## Prerequisites

### Required Dependencies

```bash
pip install anthropic python-dotenv
```

### Environment Setup

Create a `.env` file in the script directory with the following variables:

```env
ANTHROPIC_API_KEY=your_anthropic_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, defaults to this model
```

## Usage

### Basic Usage

```bash
python code_review_script.py [folder_path]
```

### Examples

```bash
# Review the default folder (../137docs)
python code_review_script.py

# Review a specific project folder
python code_review_script.py /path/to/your/project

# Review current directory
python code_review_script.py .
```

## Configuration

### Supported File Types

The script currently processes files with the following extensions:

- **Python**: `.py`
- **JavaScript/TypeScript**: `.js`, `.ts`, `.tsx`, `.jsx`
- **Web**: `.html`, `.css`
- **Data**: `.json`, `.yaml`, `.yml`
- **Other Languages**: `.go`, `.java`

### File Exclusion Rules

Files are automatically excluded if they:
- Contain "test" in the filename (case-insensitive)
- Start with "test_"
- Are located in directories containing "test"

### Token Limits

- **Batch Size**: Maximum 10,000 tokens per batch
- **Response Limit**: 2,000 tokens per Claude response
- **Token Estimation**: Approximately 4 characters per token

## Output

### Directory Structure

```
output/
└── folder_review/
    ├── batch_01_2025-05-31T14-30-45.md
    ├── batch_02_2025-05-31T14-31-12.md
    └── ...
```

### Review Content

Each generated report includes analysis of:

- **Code Organization**: Structure and file organization patterns
- **Bug Patterns**: Potential issues and anti-patterns
- **Architecture Weaknesses**: Design flaws and improvement areas
- **Modularization Suggestions**: Recommendations for better code organization

## Error Handling

The script includes comprehensive error handling for:

- **File Access Errors**: Skips unreadable files with error logging
- **API Errors**: Continues processing remaining batches if one fails
- **Empty Directories**: Exits gracefully with informative message
- **Missing Dependencies**: Clear error messages for setup issues

## Performance Considerations

- **Processing Time**: Varies based on file count and API response times
- **Rate Limiting**: Respects Anthropic's API rate limits
- **Memory Usage**: Processes files in batches to minimize memory footprint

## Customization Options

### Adding File Types

Modify the `valid_exts` tuple to include additional file extensions:

```python
valid_exts = (".py", ".js", ".ts", ".your_extension")
```

### Adjusting Token Limits

Modify the `MAX_TOKENS` constant to change batch sizes:

```python
MAX_TOKENS = 15000  # Increase for larger batches
```

### Custom Exclusion Rules

Modify the `is_excluded()` function to implement custom filtering logic:

```python
def is_excluded(filename):
    # Add your custom exclusion logic here
    return filename.endswith('.exclude')
```

## Troubleshooting

### Common Issues

1. **"No valid files found"**
   - Verify the target directory contains supported file types
   - Check file permissions

2. **API Authentication Errors**
   - Verify `ANTHROPIC_API_KEY` in `.env` file
   - Ensure API key has sufficient credits

3. **Token Limit Exceeded**
   - Reduce `MAX_TOKENS` value
   - Split large files manually

### Debug Mode

Add debug output by modifying the script to include:

```python
print(f"Debug: Processing {file_path}, estimated tokens: {est}")
```

## License and Support

This script is provided as-is. For issues or feature requests, contact the author or submit issues through your project's issue tracking system.