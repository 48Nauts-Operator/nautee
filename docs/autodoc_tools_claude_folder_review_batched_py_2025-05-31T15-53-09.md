<!--
This documentation was auto-generated by Claude on 2025-05-31T15-53-09.
Source file: ./tools/claude_folder_review_batched.py
-->

# Code Review Tool with Claude AI

A Python script that automatically reviews code folders using Anthropic's Claude AI, designed to analyze codebases in batches while respecting token limits.

## Overview

This tool discovers source files in a specified directory, organizes them into token-limited batches, and uses Claude AI to provide comprehensive code reviews focusing on architecture, organization, and potential improvements.

**Author:** Andr√© Wolke  
**Version:** 1.0.0  
**Date:** 2025-05-31

## Features

- **Automated File Discovery**: Recursively scans directories for supported file types
- **Intelligent Batching**: Groups files to stay within Claude's token limits (~10k tokens per batch)
- **Test File Exclusion**: Automatically excludes test files from review
- **Multi-language Support**: Supports Python, JavaScript, TypeScript, HTML, CSS, JSON, Go, Java, and YAML files
- **Markdown Output**: Generates structured review reports in Markdown format
- **Progress Tracking**: Provides real-time feedback on processing status

## Prerequisites

- Python 3.6+
- Anthropic API key
- Required Python packages:
  - `anthropic`
  - `python-dotenv`

## Installation

1. Install required dependencies:
```bash
pip install anthropic python-dotenv
```

2. Create a `.env` file in the script directory:
```env
ANTHROPIC_API_KEY=your_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, defaults to this model
```

## Usage

### Basic Usage

Review the default folder (`../137docs`):
```bash
python code_review.py
```

### Custom Folder

Review a specific folder:
```bash
python code_review.py /path/to/your/code/folder
```

## Configuration

### Supported File Types

The script currently supports the following file extensions:

| Language | Extensions |
|----------|------------|
| Python | `.py` |
| JavaScript | `.js`, `.jsx` |
| TypeScript | `.ts`, `.tsx` |
| Web | `.html`, `.css` |
| Data | `.json`, `.yaml`, `.yml` |
| Go | `.go` |
| Java | `.java` |

### File Exclusions

Files are automatically excluded if they:
- Contain "test" in the filename (case-insensitive)
- Start with "test_"
- Are located in directories containing "test"

### Token Management

- **Batch Size**: Maximum ~10,000 tokens per batch
- **Token Estimation**: Approximately 4 characters per token
- **Max Response**: 2,000 tokens per Claude response

## Output

### Directory Structure

Reviews are saved to:
```
output/folder_review/
‚îú‚îÄ‚îÄ batch_01_2025-05-31T14-30-45.md
‚îú‚îÄ‚îÄ batch_02_2025-05-31T14-31-12.md
‚îî‚îÄ‚îÄ ...
```

### Review Content

Each batch review includes analysis of:

- **Code Organization**: Structure and maintainability assessment
- **Bug Patterns**: Potential issues and anti-patterns
- **Architecture Weaknesses**: Design flaws and improvement opportunities
- **Modularization Suggestions**: Recommendations for better code organization

## Example Output

```bash
üîç Found 25 valid source files in: /path/to/project

üì¶ Processing batch 1 of 3...
‚úÖ Batch 1 saved to output/folder_review/batch_01_2025-05-31T14-30-45.md

üì¶ Processing batch 2 of 3...
‚úÖ Batch 2 saved to output/folder_review/batch_02_2025-05-31T14-31-12.md

üì¶ Processing batch 3 of 3...
‚úÖ Batch 3 saved to output/folder_review/batch_03_2025-05-31T14-31-38.md

üéâ All batches complete in 02:15
```

## Error Handling

The script handles several error conditions:

- **No Valid Files**: Exits with error code 1 if no reviewable files are found
- **File Read Errors**: Skips unreadable files and continues processing
- **API Errors**: Reports Claude API failures while continuing with remaining batches
- **Missing Environment**: Requires `ANTHROPIC_API_KEY` in environment variables

## Limitations

- **Token Limits**: Large files may need to be split manually if they exceed batch limits
- **API Rate Limits**: Subject to Anthropic's API rate limiting
- **Language Support**: Limited to predefined file extensions
- **Binary Files**: Cannot process binary or compiled files

## Customization

### Adding File Types

Modify the `valid_exts` tuple to include additional file extensions:

```python
valid_exts = (".py", ".js", ".ts", ".tsx", ".jsx", ".html", ".css", ".json", ".go", ".java", ".yaml", ".yml", ".rb", ".php")
```

### Adjusting Token Limits

Modify the `MAX_TOKENS` constant to change batch sizes:

```python
MAX_TOKENS = 15000  # Increase batch size
```

### Custom Exclusion Rules

Modify the `is_excluded()` function to change file filtering logic:

```python
def is_excluded(filename):
    lower = filename.lower()
    return ("test" in lower or 
            lower.startswith("test_") or 
            "node_modules" in lower or
            ".git" in lower)
```

## Troubleshooting

### Common Issues

1. **"No valid files found"**: Check that the target directory contains supported file types
2. **API Key Error**: Ensure `ANTHROPIC_API_KEY` is set in your `.env` file
3. **Permission Errors**: Verify read access to target directory and write access to output directory

### Debug Information

The script provides verbose output including:
- File discovery results
- Batch processing progress
- Error messages for failed operations
- Total processing time