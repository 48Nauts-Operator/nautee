<!--
This documentation was auto-generated by Claude on 2025-05-31T16-13-29.
Source file: ./tools/claude_folder_review_batched.py
-->

# Code Review Tool Documentation

## Overview

A Python script that automatically reviews code folders using Claude AI. The tool intelligently batches files to stay within token limits and generates comprehensive code review reports in Markdown format.

**Author:** Andr√© Wolke  
**Version:** 1.0.0  
**Date:** 2025-05-31

## Features

- üîç **Multi-language Support**: Reviews Python, JavaScript, TypeScript, HTML, CSS, JSON, Go, Java, and YAML files
- üì¶ **Intelligent Batching**: Automatically groups files to respect API token limits (~10k tokens per batch)
- üö´ **Smart Filtering**: Excludes test files and unsupported file types
- üìù **Structured Output**: Generates professional Markdown reports with timestamps
- ‚ö° **Progress Tracking**: Real-time batch processing status and timing information

## Prerequisites

### Dependencies

```bash
pip install anthropic python-dotenv
```

### Environment Variables

Create a `.env` file in the project root:

```env
ANTHROPIC_API_KEY=your_claude_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, defaults to claude-sonnet-4-20250514
```

## Usage

### Basic Usage

```bash
python code_review.py [target_folder]
```

### Examples

```bash
# Review the default folder (../137docs)
python code_review.py

# Review a specific project folder
python code_review.py /path/to/my/project

# Review current directory
python code_review.py .
```

## Configuration

### Supported File Types

The script currently processes files with the following extensions:

- **Python**: `.py`
- **JavaScript/TypeScript**: `.js`, `.ts`, `.tsx`, `.jsx`
- **Web**: `.html`, `.css`
- **Data**: `.json`, `.yaml`, `.yml`
- **Other Languages**: `.go`, `.java`

### File Exclusions

Files are automatically excluded if they:
- Contain "test" in the filename (case-insensitive)
- Start with "test_"
- Are located in a "test" directory

### Token Limits

- **Maximum tokens per batch**: 10,000
- **Estimated tokens calculation**: `text_length / 4`
- **Output token limit**: 2,000 per response

## Output Structure

### Directory Structure

```
output/
‚îî‚îÄ‚îÄ folder_review/
    ‚îú‚îÄ‚îÄ batch_01_2025-05-31T14-30-25.md
    ‚îú‚îÄ‚îÄ batch_02_2025-05-31T14-30-45.md
    ‚îî‚îÄ‚îÄ ...
```

### Report Content

Each batch report includes:

- **Code Organization** analysis
- **Bug Pattern** identification  
- **Architecture Weakness** assessment
- **Modularization Suggestions**
- **Clarity Improvements**

## API Reference

### Core Functions

#### `is_excluded(filename: str) -> bool`

Determines if a file should be excluded from review.

**Parameters:**
- `filename` (str): Full file path to evaluate

**Returns:**
- `bool`: True if file should be excluded

**Example:**
```python
is_excluded("/src/test_utils.py")  # Returns True
is_excluded("/src/main.py")       # Returns False
```

#### `estimate_tokens(text: str) -> int`

Estimates token count for API usage planning.

**Parameters:**
- `text` (str): Text content to estimate

**Returns:**
- `int`: Estimated token count

**Formula:**
```python
tokens = len(text) / 4
```

### Configuration Variables

| Variable | Default | Description |
|----------|---------|-------------|
| `valid_exts` | Multiple extensions | Tuple of supported file extensions |
| `MAX_TOKENS` | 10000 | Maximum tokens per API call |
| `output_root` | "output/folder_review" | Base output directory |

## Error Handling

### Common Error Scenarios

1. **No Valid Files Found**
   ```
   ‚ùå No valid files found in /target/folder
   ```
   - **Cause**: No files match the supported extensions or all files are excluded
   - **Solution**: Check file types and exclusion rules

2. **File Read Errors**
   ```
   [ERR] ‚ùå Error reading /path/file.py: [Errno 2] No such file or directory
   ```
   - **Cause**: File permissions or file system issues
   - **Solution**: Verify file permissions and path accessibility

3. **Claude API Errors**
   ```
   ‚ùå Claude API error in batch 1: Invalid API key
   ```
   - **Cause**: Authentication or API issues
   - **Solution**: Verify ANTHROPIC_API_KEY in `.env` file

### Exit Codes

- `0`: Successful completion
- `1`: No valid files found

## Performance Considerations

### Processing Time

- **Small projects** (< 50 files): Usually < 2 minutes
- **Medium projects** (50-200 files): 2-10 minutes  
- **Large projects** (200+ files): 10+ minutes

### API Rate Limits

The script processes batches sequentially to respect Claude's rate limits. No built-in delays are implemented, but the natural processing time typically prevents rate limit issues.

### Token Usage Optimization

- Files are batched efficiently to maximize token usage per API call
- Only source code files are processed (documentation and assets excluded)
- Test files are automatically excluded to focus on production code

## Troubleshooting

### Issue: Empty Output Files

**Symptoms**: Generated `.md` files are empty or contain only headers

**Solutions:**
1. Verify your Claude API key has sufficient credits
2. Check if the model name in `.env` is correct
3. Ensure files contain valid, readable code

### Issue: "No valid files found"

**Symptoms**: Script exits immediately with no files processed

**Solutions:**
1. Verify the target folder path is correct
2. Check if files have supported extensions
3. Ensure files aren't being excluded by the test filter

### Issue: API Rate Limiting

**Symptoms**: Frequent API errors or timeouts

**Solutions:**
1. Add delays between batches:
   ```python
   time.sleep(1)  #