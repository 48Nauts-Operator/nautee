<!--
This documentation was auto-generated by Claude on 2025-05-31T15-52-15.
Source file: ./tools/claude_review.py
-->

# Code Review Tool Documentation

## Overview

A Python script that provides automated code review functionality using Claude AI. The tool supports reviewing individual files or Git diffs, generating structured feedback in Markdown format.

## Features

- **Dual Mode Operation**: Review specific files or Git diffs automatically
- **AI-Powered Analysis**: Leverages Claude AI for comprehensive code review
- **Markdown Output**: Generates professional, formatted review reports
- **Git Integration**: Smart Git diff detection with fallback options
- **Error Handling**: Robust error handling with graceful degradation

## Prerequisites

### Dependencies

```bash
pip install anthropic python-dotenv
```

### Environment Variables

Create a `.env` file in the project root:

```env
ANTHROPIC_API_KEY=your_claude_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, defaults to this model
```

### System Requirements

- Python 3.6+
- Git (for diff mode)
- Valid Anthropic API key

## Usage

### Mode 1: File Review

Review one or more specific files:

```bash
python review_tool.py file1.py file2.py
```

**Example:**
```bash
python review_tool.py src/main.py utils/helpers.py
```

### Mode 2: Git Diff Review

Review changes in Git repository (no arguments):

```bash
python review_tool.py
```

The tool automatically attempts the following Git commands in order:
1. `git diff origin/main...HEAD` (compare with origin/main)
2. `git diff HEAD^` (compare with previous commit)

## Output

### File Structure

All reviews are saved to the `output/` directory with timestamped filenames:

```
output/
‚îú‚îÄ‚îÄ claude_review_main_py_2025-05-31T14-30-15.md
‚îú‚îÄ‚îÄ claude_review_git_diff_origin_main_2025-05-31T14-45-22.md
‚îî‚îÄ‚îÄ claude_review_nodiff_2025-05-31T15-00-33.md
```

### Review Content

Each review includes analysis of:

- **Bugs or Logic Issues**: Potential runtime errors or logical flaws
- **Code Clarity**: Readability and maintainability concerns  
- **Suggested Improvements**: Optimization and enhancement recommendations
- **Style Consistency**: Code formatting and convention adherence

## Configuration

### Model Selection

Override the default Claude model via environment variable:

```env
ANTHROPIC_MODEL=claude-3-opus-20240229
```

### API Limits

The tool is configured with:
- **Max Tokens**: 1500 (suitable for comprehensive reviews)
- **Model**: Claude Sonnet 4 (default)

## Error Handling

| Scenario | Behavior |
|----------|----------|
| Missing file | Skips file with warning, continues processing |
| No Git history | Creates stub review file, exits gracefully |
| API failure | Displays error message, exits with code 1 |
| Missing API key | Anthropic client initialization fails |

## Examples

### Successful File Review
```bash
$ python review_tool.py app.py
‚úÖ Markdown review saved to output/claude_review_app_py_2025-05-31T14-30-15.md
```

### Git Diff Review
```bash
$ python review_tool.py
üì¶ Trying `git diff origin/main...HEAD`...
‚úÖ Markdown review saved to output/claude_review_git_diff_origin_main_2025-05-31T14-45-22.md
```

### No Changes Available
```bash
$ python review_tool.py
üì¶ Trying `git diff origin/main...HEAD`...
‚ö†Ô∏è `origin/main` not found. Trying HEAD^...
‚ùå Git diff failed. No usable revision history.
üìù Stub review saved to output/claude_review_nodiff_2025-05-31T15-00-33.md
```

## Integration

### CI/CD Pipeline

The tool is designed for CI/CD integration:

- Exits gracefully when no diff is available
- Creates output files for artifact collection
- Uses appropriate exit codes for pipeline control

### Git Hooks

Can be integrated as a pre-commit or pre-push hook for automated code review.

## Troubleshooting

### Common Issues

**API Key Error**
```bash
‚ùå Claude API error: Authentication failed
```
*Solution*: Verify `ANTHROPIC_API_KEY` in `.env` file

**Git Command Failed**
```bash
‚ùå Git diff failed. No usable revision history.
```
*Solution*: Ensure you're in a Git repository with commit history

**File Not Found**
```bash
‚ö†Ô∏è Skipping missing file: nonexistent.py
```
*Solution*: Verify file paths are correct and files exist

### Debug Tips

1. Check environment variables: `echo $ANTHROPIC_API_KEY`
2. Verify Git status: `git status`
3. Test Git diff manually: `git diff origin/main...HEAD`
4. Confirm file permissions and paths

## Version Information

- **Version**: 1.0.0
- **Author**: Andr√© Wolke  
- **Date**: 2025-05-31
- **License**: Not specified