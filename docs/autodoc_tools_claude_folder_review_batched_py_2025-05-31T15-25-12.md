<!--
This documentation was auto-generated by Claude on 2025-05-31T15-25-12.
Source file: ./tools/claude_folder_review_batched.py
-->

# Code Review Script Documentation

## Overview

A Python script that automatically reviews code folders using Anthropic's Claude AI model. The script processes source code files in batches to stay within token limits and generates detailed code review reports in Markdown format.

**Author:** André Wolke  
**Version:** 1.0.0  
**Date:** 2025-05-31

## Features

- **Batch Processing**: Automatically splits large codebases into manageable batches (~10k token limit)
- **Multi-language Support**: Reviews Python, JavaScript, TypeScript, HTML, CSS, JSON, Go, Java, and YAML files
- **Smart Filtering**: Excludes test files and directories automatically
- **Structured Output**: Generates timestamped Markdown reports for each batch
- **Progress Tracking**: Real-time feedback on processing status

## Prerequisites

- Python 3.6+
- Anthropic API key
- Required Python packages:
  - `anthropic`
  - `python-dotenv`

## Installation

1. Install required dependencies:
```bash
pip install anthropic python-dotenv
```

2. Set up environment variables in a `.env` file:
```env
ANTHROPIC_API_KEY=your_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, defaults to this model
```

## Usage

### Basic Usage
```bash
python code_review_script.py [folder_path]
```

### Examples
```bash
# Review current directory's parent folder
python code_review_script.py

# Review specific folder
python code_review_script.py /path/to/your/project

# Review relative path
python code_review_script.py ../my-project
```

## Configuration

### Supported File Types
The script processes files with the following extensions:
- `.py` (Python)
- `.js`, `.jsx` (JavaScript)
- `.ts`, `.tsx` (TypeScript)
- `.html` (HTML)
- `.css` (CSS)
- `.json` (JSON)
- `.go` (Go)
- `.java` (Java)
- `.yaml`, `.yml` (YAML)

### File Exclusions
Automatically excludes files and directories containing:
- "test" in filename (case-insensitive)
- Files starting with "test_"
- Files in directories named "test"

### Token Limits
- **Maximum tokens per batch**: 10,000
- **Token estimation**: Approximately 4 characters per token
- **Output tokens per batch**: Limited to 2,000

## Output

### Directory Structure
```
output/
└── folder_review/
    ├── batch_01_2025-05-31T14-30-45.md
    ├── batch_02_2025-05-31T14-31-20.md
    └── ...
```

### Review Content
Each batch report includes:
- **Code Organization**: Analysis of file structure and organization
- **Bug Patterns**: Identification of potential issues and anti-patterns
- **Architecture Weaknesses**: Structural problems and design concerns
- **Suggestions**: Recommendations for modularization and clarity improvements

## Error Handling

The script includes robust error handling for:
- **File Reading Errors**: Logs errors when files cannot be read
- **API Errors**: Catches and reports Claude API failures
- **Missing Files**: Exits gracefully when no valid files are found

### Common Error Messages
- `❌ No valid files found in {folder}`: No processable files in the specified directory
- `[ERR] ❌ Error reading {file_path}`: File access or encoding issues
- `❌ Claude API error in batch {i}`: API communication problems

## Performance

- **Processing Time**: Displayed upon completion in MM:SS format
- **Batch Size**: Dynamically calculated based on token estimation
- **File Discovery**: Recursive directory traversal with filtering

## Environment Variables

| Variable | Description | Default | Required |
|----------|-------------|---------|----------|
| `ANTHROPIC_API_KEY` | Your Anthropic API key | None | Yes |
| `ANTHROPIC_MODEL` | Claude model to use | `claude-sonnet-4-20250514` | No |

## Limitations

- Token estimation is approximate (4 characters per token)
- Large files may be split across batches
- API rate limits may affect processing speed
- Binary files are not processed

## Troubleshooting

### Common Issues

1. **No API Key**: Ensure `ANTHROPIC_API_KEY` is set in your `.env` file
2. **No Files Found**: Check file extensions and exclusion rules
3. **Permission Errors**: Ensure read access to the target directory
4. **API Quota**: Verify your Anthropic API usage limits

### Debug Steps

1. Verify environment setup:
```bash
python -c "from dotenv import load_dotenv; import os; load_dotenv(); print(os.getenv('ANTHROPIC_API_KEY'))"
```

2. Check file discovery:
```bash
ls -la [target_folder]
```

3. Validate file extensions against supported types

## License

This script is provided as-is for code review automation purposes.