<!--
This documentation was auto-generated by Claude on 2025-05-31T17-02-09.
Source file: ./tools/claude_review.py
-->

# Code Review Tool Documentation

## Overview

This Python script provides automated code review functionality using Anthropic's Claude AI model. It supports two primary modes of operation: reviewing individual files and analyzing Git diffs. The tool generates structured Markdown feedback focusing on code quality, bugs, and improvement suggestions.

## Features

- **Dual Operation Modes**: Review specific files or Git diffs
- **AI-Powered Analysis**: Uses Claude AI for intelligent code review
- **Markdown Output**: Generates structured, readable review reports
- **Error Handling**: Graceful fallback mechanisms for Git operations
- **Automatic Output Management**: Creates timestamped review files

## Prerequisites

### Dependencies

```bash
pip install anthropic python-dotenv
```

### Environment Configuration

Create a `.env` file in the project root:

```env
ANTHROPIC_API_KEY=your_claude_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, defaults to specified model
```

### System Requirements

- Python 3.6+
- Git (for diff mode)
- Valid Anthropic API key

## Usage

### Mode 1: File Review

Review one or more specific files:

```bash
python review_script.py file1.py file2.py
```

**Example:**
```bash
python review_script.py src/main.py utils/helpers.py
```

### Mode 2: Git Diff Review

Review changes in the repository:

```bash
python review_script.py
```

The script attempts Git diff operations in the following order:
1. `git diff origin/main...HEAD` (preferred)
2. `git diff HEAD^` (fallback)
3. Generate stub file if no diff available

## Operation Modes

### File Review Mode

**Triggered when:** Command-line arguments contain file paths

**Process:**
1. Validates file existence
2. Reads and combines file contents
3. Formats code with syntax highlighting
4. Sends to Claude for analysis

**Output filename format:** `claude_review_{filename1}_{filename2}_{timestamp}.md`

### Git Diff Mode

**Triggered when:** No command-line arguments provided

**Process:**
1. Attempts to generate Git diff
2. Uses fallback strategies if primary diff fails
3. Sends diff to Claude for review
4. Creates stub file if no diff available

**Output filename format:** `claude_review_git_diff_{source}_{timestamp}.md`

## Review Focus Areas

The AI reviewer analyzes code for:

- **Bugs and Logic Issues**: Potential runtime errors and logical flaws
- **Code Clarity**: Readability and maintainability concerns  
- **Improvement Suggestions**: Performance and structure recommendations
- **Style Consistency**: Code formatting and convention adherence

## Output Structure

### File Location
All reviews are saved to the `output/` directory (created automatically).

### Filename Convention
```
claude_review_{identifier}_{timestamp}.md
```

Where:
- `identifier`: Source description (filenames or git diff type)
- `timestamp`: ISO format timestamp (`YYYY-MM-DDTHH-MM-SS`)

### Content Format
Reviews are generated in Markdown format with structured sections for easy reading and integration with documentation systems.

## Error Handling

| Scenario | Behavior |
|----------|----------|
| Missing files | Skips file with warning message |
| No Git history | Creates stub review file |
| API failure | Exits with error code 1 |
| Missing API key | Anthropic client initialization fails |

## Configuration

### Model Selection
Default model: `claude-sonnet-4-20250514`

Override via environment variable:
```env
ANTHROPIC_MODEL=your_preferred_model
```

### Token Limits
- Maximum tokens per request: 1500
- Suitable for most code review scenarios
- Adjust in source code if needed for larger reviews

## Integration Examples

### CI/CD Pipeline
```yaml
- name: Code Review
  run: |
    python review_script.py
    cat output/claude_review_*.md >> $GITHUB_STEP_SUMMARY
```

### Pre-commit Hook
```bash
#!/bin/bash
python review_script.py $(git diff --cached --name-only --diff-filter=AM)
```

## Troubleshooting

### Common Issues

**"No diff available"**
- Ensure you're in a Git repository
- Check that commits exist for comparison
- Verify Git is properly initialized

**"Claude API error"**
- Verify API key is correctly set
- Check network connectivity
- Ensure sufficient API credits

**"Missing file" warnings**
- Verify file paths are correct
- Check file permissions
- Ensure files exist in the working directory

### Debug Steps

1. Verify environment variables: `echo $ANTHROPIC_API_KEY`
2. Test Git access: `git status`
3. Check file permissions: `ls -la {filename}`
4. Validate API connectivity with a simple test call

## Version Information

- **Version**: 1.0.0
- **Author**: Andr√© Wolke  
- **Date**: 2025-05-31
- **License**: Not specified