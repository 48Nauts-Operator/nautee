<!--
This documentation was auto-generated by Claude on 2025-05-31T16-05-12.
Source file: ./tools/claude_review.py
-->

# Code Review Script Documentation

## Overview

This Python script provides automated code review functionality using Anthropic's Claude AI. It supports two modes of operation: reviewing individual files or analyzing Git diffs. The script generates structured feedback in Markdown format and saves the results to an output directory.

## Features

- **Dual Mode Operation**: Review specific files or Git diffs
- **Claude AI Integration**: Leverages Anthropic's Claude for intelligent code analysis
- **Markdown Output**: Generates professional, formatted review reports
- **Git Integration**: Automatically detects and reviews code changes
- **Error Handling**: Graceful fallback mechanisms for various failure scenarios

## Requirements

### Dependencies

```
anthropic
python-dotenv
```

### Environment Variables

Create a `.env` file in the project root with the following variables:

```env
ANTHROPIC_API_KEY=your_anthropic_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, uses default if not specified
```

## Installation

1. Install required packages:
   ```bash
   pip install anthropic python-dotenv
   ```

2. Set up your environment variables in a `.env` file

3. Ensure the script has appropriate permissions to create directories and files

## Usage

### Mode 1: File Review

Review one or more specific files:

```bash
python review_script.py file1.py file2.py [additional_files...]
```

**Example:**
```bash
python review_script.py src/main.py tests/test_main.py
```

### Mode 2: Git Diff Review

Review changes in your Git repository:

```bash
python review_script.py
```

The script will attempt to review changes using the following Git diff strategies in order:
1. `git diff origin/main...HEAD` - Compare current branch with origin/main
2. `git diff HEAD^` - Compare with previous commit
3. Generate stub output if no diffs are available

## Output

All reviews are saved to the `output/` directory with timestamped filenames:

- **File reviews**: `claude_review_{filename1}_{filename2}_{timestamp}.md`
- **Git diff reviews**: `claude_review_git_diff_{strategy}_{timestamp}.md`
- **No diff available**: `claude_review_nodiff_{timestamp}.md`

## Review Focus Areas

The Claude AI reviewer analyzes code for:

- **Bugs and Logic Issues**: Identifies potential runtime errors and logical flaws
- **Code Clarity**: Evaluates readability and maintainability
- **Suggested Improvements**: Provides actionable recommendations
- **Style Consistency**: Checks adherence to coding standards

## Error Handling

| Scenario | Behavior |
|----------|----------|
| Missing file | Skips file with warning message |
| Git diff failure | Falls back to alternative diff strategy |
| No Git history | Creates stub review file |
| Claude API error | Exits with error code 1 |
| Missing API key | Runtime error from Anthropic client |

## File Structure

```
project/
├── review_script.py
├── .env
├── output/
│   ├── claude_review_main_py_2025-05-31T14-30-15.md
│   └── claude_review_git_diff_origin_main_2025-05-31T14-35-22.md
└── [your code files]
```

## Configuration

### Model Selection

The default model is `claude-sonnet-4-20250514`. To use a different model, set the `ANTHROPIC_MODEL` environment variable:

```env
ANTHROPIC_MODEL=claude-3-opus-20240229
```

### Token Limit

The script uses a maximum of 1500 tokens for responses. This can be modified by changing the `max_tokens` parameter in the API call.

## Troubleshooting

### Common Issues

1. **"No module named 'anthropic'"**
   - Install dependencies: `pip install anthropic python-dotenv`

2. **"API key not found"**
   - Verify `.env` file exists and contains `ANTHROPIC_API_KEY`
   - Ensure `.env` is in the same directory as the script

3. **"Git diff failed"**
   - Ensure you're in a Git repository
   - Check that you have commit history
   - Verify Git is installed and accessible

4. **"Permission denied" when creating output**
   - Ensure write permissions for the script directory
   - Check if `output/` directory can be created

### Debug Tips

- Check if environment variables are loaded: `print(os.getenv("ANTHROPIC_API_KEY"))`
- Verify Git repository status: `git status`
- Test API connectivity with a simple Claude API call

## Version Information

- **Author**: André Wolke
- **Version**: 1.0.0
- **Date**: 2025-05-31
- **License**: Not specified

## Contributing

When modifying this script, ensure:
- Error handling remains comprehensive
- Output format stays consistent
- Environment variable usage is documented
- Both review modes continue to function properly