<!-- Auto-generated by Claude on 2025-06-01 17:16 -->

# Claude Folder Review (Batched) Documentation

## Overview

This Python script provides automated code review functionality using Anthropic's Claude AI. It recursively scans a folder for source code files, organizes them into token-based batches, and generates detailed markdown reviews for each batch.

## Purpose

The script is designed to:
- **Automate code reviews** for entire codebases or folders
- **Handle large codebases** by splitting files into manageable ~10k token chunks
- **Generate structured documentation** in Markdown format
- **Provide insights** on code organization, bug patterns, and architectural improvements

## Key Features

- ğŸ” **Recursive file discovery** with smart filtering
- ğŸ“¦ **Intelligent batching** based on token limits
- ğŸ¤– **AI-powered reviews** using Claude
- ğŸ“ **Markdown output** with timestamps
- âš¡ **Progress tracking** and error handling

## Functions

### `is_excluded(filename: str) -> bool`

Filters out test files from the review process.

**Parameters:**
- `filename`: File path to check

**Returns:**
- `True` if file should be excluded (contains "test" patterns)
- `False` if file should be included

**Example:**
```python
is_excluded("test_utils.py")     # Returns True
is_excluded("main.py")           # Returns False
is_excluded("/tests/config.py")  # Returns True
```

### `estimate_tokens(text: str) -> int`

Provides a rough estimation of token count for API rate limiting.

**Parameters:**
- `text`: Source code content

**Returns:**
- Estimated token count (uses 4 characters â‰ˆ 1 token ratio)

### `main()`

The primary execution function that orchestrates the entire review process.

## Configuration

### Environment Variables

Create a `.env` file with:

```env
ANTHROPIC_API_KEY=your_claude_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, has default
```

### Supported File Types

The script processes these file extensions:
- **Python**: `.py`
- **JavaScript/TypeScript**: `.js`, `.ts`, `.tsx`, `.jsx`
- **Web**: `.html`, `.css`
- **Data**: `.json`, `.yaml`, `.yml`
- **Other**: `.go`, `.java`

## Usage

### Basic Usage

```bash
python claude_folder_review.py [folder_path]
```

### Examples

```bash
# Review current directory
python claude_folder_review.py

# Review specific folder
python claude_folder_review.py /path/to/project

# Review relative folder
python claude_folder_review.py ../my_project
```

## Output Structure

The script generates files in `docs/folder_review/`:

```
docs/folder_review/
â”œâ”€â”€ folder_review_batch_01.md
â”œâ”€â”€ folder_review_batch_02.md
â””â”€â”€ folder_review_batch_03.md
```

Each batch file contains:
- **Header** with batch number
- **Timestamp** of generation
- **AI-generated review** with insights and recommendations

## Workflow

1. **ğŸ”§ Setup**: Load environment variables and initialize Claude client
2. **ğŸ” Discovery**: Recursively find valid source files (excluding tests)
3. **ğŸ“¦ Batching**: Group files into ~10k token batches
4. **ğŸ¤– Review**: Send each batch to Claude for analysis
5. **ğŸ“ Output**: Save markdown reviews with timestamps

## Notes and Suggestions

### âš ï¸ Important Considerations

- **API Costs**: Each batch consumes Claude API tokens - monitor usage
- **Rate Limits**: The script doesn't implement rate limiting between requests
- **Token Estimation**: Uses simple 4:1 character-to-token ratio (may be inaccurate)

### ğŸš€ Potential Improvements

1. **Add rate limiting** between API calls:
   ```python
   time.sleep(1)  # Add after each API request
   ```

2. **Implement more accurate token counting**:
   ```python
   # Consider using tiktoken or similar library
   import tiktoken
   ```

3. **Add configuration file support**:
   ```python
   # Load settings from config.yaml
   ```

4. **Enhanced error recovery**:
   ```python
   # Retry failed batches with exponential backoff
   ```

### ğŸ”§ Customization Options

- Modify `valid_exts` tuple to support additional file types
- Adjust `MAX_TOKENS` for different batch sizes
- Customize the Claude prompt for specific review focus areas
- Change output directory structure in `output_root`

## Dependencies

```bash
pip install anthropic python-dotenv
```

## Error Handling

The script includes basic error handling for:
- Missing or invalid files
- Claude API failures
- File reading permissions
- Missing environment variables

Failed operations are logged with âŒ emoji indicators, while successful operations show âœ… confirmation.