<!-- Auto-generated by Claude on 2025-06-22 14:17 -->

# Claude Folder Review (Batched) Documentation

## Overview

This Python script provides an automated code review system that uses Anthropic's Claude AI to analyze source code files in batches. The script recursively scans a folder structure, processes valid source files, and generates comprehensive Markdown reviews using Claude's language model.

## Purpose

- **Automated Code Review**: Leverage AI to review large codebases systematically
- **Batch Processing**: Handle large projects by splitting files into manageable token chunks
- **Documentation Generation**: Create structured Markdown reports for each batch
- **Architecture Analysis**: Focus on code organization, bug patterns, and improvement suggestions

## Key Features

- Recursive folder scanning with file type filtering
- Token-based batching to stay within API limits
- Automatic exclusion of test files
- Structured Markdown output with timestamps
- Error handling and progress tracking

## Functions

### `is_excluded(filename: str) -> bool`

Determines whether a file should be excluded from review based on naming patterns.

**Parameters:**
- `filename` (str): The file path to check

**Returns:**
- `bool`: True if the file should be excluded (test files), False otherwise

**Exclusion Criteria:**
- Files containing "test" in the name
- Files starting with "test_"
- Files in test directories

### `estimate_tokens(text: str) -> int`

Provides a rough estimation of token count for API rate limiting.

**Parameters:**
- `text` (str): The source code content

**Returns:**
- `int`: Estimated token count (using 4 characters per token approximation)

### `main()`

The primary function that orchestrates the entire review process:

1. **Setup Phase**: Loads environment variables and initializes Claude client
2. **File Discovery**: Recursively finds valid source files
3. **Token Batching**: Groups files to stay under token limits
4. **Batch Processing**: Sends batches to Claude for review
5. **Output Generation**: Saves reviews as Markdown files

## Configuration

### Environment Variables

```bash
ANTHROPIC_API_KEY=your_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, has default
```

### Supported File Extensions

```python
valid_exts = (".py", ".js", ".ts", ".tsx", ".jsx", ".html", ".css", ".json", ".go", ".java", ".yaml", ".yml")
```

## Usage

### Command Line

```bash
# Review specific folder
python claude_folder_review.py /path/to/your/project

# Review default folder (../137docs)
python claude_folder_review.py
```

### Output Structure

```
docs/folder_review/
‚îú‚îÄ‚îÄ folder_review_batch_01.md
‚îú‚îÄ‚îÄ folder_review_batch_02.md
‚îî‚îÄ‚îÄ folder_review_batch_03.md
```

## Review Focus Areas

The generated reviews concentrate on:

- **Code Organization**: Structure and modularity assessment
- **Bug Patterns**: Identification of potential issues
- **Architecture Weaknesses**: Design flaws and anti-patterns
- **Improvement Suggestions**: Recommendations for refactoring and clarity

## Technical Specifications

| Parameter | Value | Purpose |
|-----------|-------|---------|
| Max Tokens per Batch | 10,000 | API limit management |
| Max Response Tokens | 2,000 | Review length control |
| Token Estimation Ratio | 4 chars/token | Approximation for batching |

## Notes and Suggestions

### ‚ö†Ô∏è Important Considerations

- **API Costs**: Each batch consumes Claude API tokens - monitor usage for large codebases
- **Rate Limits**: The script doesn't implement rate limiting - consider adding delays for very large projects
- **Token Estimation**: The 4-character-per-token ratio is approximate and may vary by content type

### üîß Potential Improvements

1. **Add Rate Limiting**: Implement delays between API calls
2. **Better Token Estimation**: Use actual tokenizer for more accurate counting
3. **Configurable Exclusions**: Allow custom file/folder exclusion patterns
4. **Progress Persistence**: Save progress to resume interrupted reviews
5. **Summary Generation**: Create an overall summary combining all batch reviews

### üí° Usage Tips

- Run on smaller folders first to gauge API usage
- Review the generated Markdown files in order for comprehensive insights
- Consider excluding vendor/third-party code directories
- Use version control to track review history over time

## Error Handling

The script includes error handling for:
- File reading errors (permissions, encoding issues)
- Claude API errors (network, authentication, rate limits)
- Missing environment variables
- Empty or invalid folder paths

Errors are logged to console with descriptive messages and don't halt the entire process.