<!-- Auto-generated by Claude on 2025-06-08 04:30 -->

# Claude Folder Review (Batched) Documentation

## Overview

This Python script provides an automated code review solution that recursively analyzes source code files in a directory using Anthropic's Claude AI model. The script intelligently batches files to stay within token limits and generates comprehensive Markdown documentation with code insights and suggestions.

## Purpose

- **Automated Code Review**: Leverages Claude AI to perform senior-level code reviews
- **Batch Processing**: Handles large codebases by splitting files into manageable chunks (~10k tokens each)
- **Documentation Generation**: Creates structured Markdown reports with actionable insights
- **Multi-language Support**: Reviews various file types including Python, JavaScript, TypeScript, Go, Java, and more

## Key Features

- âœ… Recursive directory traversal
- âœ… Intelligent file filtering and exclusion
- âœ… Token-based batching for API efficiency
- âœ… Comprehensive error handling
- âœ… Timestamped output documentation

## Dependencies

```python
import os
import sys
import anthropic
from dotenv import load_dotenv
from datetime import datetime
import time
```

### Required Packages
- `anthropic` - Claude AI API client
- `python-dotenv` - Environment variable management

## Configuration

### Environment Variables

Create a `.env` file with the following variables:

```bash
ANTHROPIC_API_KEY=your_claude_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, defaults to this model
```

### Supported File Extensions

The script processes files with these extensions:
- **Python**: `.py`
- **JavaScript/TypeScript**: `.js`, `.ts`, `.tsx`, `.jsx`
- **Web**: `.html`, `.css`
- **Data**: `.json`, `.yaml`, `.yml`
- **Other Languages**: `.go`, `.java`

## Important Functions

### `is_excluded(filename: str) -> bool`

Filters out test files and directories to focus on production code.

**Parameters:**
- `filename` (str): Full file path to evaluate

**Returns:**
- `bool`: True if file should be excluded

**Exclusion Criteria:**
- Files containing "test" in the name
- Files starting with "test_"
- Files in directories containing "test"

### `estimate_tokens(text: str) -> int`

Provides rough token estimation for batching decisions.

**Parameters:**
- `text` (str): Source code content

**Returns:**
- `int`: Estimated token count (using 4 characters â‰ˆ 1 token)

**Note:** This is a simplified estimation. For production use, consider using a proper tokenizer.

## Usage

### Basic Usage

```bash
python claude_folder_review.py /path/to/your/codebase
```

### Default Usage

```bash
python claude_folder_review.py
# Uses default folder: "../137docs"
```

## Output Structure

The script generates batch review files in the following structure:

```
docs/folder_review/
â”œâ”€â”€ folder_review_batch_01.md
â”œâ”€â”€ folder_review_batch_02.md
â””â”€â”€ ...
```

### Sample Output Format

```markdown
# ğŸ“¦ Folder Review Batch 1

_Last updated: 2024-01-15 14:30_

## Code Organization
- [Claude's analysis here]

## Bug Patterns
- [Identified issues]

## Architecture Weaknesses
- [Structural concerns]

## Suggestions
- [Improvement recommendations]
```

## Review Focus Areas

The script instructs Claude to analyze:

- **Code Organization**: Structure and modularity assessment
- **Bug Patterns**: Common error-prone patterns identification
- **Architecture Weaknesses**: Structural and design issues
- **Improvement Suggestions**: Actionable recommendations for refactoring

## Performance Considerations

### Token Management
- **Batch Size**: ~10,000 tokens per batch
- **API Efficiency**: Minimizes API calls while staying within limits
- **Processing Time**: Displays completion time and progress indicators

### Error Handling
- Graceful handling of file read errors
- API request failure recovery
- Comprehensive error reporting with emoji indicators

## Limitations & Suggestions

### Current Limitations

1. **Token Estimation**: Uses simplified character-based estimation
2. **Language Detection**: Relies on file extensions only
3. **Review Depth**: Limited by Claude's context window per batch

### Suggested Improvements

1. **Enhanced Token Counting**: Integrate proper tokenizer (e.g., `tiktoken`)
2. **File Type Detection**: Add content-based language detection
3. **Configuration File**: Support for custom exclusion patterns and file types
4. **Progress Persistence**: Add ability to resume interrupted reviews
5. **Summary Generation**: Create consolidated report across all batches

### Example Enhancement

```python
# Suggested improvement for token counting
import tiktoken

def accurate_token_count(text: str, model: str) -> int:
    """More accurate token counting using tiktoken"""
    encoding = tiktoken.encoding_for_model(model)
    return len(encoding.encode(text))
```

## Error Handling

The script provides clear feedback with emoji indicators:
- âœ… Successful operations
- âŒ Errors and failures
- ğŸ“¦ Batch processing status
- ğŸ” File discovery
- ğŸ‰ Completion notification

## Best Practices

1. **API Key Security**: Always use environment variables for API keys
2. **Large Codebases**: Monitor API usage costs for extensive reviews
3. **Review Output**: Manually verify AI suggestions before implementing changes
4. **Backup**: Ensure your codebase is backed up before making suggested changes