<!-- Auto-generated by Claude on 2025-06-23 08:29 -->

# Claude Folder Review (Batched) - Documentation

## Overview

This Python script provides an automated code review system that uses Anthropic's Claude AI to analyze source code files in batches. The tool recursively scans a folder structure, groups files into manageable token-sized batches, and generates comprehensive markdown reviews for each batch.

## Purpose

- **Automated Code Review**: Leverage Claude AI to perform systematic code reviews
- **Batch Processing**: Handle large codebases by splitting files into ~10k token chunks
- **Documentation Generation**: Produce structured markdown reports for each batch
- **Multi-language Support**: Review various programming languages and file types

## Key Features

- Recursive folder scanning
- Intelligent file filtering and exclusion
- Token-based batching to optimize API usage
- Error handling and progress tracking
- Timestamped markdown output

## Dependencies

```python
import os
import sys
import anthropic
from dotenv import load_dotenv
from datetime import datetime
import time
```

### Required Packages
- `anthropic` - Claude AI API client
- `python-dotenv` - Environment variable management

## Configuration

### Environment Variables
- `ANTHROPIC_API_KEY` - Your Claude API key (required)
- `ANTHROPIC_MODEL` - Claude model to use (default: `claude-sonnet-4-20250514`)

### File Types Supported
- Python (`.py`)
- JavaScript/TypeScript (`.js`, `.ts`, `.tsx`, `.jsx`)
- Web files (`.html`, `.css`)
- Configuration (`.json`, `.yaml`, `.yml`)
- Other languages (`.go`, `.java`)

## Important Functions

### `is_excluded(filename: str) -> bool`
Filters out test files from the review process.

**Parameters:**
- `filename`: File path to check

**Returns:**
- `bool`: True if file should be excluded

**Logic:**
- Excludes files containing "test" in name or path
- Case-insensitive matching
- Handles both Unix and Windows path separators

### `estimate_tokens(text: str) -> int`
Provides rough token count estimation for API usage optimization.

**Parameters:**
- `text`: Source code content

**Returns:**
- `int`: Estimated token count

**Note:** Uses simple 4:1 character-to-token ratio approximation

## Main Workflow

### 1. Setup Phase
```python
load_dotenv()
client = anthropic.Anthropic(api_key=os.getenv("ANTHROPIC_API_KEY"))
folder = sys.argv[1] if len(sys.argv) > 1 else "../137docs"
```

### 2. File Discovery
- Recursively walks target directory
- Filters by supported file extensions
- Excludes test files
- Validates file accessibility

### 3. Token Batching
- Groups files to stay under 10,000 token limit
- Estimates tokens per file
- Creates batches dynamically
- Handles overflow gracefully

### 4. AI Review Processing
- Sends batches to Claude API
- Focuses on:
  - Code organization
  - Bug patterns
  - Architecture weaknesses
  - Modularization suggestions

### 5. Output Generation
- Creates timestamped markdown files
- Saves to `docs/folder_review/` directory
- Names files as `folder_review_batch_XX.md`

## Usage

### Basic Usage
```bash
python claude_folder_review.py
```
*Reviews default folder: `../137docs`*

### Custom Folder
```bash
python claude_folder_review.py /path/to/your/project
```

## Output Structure

Each batch generates a markdown file with:

```markdown
# üì¶ Folder Review Batch X

_Last updated: YYYY-MM-DD HH:MM_

[Claude's analysis and recommendations]
```

## Error Handling

- **File Read Errors**: Logs and skips problematic files
- **API Errors**: Reports batch failures with error details
- **Missing Files**: Validates folder existence and file accessibility

## Performance Considerations

- **Token Limits**: Batches respect Claude's context window
- **Rate Limiting**: Processes batches sequentially
- **Memory Usage**: Processes files individually to manage memory
- **Progress Tracking**: Provides real-time batch progress updates

## Suggestions for Improvement

### üîß Potential Enhancements

1. **Parallel Processing**: Implement concurrent batch processing
2. **Incremental Reviews**: Skip unchanged files based on modification time
3. **Custom Filters**: Add configurable file exclusion patterns
4. **Summary Report**: Generate overview document combining all batches
5. **Configuration File**: Support YAML/JSON config for settings
6. **Resume Capability**: Continue from failed batches

### ‚ö†Ô∏è Current Limitations

- Simple token estimation may be inaccurate
- Sequential processing can be slow for large codebases
- No support for binary file analysis
- Limited error recovery for API failures

### üõ°Ô∏è Security Notes

- Ensure `.env` file contains valid API credentials
- Be mindful of API costs when processing large codebases
- Consider rate limiting for production use
- Review generated content before sharing externally

## Example Output Directory Structure

```
docs/
‚îî‚îÄ‚îÄ folder_review/
    ‚îú‚îÄ‚îÄ folder_review_batch_01.md
    ‚îú‚îÄ‚îÄ folder_review_batch_02.md
    ‚îî‚îÄ‚îÄ folder_review_batch_03.md
```