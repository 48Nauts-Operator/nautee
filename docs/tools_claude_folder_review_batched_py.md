<!-- Auto-generated by Claude on 2025-06-08 08:24 -->

# Claude Folder Review (Batched) Documentation

## Overview

This Python script performs automated code reviews of entire folders using Anthropic's Claude AI model. It intelligently batches source code files to stay within token limits and generates comprehensive markdown reviews for each batch.

## Purpose

- **Automated Code Review**: Leverage Claude AI to review large codebases systematically
- **Batch Processing**: Handle large folders by splitting files into manageable chunks (~10k tokens each)  
- **Documentation Generation**: Create structured markdown reports for each batch
- **Selective Analysis**: Focus on source code files while excluding test files

## Key Features

- Recursive folder scanning for source code files
- Intelligent token estimation and batching
- Multi-language support (Python, JavaScript, TypeScript, Go, Java, etc.)
- Test file exclusion
- Structured markdown output with timestamps

## Functions

### `is_excluded(filename: str) -> bool`

Determines whether a file should be excluded from review based on naming patterns.

**Parameters:**
- `filename`: Full path or filename to check

**Returns:**
- `True` if the file is a test file, `False` otherwise

**Exclusion Logic:**
- Files containing "test" in the name (case-insensitive)
- Files starting with "test_"
- Files in directories containing "test"

### `estimate_tokens(text: str) -> int`

Provides a rough estimate of token count for Claude API usage.

**Parameters:**
- `text`: Source code content

**Returns:**
- Estimated token count (using 4 characters ≈ 1 token approximation)

### `main()`

The primary function that orchestrates the entire review process:

1. **Setup Phase**: Loads environment variables and initializes Claude client
2. **File Discovery**: Recursively scans folder for valid source files
3. **Token Batching**: Groups files into batches under 10k tokens
4. **Review Generation**: Sends each batch to Claude and saves markdown reports

## Configuration

### Environment Variables

Create a `.env` file with:

```env
ANTHROPIC_API_KEY=your_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, defaults to this model
```

### Supported File Extensions

```python
valid_exts = (
    ".py", ".js", ".ts", ".tsx", ".jsx", 
    ".html", ".css", ".json", ".go", 
    ".java", ".yaml", ".yml"
)
```

## Usage

### Command Line

```bash
# Review specific folder
python claude_folder_review.py /path/to/your/code

# Review default folder (../137docs)
python claude_folder_review.py
```

### Output Structure

The script creates a `docs/folder_review/` directory containing:

```
docs/folder_review/
├── folder_review_batch_01.md
├── folder_review_batch_02.md
└── folder_review_batch_03.md
```

Each batch file includes:
- Timestamp header
- Structured markdown review
- Code organization insights
- Bug pattern identification
- Architecture recommendations

## Review Focus Areas

Claude analyzes each batch for:

- **Code Organization**: Structure and modularity
- **Bug Patterns**: Common issues and potential problems
- **Architecture Weaknesses**: Design flaws and improvements
- **Suggestions**: Modularization and clarity recommendations

## Error Handling

The script includes robust error handling for:

- Missing or invalid API keys
- File reading errors (permissions, encoding issues)
- Claude API failures (rate limits, network issues)
- Empty folders or no valid files

## Performance Notes

- **Token Limit**: Batches are capped at ~10,000 tokens to optimize Claude responses
- **Processing Time**: Displayed at completion in MM:SS format
- **API Costs**: Monitor usage as each batch consumes Claude API credits

## Suggestions for Improvement

1. **Add Progress Indicators**: Consider adding a progress bar for long-running reviews
2. **Configurable Exclusions**: Make file exclusion patterns configurable via command line or config file
3. **Output Formats**: Support additional output formats (JSON, HTML)
4. **Retry Logic**: Implement exponential backoff for API failures
5. **File Size Limits**: Add maximum file size limits to prevent extremely large files from dominating batches

## Dependencies

```bash
pip install anthropic python-dotenv
```

## Security Considerations

- Store API keys securely in `.env` files
- Ensure `.env` is included in `.gitignore`
- Be mindful of sending proprietary code to external AI services
- Consider local alternatives for sensitive codebases