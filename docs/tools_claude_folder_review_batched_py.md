<!-- Auto-generated by Claude on 2025-06-22 21:18 -->

# Claude Folder Review (Batched) Documentation

## Overview

This Python script provides an automated code review solution that processes source code files in batches using Anthropic's Claude AI model. The tool recursively scans a directory structure, groups files into token-optimized batches, and generates comprehensive Markdown reviews for each batch.

## Purpose

- **Automated Code Review**: Leverages Claude AI to provide intelligent insights on code organization, architecture, and potential improvements
- **Batch Processing**: Efficiently handles large codebases by splitting files into manageable chunks
- **Documentation Generation**: Creates structured Markdown reports for easy review and reference

## Key Features

- âœ… Recursive directory scanning
- âœ… Token-aware batching (~10k tokens per batch)
- âœ… Test file exclusion
- âœ… Multiple file format support
- âœ… Error handling and progress tracking
- âœ… Structured Markdown output

## Usage

```bash
# Review default folder (../137docs)
python claude_folder_review.py

# Review specific folder
python claude_folder_review.py /path/to/your/codebase
```

## Configuration

### Environment Variables

Create a `.env` file with:

```env
ANTHROPIC_API_KEY=your_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, defaults to this model
```

### Supported File Types

The script processes files with the following extensions:
- Python: `.py`
- JavaScript/TypeScript: `.js`, `.ts`, `.tsx`, `.jsx`
- Web: `.html`, `.css`
- Data: `.json`, `.yaml`, `.yml`
- Other: `.go`, `.java`

## Important Functions

### `is_excluded(filename: str) -> bool`

Filters out test files to focus on production code.

**Logic:**
- Excludes files containing "test" in the name
- Excludes files starting with "test_"
- Excludes files in test directories

```python
# Examples of excluded files:
# - test_example.py
# - /tests/unit_test.py
# - example_test.js
```

### `estimate_tokens(text: str) -> int`

Provides a rough token count estimation for Claude API limits.

**Formula:** `tokens â‰ˆ characters / 4`

> **Note:** This is an approximation. Actual token counts may vary based on content complexity.

### `main()`

The primary orchestrator function that:

1. **Setup Phase**: Loads environment variables and initializes Claude client
2. **Discovery Phase**: Recursively finds valid source files
3. **Batching Phase**: Groups files into ~10k token batches
4. **Processing Phase**: Sends batches to Claude for review
5. **Output Phase**: Saves individual Markdown reports

## Output Structure

Generated reviews are saved to `docs/folder_review/` with the following naming pattern:

```
docs/folder_review/
â”œâ”€â”€ folder_review_batch_01.md
â”œâ”€â”€ folder_review_batch_02.md
â””â”€â”€ folder_review_batch_03.md
```

Each file contains:
- Batch number and timestamp
- Code organization analysis
- Architecture insights
- Bug pattern identification
- Improvement suggestions

## Error Handling

The script includes robust error handling for:

- **File Reading Errors**: Continues processing other files if one fails
- **API Errors**: Logs Claude API failures without stopping the entire process
- **Missing Files**: Gracefully exits if no valid files are found

## Performance Considerations

- **Token Limits**: Batches are capped at ~10,000 tokens to optimize API usage
- **Rate Limiting**: Consider adding delays between API calls for large codebases
- **Memory Usage**: Files are read individually to minimize memory footprint

## Suggestions for Improvement

### ðŸ”§ Potential Enhancements

1. **Add Rate Limiting**: Implement delays between API calls to respect Claude's rate limits
   ```python
   time.sleep(1)  # Add after each API call
   ```

2. **Improve Token Estimation**: Use a more accurate tokenization method
   ```python
   # Consider using tiktoken or similar libraries
   import tiktoken
   ```

3. **Add Configuration File**: Support for custom file extensions and exclusion patterns
   ```python
   # Load from config.yaml
   valid_exts = config.get('file_extensions', default_exts)
   ```

4. **Progress Bar**: Add visual progress indication for long-running processes
   ```python
   from tqdm import tqdm
   for batch in tqdm(batches, desc="Processing batches"):
       # processing logic
   ```

5. **Parallel Processing**: Consider async processing for multiple batches
   ```python
   import asyncio
   # Implement async batch processing
   ```

## Dependencies

```python
pip install anthropic python-dotenv
```

## Security Notes

- Store API keys in `.env` files, never in source code
- Add `.env` to your `.gitignore` file
- Consider using environment-specific API keys for different deployment stages