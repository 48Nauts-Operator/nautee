<!-- Auto-generated by Claude on 2025-06-02 07:21 -->

# Claude Folder Review (Batched) Documentation

## Overview

This Python script performs automated code reviews of entire folders using Anthropic's Claude AI model. It intelligently processes source code files in batches to work within token limits and generates comprehensive markdown reports for each batch.

## Purpose

- **Automated Code Review**: Systematically review multiple source code files using AI
- **Batch Processing**: Handle large codebases by splitting files into manageable chunks
- **Documentation Generation**: Create structured markdown reports for review insights
- **Token Management**: Automatically estimate and manage API token usage

## Key Features

- Recursive folder scanning for source code files
- Intelligent file filtering (excludes test files)
- Token-based batching to optimize API usage
- Support for multiple programming languages
- Automated markdown report generation

## Functions

### `is_excluded(filename: str) -> bool`

Filters out test files from the review process.

**Parameters:**
- `filename`: Path or name of the file to check

**Returns:**
- `True` if the file should be excluded (contains "test" patterns)
- `False` if the file should be included in the review

**Example:**
```python
is_excluded("test_utils.py")  # Returns True
is_excluded("main.py")        # Returns False
```

### `estimate_tokens(text: str) -> int`

Provides a rough estimate of token count for API planning.

**Parameters:**
- `text`: Source code content as string

**Returns:**
- Estimated token count (using 4 characters ≈ 1 token ratio)

### `main()`

The primary function that orchestrates the entire review process:

1. **Setup Phase**: Loads environment variables and initializes Claude client
2. **File Discovery**: Recursively scans for valid source files
3. **Batch Creation**: Groups files into ~10k token batches
4. **Review Generation**: Processes each batch through Claude API
5. **Report Storage**: Saves markdown reviews to output directory

## Configuration

### Environment Variables

Create a `.env` file with:

```env
ANTHROPIC_API_KEY=your_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, defaults to this model
```

### Supported File Extensions

- **Python**: `.py`
- **JavaScript/TypeScript**: `.js`, `.ts`, `.tsx`, `.jsx`
- **Web**: `.html`, `.css`
- **Configuration**: `.json`, `.yaml`, `.yml`
- **Other Languages**: `.go`, `.java`

## Usage

### Basic Usage
```bash
python claude_folder_review.py /path/to/your/codebase
```

### Default Folder
```bash
python claude_folder_review.py  # Uses "../137docs" as default
```

## Output Structure

Reviews are saved to `docs/folder_review/` with the naming pattern:
```
docs/folder_review/
├── folder_review_batch_01.md
├── folder_review_batch_02.md
└── folder_review_batch_03.md
```

Each file contains:
- Batch number and timestamp
- Code organization analysis
- Bug pattern identification
- Architecture recommendations
- Modularization suggestions

## Token Management

- **Batch Limit**: 10,000 tokens per batch
- **Response Limit**: 2,000 tokens per review
- **Estimation Method**: 4 characters ≈ 1 token

## Error Handling

The script includes robust error handling for:
- Missing or invalid API keys
- File reading permissions
- Claude API rate limits or errors
- Empty folders or no valid files

## Notes and Suggestions

### ⚠️ Important Considerations

- **API Costs**: Each batch consumes Claude API tokens - monitor usage
- **Rate Limits**: Large codebases may hit API rate limits
- **File Size**: Very large files might exceed individual token limits

### 🔧 Potential Improvements

1. **Add retry logic** for API failures with exponential backoff
2. **Implement file size limits** to prevent oversized batches
3. **Add progress bars** for better user experience during long runs
4. **Support custom exclude patterns** via configuration file
5. **Add summary report** aggregating insights from all batches

### 📋 Best Practices

- Test with small folders first to understand output quality
- Review API usage in Anthropic console to manage costs
- Consider running during off-peak hours for large codebases
- Keep the output directory under version control for tracking changes

## Dependencies

```python
anthropic>=0.3.0
python-dotenv>=0.19.0
```

Install with:
```bash
pip install anthropic python-dotenv
```