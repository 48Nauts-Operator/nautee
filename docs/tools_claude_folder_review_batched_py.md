<!-- Auto-generated by Claude on 2025-06-08 05:20 -->

# Claude Folder Review (Batched) Documentation

## Overview

This Python script provides an automated code review solution that leverages Anthropic's Claude AI to analyze source code files in batches. The tool recursively scans a specified folder, processes source code files, and generates comprehensive markdown reviews focusing on code organization, bug patterns, architecture, and improvement suggestions.

## Purpose

- **Automated Code Review**: Uses Claude AI to perform intelligent code analysis
- **Batch Processing**: Handles large codebases by splitting files into manageable chunks
- **Token Management**: Automatically manages API token limits (~10k tokens per batch)
- **Documentation Generation**: Creates structured markdown reports for each batch

## Key Features

- Recursive folder scanning
- File type filtering
- Test file exclusion
- Token estimation and batching
- Error handling and progress tracking
- Timestamped output files

## Functions

### `is_excluded(filename: str) -> bool`

Determines whether a file should be excluded from the review process.

**Parameters:**
- `filename` (str): The file path to check

**Returns:**
- `bool`: True if the file should be excluded (test files), False otherwise

**Exclusion Criteria:**
- Files containing "test" in the name (case-insensitive)
- Files starting with "test_"
- Files in directories containing "test"

### `estimate_tokens(text: str) -> int`

Provides a rough estimation of token count for API usage planning.

**Parameters:**
- `text` (str): The source code content

**Returns:**
- `int`: Estimated token count (using 4 characters per token approximation)

### `main()`

The primary function that orchestrates the entire review process:

1. **Setup Phase**: Loads environment variables and initializes Claude client
2. **File Discovery**: Recursively finds valid source files
3. **Token Batching**: Groups files to stay within API limits
4. **Batch Processing**: Sends batches to Claude for review
5. **Output Generation**: Saves markdown reviews with timestamps

## Configuration

### Environment Variables

```bash
ANTHROPIC_API_KEY=your_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, defaults to specified model
```

### Supported File Types

```python
valid_exts = (
    ".py", ".js", ".ts", ".tsx", ".jsx", 
    ".html", ".css", ".json", ".go", 
    ".java", ".yaml", ".yml"
)
```

## Usage

### Basic Usage

```bash
python claude_folder_review.py /path/to/your/codebase
```

### Default Folder

If no folder is specified, it defaults to `../137docs`:

```bash
python claude_folder_review.py
```

## Output

The script generates markdown files in the `docs/folder_review/` directory:

```
docs/folder_review/
‚îú‚îÄ‚îÄ folder_review_batch_01.md
‚îú‚îÄ‚îÄ folder_review_batch_02.md
‚îî‚îÄ‚îÄ folder_review_batch_03.md
```

Each review file includes:
- Batch number and timestamp
- Code organization analysis
- Bug pattern identification
- Architecture assessment
- Improvement recommendations

## Error Handling

The script includes robust error handling for:
- File reading errors
- Claude API failures
- Missing environment variables
- Empty folder scenarios

## Performance Considerations

- **Token Limit**: Batches are capped at ~10,000 tokens
- **API Rate Limiting**: Processes batches sequentially to avoid rate limits
- **Memory Usage**: Files are read individually to minimize memory footprint

## Dependencies

```python
anthropic      # Claude AI API client
python-dotenv  # Environment variable management
```

## Installation

```bash
pip install anthropic python-dotenv
```

## Notes and Suggestions

### ‚ö†Ô∏è Important Notes

- Ensure your `ANTHROPIC_API_KEY` is properly set in your `.env` file
- The script excludes test files by default - modify `is_excluded()` if needed
- Token estimation is approximate; actual usage may vary

### üîß Potential Improvements

1. **File Type Configuration**: Make supported extensions configurable
2. **Custom Exclusion Rules**: Allow user-defined exclusion patterns
3. **Parallel Processing**: Implement concurrent batch processing
4. **Progress Bar**: Add visual progress indicators for large codebases
5. **Summary Report**: Generate an overall summary across all batches
6. **Custom Prompts**: Allow customizable review prompts for different analysis focuses

### üí° Usage Tips

- Start with smaller folders to test the setup
- Review the generated markdown files for insights
- Adjust the `MAX_TOKENS` constant if you encounter API limits
- Consider organizing output by project or date for better management