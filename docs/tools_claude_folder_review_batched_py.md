<!-- Auto-generated by Claude on 2025-06-22 19:15 -->

# Claude Folder Review (Batched) Documentation

## Overview

This Python script provides an automated code review solution that recursively analyzes source code files from a specified folder using Anthropic's Claude AI model. The script intelligently batches files to stay within token limits and generates comprehensive markdown reviews for code quality assessment.

## Purpose

- **Automated Code Review**: Leverages Claude AI to perform senior-level code reviews
- **Batch Processing**: Handles large codebases by splitting files into manageable token-sized chunks
- **Documentation Generation**: Creates structured markdown reports for each batch
- **Quality Assessment**: Focuses on code organization, bug patterns, architecture, and improvement suggestions

## Key Features

- Recursive folder scanning with file type filtering
- Intelligent token estimation and batching
- Test file exclusion
- Error handling and progress tracking
- Timestamped markdown output generation

## Dependencies

```python
import os
import sys
import anthropic
from dotenv import load_dotenv
from datetime import datetime
import time
```

### Required Packages
- `anthropic` - Claude AI API client
- `python-dotenv` - Environment variable management

## Configuration

### Environment Variables
The script requires the following environment variables in a `.env` file:

```bash
ANTHROPIC_API_KEY=your_claude_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, has default
```

### Supported File Types
```python
valid_exts = (".py", ".js", ".ts", ".tsx", ".jsx", ".html", ".css", ".json", ".go", ".java", ".yaml", ".yml")
```

## Important Functions

### `is_excluded(filename: str) -> bool`
Determines whether a file should be excluded from review based on naming patterns.

**Parameters:**
- `filename` (str): The file path to check

**Returns:**
- `bool`: True if file should be excluded (test files), False otherwise

**Logic:**
- Excludes files containing "test" in the name
- Excludes files starting with "test_"
- Excludes files in test directories

### `estimate_tokens(text: str) -> int`
Provides a rough estimate of token count for Claude API usage.

**Parameters:**
- `text` (str): Source code content

**Returns:**
- `int`: Estimated token count (text length รท 4)

**Note:** This is a simplified estimation. For production use, consider using more accurate tokenization libraries.

### `main()`
The primary orchestration function that handles the complete workflow.

## Workflow

1. **Setup Phase**
   - Load environment variables
   - Initialize Claude client
   - Set up output directory structure

2. **File Discovery**
   - Recursively scan target folder
   - Filter by supported file extensions
   - Exclude test files

3. **Token Batching**
   - Group files into ~10,000 token batches
   - Prevent API token limit violations
   - Optimize for processing efficiency

4. **Review Generation**
   - Send batches to Claude for analysis
   - Generate structured markdown reviews
   - Save timestamped output files

## Usage

### Basic Usage
```bash
python claude_folder_review.py /path/to/source/folder
```

### Default Folder
```bash
python claude_folder_review.py  # Uses ../137docs as default
```

## Output Structure

Generated reviews are saved in `docs/folder_review/` with the following naming pattern:
```
folder_review_batch_01.md
folder_review_batch_02.md
...
```

Each review includes:
- Batch number and timestamp
- Code organization analysis
- Bug pattern identification
- Architecture weakness assessment
- Modularization suggestions

## Suggestions and Notes

### Performance Considerations
- **Token Limits**: Current batch size is 10,000 tokens (~40KB text)
- **API Rate Limits**: Consider adding delays between requests for large codebases
- **Memory Usage**: Large files are loaded entirely into memory

### Potential Improvements

1. **Enhanced Token Estimation**
   ```python
   # Consider using tiktoken for accurate token counting
   import tiktoken
   encoding = tiktoken.get_encoding("cl100k_base")
   tokens = len(encoding.encode(text))
   ```

2. **Configuration File Support**
   - Add YAML/JSON config for file extensions
   - Customizable exclusion patterns
   - Adjustable batch sizes

3. **Progress Persistence**
   - Save progress state for large codebases
   - Resume interrupted reviews
   - Batch retry mechanisms

4. **Enhanced Error Handling**
   ```python
   # Add exponential backoff for API errors
   import backoff
   
   @backoff.on_exception(backoff.expo, anthropic.APIError)
   def make_api_call(client, prompt):
       # API call logic
   ```

### Security Considerations
- Store API keys securely using environment variables
- Consider implementing API key rotation
- Be mindful of sending proprietary code to external APIs

### Usage Recommendations
- Test with small folders first
- Monitor API usage and costs
- Review generated output for accuracy
- Use for supplementary analysis, not replacement of human review

## Error Handling

The script includes basic error handling for:
- Missing files during processing
- Claude API errors
- File reading permissions
- Invalid folder paths

Console output provides real-time feedback with emoji indicators for easy status monitoring.