<!-- Auto-generated by Claude on 2025-06-21 23:19 -->

# Claude Folder Review (Batched) Documentation

## Overview

This Python script provides an automated code review system that uses Anthropic's Claude AI to analyze source code files in batches. The script recursively scans a folder for source code files, splits them into manageable token-sized chunks, and generates comprehensive markdown reviews for each batch.

## Purpose

- **Automated Code Review**: Leverage Claude AI to perform systematic code reviews
- **Batch Processing**: Handle large codebases by splitting files into ~10k token chunks
- **Documentation Generation**: Create structured markdown reports for each batch
- **Multi-language Support**: Process various source code file types

## Key Features

- Recursive folder scanning
- Intelligent file filtering (excludes test files)
- Token-based batching to respect API limits
- Markdown output generation with timestamps
- Error handling and progress tracking

## Functions

### `is_excluded(filename: str) -> bool`

Determines whether a file should be excluded from the review process.

**Parameters:**
- `filename` (str): The file path to check

**Returns:**
- `bool`: True if the file should be excluded (test files), False otherwise

**Exclusion Criteria:**
- Files containing "test" in the name (case-insensitive)
- Files starting with "test_"
- Files in directories containing "test"

### `estimate_tokens(text: str) -> int`

Provides a rough estimate of token count for API usage planning.

**Parameters:**
- `text` (str): The source code content

**Returns:**
- `int`: Estimated token count (using 4 characters per token approximation)

### `main()`

The primary function that orchestrates the entire review process:

1. **Setup Phase**: Initializes Claude client and configuration
2. **File Discovery**: Recursively finds valid source files
3. **Token Batching**: Groups files into batches under the token limit
4. **Review Generation**: Processes each batch through Claude API
5. **Output Creation**: Saves markdown reviews to individual files

## Configuration

### Environment Variables

```bash
ANTHROPIC_API_KEY=your_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, has default
```

### Supported File Extensions

- **Python**: `.py`
- **JavaScript/TypeScript**: `.js`, `.ts`, `.tsx`, `.jsx`
- **Web**: `.html`, `.css`
- **Configuration**: `.json`, `.yaml`, `.yml`
- **Other Languages**: `.go`, `.java`

## Usage

### Basic Usage
```bash
python claude_folder_review.py
```
*Uses default folder: `../137docs`*

### Specify Custom Folder
```bash
python claude_folder_review.py /path/to/your/codebase
```

## Output Structure

The script generates files in the `docs/folder_review/` directory:

```
docs/folder_review/
├── folder_review_batch_01.md
├── folder_review_batch_02.md
└── folder_review_batch_03.md
```

Each file contains:
- Batch number and timestamp
- Structured markdown review focusing on:
  - Code organization
  - Bug patterns  
  - Architecture weaknesses
  - Modularization suggestions

## Configuration Constants

- **MAX_TOKENS**: 10,000 (adjustable batch size limit)
- **Default Model**: `claude-sonnet-4-20250514`
- **Output Directory**: `docs/folder_review`

## Error Handling

The script includes robust error handling for:
- Missing or invalid files
- API communication errors
- File reading permissions
- Missing environment variables

## Notes and Suggestions

### Performance Considerations
- Large codebases are automatically chunked to prevent API timeouts
- Progress indicators help track long-running operations
- Failed batches don't stop the entire process

### Best Practices
- Set up `.env` file with your Anthropic API key
- Review the excluded file patterns to ensure they match your needs
- Consider adjusting `MAX_TOKENS` based on your API limits and preferences

### Limitations
- Token estimation is approximate (4 chars/token)
- Currently focuses on source code files only
- Requires valid Anthropic API credentials

### Potential Improvements
- Add support for additional file types
- Implement more sophisticated token counting
- Add configuration file support
- Include summary generation across all batches

## Dependencies

```python
anthropic>=0.3.0
python-dotenv>=0.19.0
```

Install with:
```bash
pip install anthropic python-dotenv
```