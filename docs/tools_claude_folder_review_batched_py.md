<!-- Auto-generated by Claude on 2025-06-23 06:38 -->

# Claude Folder Review (Batched) Documentation

## Overview

This Python script performs automated code reviews of entire project folders using Anthropic's Claude AI model. It intelligently processes source code files in batches to work within API token limits and generates detailed markdown reviews for each batch.

## Purpose

- **Automated Code Review**: Leverages Claude AI to review source code for quality, architecture, and potential issues
- **Batch Processing**: Splits large codebases into manageable chunks (~10k tokens each) to optimize API usage
- **Documentation Generation**: Creates organized markdown reports for each batch of reviewed files
- **Multi-language Support**: Handles various programming languages and file types

## Key Features

- Recursive folder scanning
- Intelligent file filtering (excludes test files)
- Token estimation and batch optimization
- Error handling and progress tracking
- Structured markdown output

## Functions

### `is_excluded(filename: str) -> bool`

Determines whether a file should be excluded from the review process.

**Parameters:**
- `filename`: Path or name of the file to check

**Returns:**
- `bool`: `True` if the file should be excluded (test files), `False` otherwise

**Exclusion Criteria:**
- Files containing "test" in the name (case-insensitive)
- Files starting with "test_"
- Files in directories containing "test"

### `estimate_tokens(text: str) -> int`

Provides a rough estimation of token count for API usage planning.

**Parameters:**
- `text`: Source code content to analyze

**Returns:**
- `int`: Estimated token count (uses 4 characters per token approximation)

### `main()`

The primary function that orchestrates the entire review process:

1. **Setup Phase**: Loads environment variables and initializes Claude client
2. **File Discovery**: Recursively scans for valid source files
3. **Token Batching**: Groups files into batches under the token limit
4. **Review Processing**: Sends batches to Claude for analysis
5. **Output Generation**: Saves markdown reviews to the output directory

## Configuration

### Environment Variables

Create a `.env` file with the following variables:

```env
ANTHROPIC_API_KEY=your_claude_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514
```

### Supported File Extensions

The script processes files with these extensions:
- **Python**: `.py`
- **JavaScript/TypeScript**: `.js`, `.ts`, `.tsx`, `.jsx`
- **Web**: `.html`, `.css`
- **Data**: `.json`, `.yaml`, `.yml`
- **Other Languages**: `.go`, `.java`

## Usage

### Basic Usage

```bash
python claude_folder_review.py /path/to/your/project
```

### Default Behavior

If no folder is specified, it defaults to `../137docs`:

```bash
python claude_folder_review.py
```

## Output Structure

Reviews are saved to `docs/folder_review/` with the following naming convention:

```
docs/folder_review/
├── folder_review_batch_01.md
├── folder_review_batch_02.md
└── folder_review_batch_03.md
```

Each review file contains:
- Batch number and timestamp
- Code organization analysis
- Bug pattern identification
- Architecture recommendations
- Modularization suggestions

## Configuration Options

| Setting | Default Value | Description |
|---------|---------------|-------------|
| `MAX_TOKENS` | 10,000 | Maximum tokens per batch |
| `output_root` | `docs/folder_review` | Output directory for reviews |
| `model` | `claude-sonnet-4-20250514` | Claude model to use |

## Error Handling

The script includes comprehensive error handling for:
- Missing or invalid files
- API connection issues
- File reading permissions
- Empty directories

## Performance Notes

- **Token Estimation**: Uses a 4:1 character-to-token ratio for estimation
- **Batch Processing**: Prevents API timeouts and manages costs
- **Progress Tracking**: Provides real-time feedback during processing

## Suggestions for Improvement

1. **Add Configuration File**: Consider using a YAML/JSON config file for settings
2. **Language Detection**: Implement automatic language detection for better syntax highlighting
3. **Incremental Reviews**: Add support for reviewing only changed files
4. **Custom Exclusion Rules**: Allow users to define custom exclusion patterns
5. **Review Templates**: Support different review templates for different project types
6. **Parallel Processing**: Implement concurrent batch processing for faster execution

## Dependencies

```python
anthropic  # Claude AI client
python-dotenv  # Environment variable management
```

Install with:
```bash
pip install anthropic python-dotenv
```

## Example Output

The generated markdown reviews focus on:
- **Code Organization**: File structure and module organization
- **Bug Patterns**: Common coding mistakes and potential issues
- **Architecture Weaknesses**: Design flaws and improvement opportunities
- **Refactoring Suggestions**: Specific recommendations for code improvement