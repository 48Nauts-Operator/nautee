<!-- Auto-generated by Claude on 2025-06-01 15:19 -->

# Claude Folder Review (Batched) Documentation

## Overview

This Python script provides an automated code review solution that analyzes source code files in a directory using Anthropic's Claude AI model. The script intelligently batches files to stay within token limits and generates comprehensive markdown reviews for each batch.

## Purpose

- **Automated Code Review**: Leverages Claude AI to perform senior-level code reviews
- **Batch Processing**: Handles large codebases by splitting files into manageable chunks
- **Documentation Generation**: Creates organized markdown reports for review insights
- **Multi-language Support**: Reviews various programming languages and file types

## Key Features

- Recursive directory scanning
- Intelligent file filtering (excludes test files)
- Token-aware batching (~10k tokens per batch)
- Comprehensive error handling
- Progress tracking and timing

## Functions

### `is_excluded(filename: str) -> bool`

Determines whether a file should be excluded from the review process.

**Parameters:**
- `filename` (str): The file path to evaluate

**Returns:**
- `bool`: True if the file should be excluded (test files), False otherwise

**Exclusion Criteria:**
- Files containing "test" in the name
- Files starting with "test_"
- Files in test directories

### `estimate_tokens(text: str) -> int`

Provides a rough estimation of token count for API usage planning.

**Parameters:**
- `text` (str): The source code content

**Returns:**
- `int`: Estimated token count (uses 4 characters per token approximation)

### `main()`

The primary execution function that orchestrates the entire review process.

**Process Flow:**
1. Environment setup and configuration
2. File discovery and filtering
3. Token-based batching
4. Claude API integration
5. Review generation and storage

## Configuration

### Environment Variables

```bash
ANTHROPIC_API_KEY=your_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, has default
```

### Supported File Extensions

- **Python**: `.py`
- **JavaScript/TypeScript**: `.js`, `.ts`, `.tsx`, `.jsx`
- **Web**: `.html`, `.css`
- **Data**: `.json`, `.yaml`, `.yml`
- **Other Languages**: `.go`, `.java`

## Usage

### Basic Usage

```bash
python claude_folder_review.py /path/to/source/code
```

### Default Folder

If no path is provided, it defaults to `../137docs`:

```bash
python claude_folder_review.py
```

## Output Structure

The script generates markdown files in the `docs/folder_review/` directory:

```
docs/folder_review/
├── folder_review_batch_01.md
├── folder_review_batch_02.md
└── folder_review_batch_03.md
```

### Review Content Focus

Each batch review includes insights on:
- **Code Organization**: Structure and maintainability
- **Bug Patterns**: Potential issues and vulnerabilities  
- **Architecture Weaknesses**: Design flaws and improvements
- **Modularization**: Suggestions for better code organization

## Configuration Options

| Setting | Default Value | Description |
|---------|---------------|-------------|
| `MAX_TOKENS` | 10,000 | Maximum tokens per batch |
| `output_root` | `docs/folder_review` | Output directory |
| `folder` | `../137docs` | Default source directory |

## Error Handling

The script includes robust error handling for:
- **File Reading Errors**: Continues processing other files
- **API Errors**: Reports failures but continues with remaining batches
- **Missing Files**: Validates directory existence and file availability

## Performance Notes

- **Token Estimation**: Uses a 4:1 character-to-token ratio approximation
- **Batch Processing**: Prevents API token limit violations
- **Progress Tracking**: Provides real-time feedback on processing status
- **Timing**: Reports total execution time upon completion

## Suggestions for Improvement

### Potential Enhancements

1. **Configuration File**: Add YAML/JSON config for customizable settings
2. **Language Detection**: Improve syntax highlighting based on file type
3. **Incremental Reviews**: Skip unchanged files based on timestamps
4. **Summary Generation**: Create an overview document combining all batches
5. **Custom Exclusions**: Allow user-defined exclusion patterns

### Usage Tips

- **Large Codebases**: Monitor API usage costs for extensive reviews
- **Focused Reviews**: Use targeted directory paths for specific components
- **Regular Reviews**: Schedule periodic runs for ongoing code quality monitoring
- **Team Integration**: Incorporate into CI/CD pipelines for automated reviews

## Dependencies

```python
anthropic>=0.25.0
python-dotenv>=1.0.0
```

Install with:
```bash
pip install anthropic python-dotenv
```