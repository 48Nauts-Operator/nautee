<!-- Auto-generated by Claude on 2025-06-22 23:19 -->

# Claude Folder Review (Batched) - Documentation

## Overview

This Python script provides an automated code review solution that analyzes source code files in a directory using Anthropic's Claude AI model. The script intelligently batches files to work within token limits and generates comprehensive markdown reviews for each batch.

## Purpose

- **Automated Code Review**: Leverage Claude AI to analyze code quality, architecture, and potential issues
- **Batch Processing**: Handle large codebases by splitting files into manageable chunks (~10k tokens each)
- **Documentation Generation**: Create structured markdown reports for each batch of reviewed files
- **Multi-language Support**: Review various file types including Python, JavaScript, TypeScript, HTML, CSS, and more

## Key Features

### File Discovery and Filtering
- Recursively scans directories for source code files
- Filters out test files automatically
- Supports multiple programming languages and file formats

### Intelligent Batching
- Estimates token usage to stay within API limits
- Groups files into batches of approximately 10,000 tokens
- Prevents API request failures due to token limits

### Automated Review Generation
- Uses Claude AI to analyze code patterns and architecture
- Generates structured markdown reports
- Timestamps all reviews for tracking purposes

## Important Functions

### `is_excluded(filename: str) -> bool`

Determines whether a file should be excluded from review based on naming patterns.

**Parameters:**
- `filename`: The file path to check

**Returns:**
- `bool`: True if the file should be excluded (test files), False otherwise

**Example:**
```python
is_excluded("test_example.py")  # Returns True
is_excluded("main.py")          # Returns False
```

### `estimate_tokens(text: str) -> int`

Provides a rough estimate of token count for API usage planning.

**Parameters:**
- `text`: The source code content

**Returns:**
- `int`: Estimated token count (uses 4 characters per token approximation)

**Note:** This is a rough estimation. For more accurate token counting, consider using the official tokenizer.

## Configuration

### Environment Variables

The script requires the following environment variables (typically stored in a `.env` file):

```bash
ANTHROPIC_API_KEY=your_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, has default
```

### Supported File Extensions

```python
valid_exts = (
    ".py", ".js", ".ts", ".tsx", ".jsx", 
    ".html", ".css", ".json", ".go", 
    ".java", ".yaml", ".yml"
)
```

## Usage

### Basic Usage
```bash
python script_name.py /path/to/source/folder
```

### Default Folder
If no folder is specified, it defaults to `../137docs`:
```bash
python script_name.py
```

## Output Structure

The script generates review files in the following structure:
```
docs/
└── folder_review/
    ├── folder_review_batch_01.md
    ├── folder_review_batch_02.md
    └── ...
```

Each batch file contains:
- Batch number and timestamp
- Code organization analysis
- Bug pattern identification
- Architecture weakness assessment
- Modularization suggestions

## Dependencies

```python
pip install anthropic python-dotenv
```

## Error Handling

- **File Read Errors**: Logs errors and continues processing other files
- **API Errors**: Reports Claude API failures per batch but continues with remaining batches
- **Missing Files**: Exits gracefully if no valid files are found

## Performance Notes

- **Processing Time**: Displays total processing time upon completion
- **Batch Progress**: Shows real-time progress through batches
- **Token Management**: Automatically manages token limits to prevent API failures

## Suggestions for Improvement

### 1. Enhanced Token Estimation
Consider integrating the official Anthropic tokenizer for more accurate token counting:
```python
# Instead of simple character division
def estimate_tokens_accurate(text: str) -> int:
    # Use official tokenizer here
    pass
```

### 2. Configurable Exclusion Patterns
Make exclusion patterns configurable via command line or config file:
```python
EXCLUDE_PATTERNS = ["test", "spec", "__pycache__", ".git"]
```

### 3. Resume Capability
Add ability to resume interrupted batch processing:
```python
# Check for existing batch files and skip completed ones
existing_batches = glob.glob(f"{output_root}/folder_review_batch_*.md")
```

### 4. Summary Report
Generate an overall summary combining insights from all batches:
```python
def generate_summary_report(batch_files):
    # Combine and summarize all batch reviews
    pass
```

## Limitations

- **Token Estimation**: Uses approximate token counting which may not be 100% accurate
- **File Encoding**: Assumes UTF-8 encoding for all files
- **API Rate Limits**: Does not implement rate limiting or retry logic
- **Memory Usage**: Loads entire file contents into memory for processing

## Security Considerations

- Ensure your `.env` file is not committed to version control
- Be mindful of sending proprietary code to external APIs
- Consider data retention policies when using cloud-based AI services