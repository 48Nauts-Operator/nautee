<!-- Auto-generated by Claude on 2025-06-23 07:21 -->

# Claude Folder Review (Batched) Documentation

## Overview

This Python script provides an automated code review solution that processes source code files in batches using Anthropic's Claude AI model. The tool recursively scans a directory for source files, organizes them into token-optimized batches, and generates comprehensive Markdown reviews for each batch.

## Purpose

- **Automated Code Review**: Leverage Claude AI to analyze codebases for architecture issues, bugs, and improvement opportunities
- **Batch Processing**: Handle large codebases by splitting files into manageable chunks (~10k tokens each)
- **Documentation Generation**: Create structured Markdown reports for easy review and sharing
- **Multi-language Support**: Process various programming languages and configuration files

## Key Features

- Recursive directory scanning with file filtering
- Intelligent token estimation and batching
- Test file exclusion
- Support for multiple file extensions
- Error handling and progress tracking
- Timestamped output reports

## Configuration

### Environment Variables

The script requires the following environment variables (loaded via `.env` file):

```bash
ANTHROPIC_API_KEY=your_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, defaults to this model
```

### Supported File Extensions

- **Python**: `.py`
- **JavaScript/TypeScript**: `.js`, `.ts`, `.tsx`, `.jsx`
- **Web**: `.html`, `.css`
- **Data**: `.json`, `.yaml`, `.yml`
- **Other Languages**: `.go`, `.java`

## Functions

### `is_excluded(filename: str) -> bool`

Filters out test files from the review process.

**Parameters:**
- `filename`: Full path or filename to check

**Returns:**
- `True` if the file should be excluded (contains "test" patterns)
- `False` if the file should be included

**Example Usage:**
```python
is_excluded("/src/test_utils.py")  # Returns True
is_excluded("/src/main.py")        # Returns False
```

### `estimate_tokens(text: str) -> int`

Provides a rough token count estimation for Claude API usage planning.

**Parameters:**
- `text`: Source code content as string

**Returns:**
- Estimated token count (uses 4:1 character-to-token ratio)

**Note:** This is an approximation. Actual token usage may vary.

## Usage

### Basic Usage

```bash
python claude_folder_review.py /path/to/codebase
```

### Default Behavior

If no path is provided, the script defaults to reviewing the `../137docs` directory:

```bash
python claude_folder_review.py
```

## Output Structure

The script generates review files in the following structure:

```
docs/folder_review/
├── folder_review_batch_01.md
├── folder_review_batch_02.md
└── folder_review_batch_XX.md
```

### Output File Format

Each batch review file contains:

```markdown
# 📦 Folder Review Batch X

_Last updated: YYYY-MM-DD HH:MM_

[Claude's detailed review content including:]
- Code organization analysis
- Bug pattern identification
- Architecture weakness assessment
- Modularization suggestions
```

## Review Focus Areas

Claude analyzes each batch for:

- **Code Organization**: Structure, naming conventions, and maintainability
- **Bug Patterns**: Common coding mistakes and potential issues
- **Architecture Weaknesses**: Design flaws and scalability concerns
- **Improvement Suggestions**: Refactoring opportunities and best practices

## Error Handling

The script includes robust error handling for:

- Missing or invalid files
- API connection issues
- File reading permissions
- Invalid directory paths

Error messages are clearly formatted with emoji indicators:
- ✅ Success operations
- ❌ Error conditions
- 🔍 Discovery operations
- 📦 Processing updates

## Performance Considerations

- **Token Limits**: Batches are capped at ~10,000 tokens to optimize API usage
- **Rate Limiting**: Consider adding delays between API calls for large codebases
- **Memory Usage**: Files are processed individually to minimize memory footprint

## Suggestions for Enhancement

1. **Add Rate Limiting**: Implement delays between API calls to respect usage limits
2. **Configuration File**: Move settings to a dedicated config file
3. **Custom Exclusion Patterns**: Allow user-defined file exclusion rules
4. **Progress Bar**: Add visual progress indication for large batches
5. **Summary Report**: Generate an overview document combining all batch insights
6. **Language-Specific Analysis**: Tailor review prompts based on detected file types

## Dependencies

```python
anthropic>=0.3.0
python-dotenv>=0.19.0
```

Install dependencies:
```bash
pip install anthropic python-dotenv
```

## Security Notes

- Store API keys securely in `.env` files
- Add `.env` to `.gitignore` to prevent accidental commits
- Consider using environment-specific API keys for different deployment stages