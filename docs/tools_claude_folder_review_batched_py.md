<!-- Auto-generated by Claude on 2025-06-22 20:21 -->

# Claude Folder Review (Batched) - Documentation

## Overview

This Python script provides an automated code review solution that uses Anthropic's Claude AI to analyze source code files in batches. The script recursively scans a folder structure, processes valid source code files, and generates comprehensive markdown reviews using Claude's language model.

## Purpose

- **Automated Code Review**: Leverage Claude AI to perform intelligent code analysis
- **Batch Processing**: Handle large codebases by splitting files into manageable token chunks
- **Documentation Generation**: Create structured markdown reports for each batch
- **Multi-language Support**: Process various programming languages and file types

## Key Features

- ‚úÖ Recursive folder scanning
- ‚úÖ Token-based batching (~10k tokens per batch)
- ‚úÖ Test file filtering
- ‚úÖ Multi-format file support
- ‚úÖ Error handling and progress tracking
- ‚úÖ Timestamped output files

## Requirements

### Dependencies
```python
anthropic
python-dotenv
```

### Environment Variables
- `ANTHROPIC_API_KEY`: Your Anthropic API key (required)
- `ANTHROPIC_MODEL`: Claude model to use (optional, defaults to "claude-sonnet-4-20250514")

## Usage

### Basic Usage
```bash
python claude_folder_review.py [folder_path]
```

### Examples
```bash
# Review current directory
python claude_folder_review.py

# Review specific folder
python claude_folder_review.py /path/to/your/project

# Review with default folder
python claude_folder_review.py  # Uses "../137docs" by default
```

## Core Functions

### `is_excluded(filename: str) -> bool`
Filters out test files and directories from the review process.

**Parameters:**
- `filename`: Full path or filename to evaluate

**Returns:**
- `True` if file should be excluded (contains "test" patterns)
- `False` if file should be included

**Example:**
```python
is_excluded("test_utils.py")        # True
is_excluded("/src/tests/main.py")   # True
is_excluded("main.py")              # False
```

### `estimate_tokens(text: str) -> int`
Provides a rough estimate of token count for API usage planning.

**Parameters:**
- `text`: Source code content

**Returns:**
- Estimated token count (uses 4 characters ‚âà 1 token rule)

**Note:** This is a simplified estimation. Actual token counts may vary based on Claude's tokenization.

## Supported File Types

The script processes files with the following extensions:

| Language | Extensions |
|----------|------------|
| Python | `.py` |
| JavaScript/TypeScript | `.js`, `.ts`, `.tsx`, `.jsx` |
| Web | `.html`, `.css` |
| Data | `.json`, `.yaml`, `.yml` |
| Other | `.go`, `.java` |

## Output Structure

### Directory Structure
```
docs/
‚îî‚îÄ‚îÄ folder_review/
    ‚îú‚îÄ‚îÄ folder_review_batch_01.md
    ‚îú‚îÄ‚îÄ folder_review_batch_02.md
    ‚îî‚îÄ‚îÄ ...
```

### Sample Output Format
```markdown
# üì¶ Folder Review Batch 1

_Last updated: 2024-01-15 14:30_

## Code Organization
- Analysis of file structure...

## Bug Patterns
- Identified potential issues...

## Architecture Weaknesses
- Suggestions for improvement...
```

## Configuration Options

### Customizable Parameters

| Parameter | Default Value | Description |
|-----------|---------------|-------------|
| `MAX_TOKENS` | 10,000 | Maximum tokens per batch |
| `folder` | "../137docs" | Default folder to scan |
| `output_root` | "docs/folder_review" | Output directory |
| `max_tokens` (API) | 2,000 | Claude response token limit |

### Modifying Batch Size
```python
# Adjust the MAX_TOKENS variable for different batch sizes
MAX_TOKENS = 15000  # Larger batches
MAX_TOKENS = 5000   # Smaller batches
```

## Error Handling

The script includes comprehensive error handling for:

- **File Reading Errors**: Skips unreadable files and continues processing
- **API Errors**: Logs Claude API failures per batch
- **Missing Files**: Validates folder existence and file discovery
- **Environment Issues**: Checks for required API keys

## Performance Notes

### Token Management
- **Estimation**: Uses 4:1 character-to-token ratio
- **Batching**: Prevents API token limit exceeded errors
- **Optimization**: Groups files efficiently to minimize API calls

### Processing Time
- Displays progress indicators for each batch
- Shows total processing time upon completion
- Processes batches sequentially to respect API rate limits

## Limitations & Considerations

### Current Limitations
- **Token Estimation**: Simplified calculation may not match exact Claude tokenization
- **File Encoding**: Assumes UTF-8 encoding for all files
- **Language Detection**: Based on file extensions only
- **API Rate Limits**: No built-in rate limiting (relies on sequential processing)

### Recommendations
1. **Test with Small Folders**: Start with smaller codebases to understand output quality
2. **Review API Costs**: Monitor Anthropic API usage for large projects
3. **Customize Exclusions**: Modify `is_excluded()` for project-specific needs
4. **Batch Size Tuning**: Adjust `MAX_TOKENS` based on your needs and API limits

## Future Enhancements

### Potential Improvements
- [ ] Add support for more programming languages
- [ ] Implement configurable exclusion patterns
- [ ] Add parallel processing with rate limiting
- [ ] Generate summary reports across all batches
- [ ] Support for custom review prompts
- [ ] Integration with version control systems

## Troubleshooting

### Common Issues

**No files found:**
```bash
‚ùå No valid files found in /path/to/folder
```
- Check folder path exists
- Verify files have supported extensions
- Ensure files aren't being excluded by test filters

**API Key errors:**
- Verify `.env` file contains `ANTHROPIC_API_KEY`
- Check API key validity and permissions

**Memory issues with large files:**
- Reduce `MAX_TOKENS` for smaller batches
- Consider