<!-- Auto-generated by Claude on 2025-06-01 23:18 -->

# Claude Folder Review (Batched) Documentation

## Overview

This Python script provides an automated code review solution that uses Anthropic's Claude AI to analyze source code files in batches. The tool recursively scans a directory, processes source files, and generates comprehensive markdown reviews focusing on code organization, bug patterns, architecture weaknesses, and improvement suggestions.

## Purpose

- **Automated Code Review**: Leverage Claude AI to perform intelligent code analysis
- **Batch Processing**: Handle large codebases by splitting files into manageable token chunks
- **Documentation Generation**: Create structured markdown reports for easy review
- **Multi-language Support**: Process various programming languages and file types

## Key Features

- Recursive directory scanning
- Token-based batching (≤10k tokens per batch)
- Test file exclusion
- Multiple file format support
- Structured markdown output
- Progress tracking and error handling

## Functions

### `is_excluded(filename: str) -> bool`

Determines whether a file should be excluded from the review process.

**Parameters:**
- `filename` (str): The file path to check

**Returns:**
- `bool`: True if the file should be excluded (test files), False otherwise

**Exclusion Criteria:**
- Files containing "test" in the name (case-insensitive)
- Files starting with "test_"
- Files in directories containing "test"

```python
# Examples of excluded files:
# - test_utils.py
# - /tests/unit_test.py
# - MyTestFile.js
```

### `estimate_tokens(text: str) -> int`

Provides a rough estimation of token count for API usage planning.

**Parameters:**
- `text` (str): Source code content

**Returns:**
- `int`: Estimated token count (uses 4 characters ≈ 1 token ratio)

**Note:** This is a simplified estimation. Actual token counts may vary depending on the content structure.

### `main()`

The primary execution function that orchestrates the entire review process.

**Process Flow:**
1. **Setup**: Load environment variables and initialize Claude client
2. **File Discovery**: Scan directory for valid source files
3. **Token Batching**: Group files into batches under token limit
4. **API Processing**: Send batches to Claude for review
5. **Output Generation**: Save markdown reviews to files

## Configuration

### Environment Variables

Create a `.env` file with the following variables:

```env
ANTHROPIC_API_KEY=your_claude_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514
```

### Supported File Extensions

The script processes files with the following extensions:

- **Python**: `.py`
- **JavaScript/TypeScript**: `.js`, `.ts`, `.tsx`, `.jsx`
- **Web**: `.html`, `.css`
- **Configuration**: `.json`, `.yaml`, `.yml`
- **Other Languages**: `.go`, `.java`

## Usage

### Basic Usage

```bash
python folder_review.py /path/to/your/codebase
```

### Default Folder

If no path is provided, it defaults to `../137docs`:

```bash
python folder_review.py
```

## Output Structure

Reviews are saved in the `docs/folder_review/` directory with the following naming convention:

```
docs/folder_review/
├── folder_review_batch_01.md
├── folder_review_batch_02.md
└── folder_review_batch_XX.md
```

Each file contains:
- Batch number and timestamp
- Claude's analysis focusing on:
  - Code organization
  - Bug patterns
  - Architecture weaknesses
  - Modularization suggestions

## Dependencies

Install required packages:

```bash
pip install anthropic python-dotenv
```

## Configuration Parameters

| Parameter | Default Value | Description |
|-----------|---------------|-------------|
| `MAX_TOKENS` | 10,000 | Maximum tokens per batch |
| `model` | `claude-sonnet-4-20250514` | Claude model version |
| `output_root` | `docs/folder_review` | Output directory |
| `max_tokens` | 2,000 | Maximum tokens in Claude response |

## Best Practices

### Before Running
- Ensure your `ANTHROPIC_API_KEY` is valid and has sufficient credits
- Review the file extensions list and modify if needed
- Consider the size of your codebase (large projects will generate multiple batches)

### Optimization Tips
- **Large Codebases**: Consider filtering specific directories if the codebase is very large
- **Token Management**: Monitor token usage, especially for commercial projects
- **Review Quality**: Smaller batches often produce more detailed reviews

## Error Handling

The script includes robust error handling for:
- **File Reading Errors**: Skips unreadable files and continues processing
- **API Errors**: Reports Claude API issues per batch
- **Missing Files**: Exits gracefully if no valid files are found

## Limitations

- **Token Estimation**: Uses simplified character-to-token ratio
- **File Type Detection**: Based solely on file extensions
- **API Rate Limits**: No built-in rate limiting (depends on Anthropic's limits)
- **Memory Usage**: Loads entire files into memory (may be problematic for very large files)

## Suggestions for Enhancement

- Add configuration file support for custom settings
- Implement more sophisticated token counting
- Add support for additional programming languages
- Include rate limiting for API calls
- Add option to resume incomplete batch processing
- Implement parallel processing for better performance