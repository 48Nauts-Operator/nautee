<!-- Auto-generated by Claude on 2025-06-23 06:32 -->

# Claude Folder Review (Batched) Documentation

## Overview

This Python script provides an automated code review system that uses Anthropic's Claude AI to analyze source code files in batches. The tool recursively scans a directory for source code files, organizes them into manageable chunks based on token limits, and generates comprehensive markdown reviews for each batch.

## Purpose

The script is designed to:
- Automatically discover and analyze source code files in a directory
- Split large codebases into manageable batches to work within AI token limits
- Generate detailed code reviews focusing on architecture, organization, and potential improvements
- Output structured markdown documentation for each batch review

## Key Functions

### `is_excluded(filename: str) -> bool`

Filters out test files from the review process.

**Parameters:**
- `filename` (str): The file path to check

**Returns:**
- `bool`: True if the file should be excluded (contains "test" patterns)

**Logic:**
- Checks for common test file patterns like "test", "test_", "/test", or "\\test"
- Case-insensitive matching

### `estimate_tokens(text: str) -> int`

Provides a rough estimation of token count for text content.

**Parameters:**
- `text` (str): The source code content

**Returns:**
- `int`: Estimated token count

**Implementation:**
- Uses a simple heuristic: `len(text) / 4`
- Based on average token size approximation

### `main()`

The primary function that orchestrates the entire review process.

**Key Steps:**
1. **Setup**: Loads environment variables and initializes Claude client
2. **File Discovery**: Recursively finds valid source files
3. **Token Batching**: Groups files into batches under token limit
4. **Review Generation**: Processes each batch through Claude API
5. **Output**: Saves markdown reviews to disk

## Configuration

### Environment Variables

```bash
ANTHROPIC_API_KEY=your_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, has default
```

### Supported File Extensions

The script processes files with these extensions:
- Python: `.py`
- JavaScript/TypeScript: `.js`, `.ts`, `.tsx`, `.jsx`
- Web: `.html`, `.css`
- Data: `.json`, `.yaml`, `.yml`
- Other: `.go`, `.java`

### Constants

```python
MAX_TOKENS = 10000  # Maximum tokens per batch
```

## Usage

### Basic Usage

```bash
python script.py [folder_path]
```

### Examples

```bash
# Review current directory
python claude_folder_review.py

# Review specific folder
python claude_folder_review.py /path/to/project

# Review relative path
python claude_folder_review.py ../my_project
```

## Output Structure

The script generates markdown files in the following structure:

```
docs/folder_review/
├── folder_review_batch_01.md
├── folder_review_batch_02.md
└── folder_review_batch_XX.md
```

Each file contains:
- Batch number and timestamp
- Detailed code review focusing on:
  - Code organization
  - Bug patterns
  - Architecture weaknesses
  - Modularization suggestions

## Error Handling

The script includes robust error handling for:
- **File Reading Errors**: Continues processing other files if one fails
- **API Errors**: Reports Claude API failures but continues with remaining batches
- **Missing Files**: Exits gracefully if no valid files are found

## Dependencies

```python
anthropic>=0.3.0
python-dotenv>=0.19.0
```

## Installation

```bash
pip install anthropic python-dotenv
```

## Notes and Suggestions

### Performance Considerations

- **Token Estimation**: The current token estimation (`len(text) / 4`) is approximate. Consider using tiktoken for more accurate counting
- **Rate Limiting**: No built-in rate limiting; may hit API limits with large codebases
- **Memory Usage**: Loads entire files into memory; could be optimized for very large files

### Potential Improvements

1. **Enhanced Token Counting**:
   ```python
   import tiktoken
   
   def accurate_token_count(text: str, model: str) -> int:
       encoding = tiktoken.encoding_for_model(model)
       return len(encoding.encode(text))
   ```

2. **Progress Tracking**:
   - Add progress bars using `tqdm`
   - Include ETA calculations

3. **Configuration File**:
   - Support for custom file extensions
   - Configurable exclusion patterns
   - Adjustable batch sizes

4. **Resume Capability**:
   - Skip already processed batches
   - Handle interrupted runs

### Security Considerations

- Ensure `.env` file is in `.gitignore`
- Be cautious about sending proprietary code to external APIs
- Consider using local models for sensitive codebases

### Usage Tips

- **Large Codebases**: Monitor API costs for extensive reviews
- **Focused Reviews**: Use exclusion patterns to focus on specific areas
- **Regular Updates**: Re-run periodically as code evolves
- **Team Reviews**: Share generated markdown files for team discussions