<!-- Auto-generated by Claude on 2025-06-02 01:47 -->

# Claude Folder Review (Batched) Documentation

## Overview

This Python script performs automated code reviews of source code files using Anthropic's Claude AI in batched processing. It recursively scans a directory for source files, groups them into token-limited batches, and generates individual Markdown review documents for each batch.

## Purpose

- **Automated Code Review**: Leverages Claude AI to analyze source code and provide insights
- **Batch Processing**: Handles large codebases by splitting files into manageable chunks
- **Token Management**: Respects API token limits by estimating and controlling batch sizes
- **Documentation Generation**: Creates structured Markdown reports for each batch

## Key Features

- Recursive directory scanning
- Smart file filtering (excludes test files)
- Token-based batching (~10k tokens per batch)
- Multiple programming language support
- Automated report generation

## Main Functions

### `is_excluded(filename: str) -> bool`

Determines whether a file should be excluded from review based on naming patterns.

**Parameters:**
- `filename`: File path to evaluate

**Returns:**
- `bool`: `True` if file should be excluded (test files), `False` otherwise

**Logic:**
- Excludes files containing "test" in the name
- Excludes files starting with "test_"
- Excludes files in test directories

### `estimate_tokens(text: str) -> int`

Provides a rough estimation of token count for API rate limiting.

**Parameters:**
- `text`: Source code content

**Returns:**
- `int`: Estimated token count (uses 1 token ‚âà 4 characters heuristic)

### `main()`

The primary execution function that orchestrates the entire review process.

**Process Flow:**
1. **Setup**: Loads environment variables and initializes Claude client
2. **File Discovery**: Recursively finds valid source files
3. **Token Batching**: Groups files into batches under token limit
4. **Review Generation**: Processes each batch through Claude API
5. **Output**: Saves Markdown reviews to disk

## Configuration

### Environment Variables

```bash
ANTHROPIC_API_KEY=your_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, has default
```

### Supported File Extensions

```python
valid_exts = (
    ".py", ".js", ".ts", ".tsx", ".jsx", 
    ".html", ".css", ".json", ".go", 
    ".java", ".yaml", ".yml"
)
```

### Default Settings

- **Max tokens per batch**: 10,000
- **Default input folder**: `../137docs`
- **Output directory**: `docs/folder_review/`
- **Default model**: `claude-sonnet-4-20250514`

## Usage

### Basic Usage

```bash
python claude_folder_review.py
```

### Custom Folder

```bash
python claude_folder_review.py /path/to/your/codebase
```

## Output Structure

The script generates files in the following format:

```
docs/folder_review/
‚îú‚îÄ‚îÄ folder_review_batch_01.md
‚îú‚îÄ‚îÄ folder_review_batch_02.md
‚îî‚îÄ‚îÄ folder_review_batch_XX.md
```

Each batch file contains:
- Batch number and timestamp
- Code organization analysis
- Bug pattern identification
- Architecture recommendations
- Modularization suggestions

## Error Handling

- **File Reading Errors**: Individual file failures don't stop the process
- **API Errors**: Batch failures are logged but don't terminate execution
- **Missing Files**: Graceful exit if no valid files are found

## Performance Considerations

- **Token Estimation**: Uses simple heuristic (may not be 100% accurate)
- **API Rate Limits**: Processes sequentially to avoid rate limiting
- **Memory Usage**: Loads files individually, not all at once

## Suggestions for Improvement

### üîß Potential Enhancements

1. **More Accurate Token Counting**: 
   ```python
   # Consider using tiktoken library for precise token counting
   import tiktoken
   ```

2. **Parallel Processing**: 
   - Add async support for faster batch processing
   - Implement proper rate limiting

3. **Configuration File**:
   ```yaml
   # config.yaml
   max_tokens_per_batch: 10000
   supported_extensions: [".py", ".js", ".ts"]
   exclude_patterns: ["test", "__pycache__"]
   ```

4. **Resume Capability**: 
   - Track completed batches
   - Allow resuming interrupted reviews

5. **Summary Generation**:
   - Create an aggregate report combining all batches
   - Generate executive summary

### ‚ö†Ô∏è Notes

- Requires valid Anthropic API key
- API costs scale with codebase size
- Token estimation is approximate
- Test files are automatically excluded
- Large codebases may require significant processing time

### üõ†Ô∏è Dependencies

```bash
pip install anthropic python-dotenv
```

Make sure to set up your `.env` file with the required API key before running the script.