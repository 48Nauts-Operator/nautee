<!-- Auto-generated by Claude on 2025-06-01 12:38 -->

# Claude Folder Review (Batched) Documentation

## Overview

This Python script provides an automated code review solution that uses Anthropic's Claude AI to analyze source code files in batches. The tool recursively scans a directory for source code files, groups them into manageable token-sized batches, and generates comprehensive markdown reviews for each batch.

## Purpose

- **Automated Code Review**: Leverage Claude AI to perform systematic code reviews
- **Batch Processing**: Handle large codebases by splitting files into ~10k token chunks
- **Documentation Generation**: Create organized markdown reports for review insights
- **Multi-language Support**: Support for various programming languages and file types

## Key Features

- Recursive directory scanning
- Intelligent file filtering and exclusion
- Token-based batching to optimize API usage
- Automatic markdown report generation
- Error handling and progress tracking

## Functions

### `is_excluded(filename: str) -> bool`

Determines whether a file should be excluded from the review process.

**Parameters:**
- `filename` (str): The file path to check

**Returns:**
- `bool`: True if the file should be excluded (test files), False otherwise

**Exclusion Criteria:**
- Files containing "test" in the name (case-insensitive)
- Files starting with "test_"
- Files in directories containing "test"

```python
# Examples of excluded files:
# - test_utils.py
# - /tests/test_main.py
# - utils_test.js
```

### `estimate_tokens(text: str) -> int`

Provides a rough estimation of token count for API rate limiting.

**Parameters:**
- `text` (str): Source code content

**Returns:**
- `int`: Estimated token count (uses 4 characters ≈ 1 token rule)

**Note:** This is a simplified estimation. Actual token counts may vary depending on the content structure.

### `main()`

The primary function that orchestrates the entire review process.

**Process Flow:**
1. **Setup**: Load environment variables and initialize Claude client
2. **File Discovery**: Recursively scan directory for valid source files
3. **Token Batching**: Group files into batches under the token limit
4. **API Processing**: Send batches to Claude for review
5. **Report Generation**: Save markdown reviews to disk

## Configuration

### Environment Variables

Create a `.env` file with the following variables:

```bash
ANTHROPIC_API_KEY=your_claude_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, defaults to this model
```

### Supported File Extensions

The script processes files with the following extensions:

- **Python**: `.py`
- **JavaScript/TypeScript**: `.js`, `.ts`, `.tsx`, `.jsx`
- **Web**: `.html`, `.css`
- **Configuration**: `.json`, `.yaml`, `.yml`
- **Other Languages**: `.go`, `.java`

## Usage

### Basic Usage

```bash
python claude_folder_review.py [folder_path]
```

### Examples

```bash
# Review current directory
python claude_folder_review.py .

# Review specific folder
python claude_folder_review.py /path/to/project

# Default behavior (reviews ../137docs)
python claude_folder_review.py
```

## Output Structure

The script generates review files in the `docs/folder_review/` directory:

```
docs/
└── folder_review/
    ├── folder_review_batch_01.md
    ├── folder_review_batch_02.md
    └── folder_review_batch_03.md
```

Each batch file contains:
- Batch number and timestamp
- Code organization analysis
- Bug pattern identification
- Architecture recommendations
- Modularization suggestions

## Configuration Options

| Setting | Default Value | Description |
|---------|---------------|-------------|
| `MAX_TOKENS` | 10,000 | Maximum tokens per batch |
| `output_root` | `"docs/folder_review"` | Output directory for reviews |
| `folder` | `"../137docs"` | Default folder to review |

## Error Handling

The script includes robust error handling for:

- **File Reading Errors**: Skips unreadable files and continues processing
- **API Errors**: Reports Claude API failures without stopping the entire process
- **Missing Files**: Validates file existence before processing

## Performance Considerations

- **Token Estimation**: Uses a 4:1 character-to-token ratio for estimation
- **Batch Processing**: Prevents API rate limiting by staying under token limits
- **Progress Tracking**: Provides real-time feedback on processing status

## Dependencies

```python
pip install anthropic python-dotenv
```

## Recommendations

### Best Practices

- **API Key Security**: Store your Anthropic API key in a `.env` file, never in code
- **Batch Size Tuning**: Adjust `MAX_TOKENS` based on your API limits and requirements
- **Regular Reviews**: Run the script periodically to track code quality over time

### Limitations

- **Token Estimation**: The 4:1 ratio is approximate; actual token usage may vary
- **File Type Support**: Limited to predefined extensions
- **Test File Exclusion**: Simple pattern matching may miss some test files

### Potential Improvements

- Add support for custom file extension lists
- Implement more sophisticated token counting
- Add configuration file support for batch sizes and exclusion patterns
- Include diff-based reviews for changed files only

## Troubleshooting

### Common Issues

1. **No API Key**: Ensure `ANTHROPIC_API_KEY` is set in your `.env` file
2. **No Files Found**: Check that your target directory contains supported file types
3. **API Rate Limits**: Reduce `MAX_TOKENS` if you encounter rate limiting issues