<!-- Auto-generated by Claude on 2025-06-01 09:28 -->

# Claude Folder Review (Batched) - Documentation

## Overview

This Python script provides automated code review functionality using Anthropic's Claude AI model. It recursively scans a directory for source code files, batches them into manageable chunks, and generates comprehensive code review documentation in Markdown format.

## Purpose

- **Automated Code Review**: Leverage Claude AI to analyze codebases and identify issues
- **Batch Processing**: Handle large codebases by splitting files into token-optimized batches
- **Documentation Generation**: Create structured Markdown reports for each batch
- **Selective Filtering**: Exclude test files and focus on core application code

## Key Features

- âœ… Recursive directory scanning
- âœ… Token-based batching (~10k tokens per batch)
- âœ… Multiple programming language support
- âœ… Automatic test file exclusion
- âœ… Timestamped output documentation
- âœ… Error handling and progress tracking

## Configuration

### Environment Variables

Create a `.env` file with the following variables:

```bash
ANTHROPIC_API_KEY=your_claude_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, defaults to this model
```

### Supported File Extensions

The script processes files with these extensions:
- **Python**: `.py`
- **JavaScript/TypeScript**: `.js`, `.ts`, `.tsx`, `.jsx`
- **Web**: `.html`, `.css`
- **Data**: `.json`, `.yaml`, `.yml`
- **Other Languages**: `.go`, `.java`

## Functions

### `is_excluded(filename: str) -> bool`

Determines whether a file should be excluded from review based on naming patterns.

**Parameters:**
- `filename` (str): Full file path to check

**Returns:**
- `bool`: `True` if file should be excluded (contains "test"), `False` otherwise

**Example:**
```python
is_excluded("/src/test_utils.py")     # Returns True
is_excluded("/src/main.py")           # Returns False
```

### `estimate_tokens(text: str) -> int`

Provides a rough estimate of token count for Claude API usage planning.

**Parameters:**
- `text` (str): Source code content

**Returns:**
- `int`: Estimated token count (using 4:1 character-to-token ratio)

**Note:** This is a simplified estimation. Actual token counts may vary.

## Usage

### Basic Usage

```bash
python claude_folder_review.py [folder_path]
```

### Examples

```bash
# Review current directory's parent folder
python claude_folder_review.py ../my_project

# Review specific folder
python claude_folder_review.py /path/to/codebase

# Use default folder (../137docs)
python claude_folder_review.py
```

## Output Structure

The script generates numbered batch files in the `docs/folder_review/` directory:

```
docs/folder_review/
â”œâ”€â”€ folder_review_batch_01.md
â”œâ”€â”€ folder_review_batch_02.md
â””â”€â”€ folder_review_batch_03.md
```

### Sample Output Format

```markdown
# ðŸ“¦ Folder Review Batch 1

_Last updated: 2024-01-15 14:30_

## Code Organization
- Well-structured module hierarchy
- Clear separation of concerns

## Identified Issues
- Missing error handling in utility functions
- Inconsistent naming conventions

## Recommendations
- Add type hints for better maintainability
- Consider refactoring large functions
```

## Technical Details

### Batching Strategy

- **Token Limit**: 10,000 tokens per batch
- **Processing**: Sequential batch processing to respect API rate limits
- **Optimization**: Files are grouped to maximize token usage efficiency

### Error Handling

- File reading errors are logged but don't stop execution
- API errors are captured per batch
- Progress indicators show successful completions

## Dependencies

```bash
pip install anthropic python-dotenv
```

## Limitations & Considerations

### Rate Limits
- Processes batches sequentially to avoid API rate limiting
- No built-in retry mechanism for failed API calls

### Token Estimation
- Uses simplified 4:1 character-to-token ratio
- Actual Claude tokenization may differ slightly

### File Size
- Very large individual files might exceed token limits
- Consider splitting large files manually if needed

## Suggestions for Enhancement

1. **Add retry logic** for failed API calls
2. **Implement parallel processing** with rate limiting
3. **Add configuration file** for custom file extensions and exclusion patterns
4. **Include summary report** combining all batch insights
5. **Add progress bar** for better user experience
6. **Support custom review prompts** via command line arguments

## Troubleshooting

### Common Issues

**No files found:**
- Check folder path exists
- Verify files have supported extensions
- Ensure files aren't all excluded as tests

**API errors:**
- Verify `ANTHROPIC_API_KEY` is set correctly
- Check API key permissions and usage limits
- Ensure model name is valid

**File reading errors:**
- Check file permissions
- Verify file encoding (script assumes UTF-8)