<!-- Auto-generated by Claude on 2025-06-22 17:18 -->

# Claude Folder Review (Batched) Documentation

## Overview

This Python script provides an automated code review system that uses Anthropic's Claude AI to analyze source code files in batches. The tool recursively scans a directory, groups files into token-optimized batches, and generates comprehensive Markdown reviews focusing on code organization, bug patterns, architecture, and improvement suggestions.

## Purpose

- **Automated Code Review**: Leverage AI to perform consistent code analysis across large codebases
- **Batch Processing**: Handle large projects by intelligently splitting files into manageable chunks
- **Documentation Generation**: Create structured Markdown reports for easy review and sharing
- **Multi-language Support**: Analyze various programming languages and file types

## Key Features

- âœ… Recursive directory scanning
- âœ… Intelligent token-based batching (~10k tokens per batch)
- âœ… Multi-language file support
- âœ… Test file exclusion
- âœ… Structured Markdown output
- âœ… Error handling and progress tracking

## Requirements

### Dependencies
```python
pip install anthropic python-dotenv
```

### Environment Variables
Create a `.env` file with:
```env
ANTHROPIC_API_KEY=your_claude_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, defaults to this model
```

## Core Functions

### `is_excluded(filename: str) -> bool`

Filters out test files from the review process.

**Parameters:**
- `filename`: File path to evaluate

**Returns:**
- `True` if file should be excluded (contains "test" patterns)
- `False` if file should be included

**Logic:**
- Excludes files with "test" in name (case-insensitive)
- Excludes files starting with "test_"
- Excludes files in "/test" or "\\test" directories

### `estimate_tokens(text: str) -> int`

Provides a rough token count estimation for API usage planning.

**Parameters:**
- `text`: Source code content

**Returns:**
- Estimated token count (text length Ã· 4)

**Note:** This is a simplified estimation. For production use, consider using a proper tokenizer.

## Usage

### Basic Usage
```bash
python claude_folder_review.py /path/to/source/folder
```

### Default Behavior
```bash
python claude_folder_review.py
# Uses default folder: "../137docs"
```

## Supported File Types

The script processes files with the following extensions:

- **Python**: `.py`
- **JavaScript/TypeScript**: `.js`, `.ts`, `.tsx`, `.jsx`
- **Web**: `.html`, `.css`
- **Data**: `.json`, `.yaml`, `.yml`
- **Other Languages**: `.go`, `.java`

## Output Structure

Reviews are saved to `docs/folder_review/` with the naming pattern:
```
docs/folder_review/folder_review_batch_01.md
docs/folder_review/folder_review_batch_02.md
...
```

Each file contains:
- Batch number and timestamp
- AI-generated review focusing on:
  - Code organization
  - Bug patterns
  - Architecture weaknesses
  - Modularization suggestions

## Configuration Options

### Batch Size
```python
MAX_TOKENS = 10000  # Adjust based on your needs and API limits
```

### Model Selection
Set via environment variable:
```env
ANTHROPIC_MODEL=claude-3-opus-20240229  # or your preferred model
```

### Output Directory
```python
output_root = "docs/folder_review"  # Modify as needed
```

## Error Handling

The script includes robust error handling for:
- Missing API keys
- File read errors
- API request failures
- Invalid directory paths

## Performance Considerations

- **Token Estimation**: Uses simple character-based estimation (Ã·4 rule)
- **Batch Processing**: Prevents API token limit violations
- **Progress Tracking**: Shows real-time processing status
- **Timing**: Reports total execution time

## Limitations & Suggestions

### Current Limitations
1. **Token Estimation**: Simplified estimation may not be perfectly accurate
2. **Language Detection**: File extension-based only
3. **Fixed Batch Size**: Not dynamically adjusted based on file complexity

### Suggested Improvements
1. **Enhanced Token Counting**: Integrate proper tokenizer (e.g., `tiktoken`)
2. **Configurable Exclusions**: Add config file for custom exclusion patterns
3. **Resume Capability**: Add ability to resume interrupted batch processing
4. **Summary Report**: Generate an overall summary across all batches
5. **Custom Prompts**: Allow customizable review focus areas

## Example Output Structure

```markdown
# ðŸ“¦ Folder Review Batch 01

_Last updated: 2024-01-15 14:30_

## Code Organization
- Well-structured module separation
- Clear naming conventions used consistently

## Potential Issues
- Missing error handling in file processing
- Hardcoded configuration values

## Recommendations
- Extract configuration to separate file
- Add comprehensive logging
- Implement retry logic for API calls
```

## Troubleshooting

### Common Issues
1. **No files found**: Check file extensions and exclusion patterns
2. **API errors**: Verify API key and model availability
3. **Permission errors**: Ensure read access to source directory and write access to output directory

### Debug Tips
- Check console output for file discovery count
- Verify `.env` file location and format
- Test with a smaller directory first