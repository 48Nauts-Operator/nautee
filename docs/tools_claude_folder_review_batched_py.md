<!-- Auto-generated by Claude on 2025-06-02 04:30 -->

# Claude Folder Review (Batched) Documentation

## Overview

This Python script performs automated code reviews of source code folders using Anthropic's Claude AI model. It processes files in batches to handle large codebases efficiently, splitting content into manageable chunks of approximately 10,000 tokens each.

## Purpose

- **Automated Code Review**: Leverages Claude AI to analyze source code files and provide structured feedback
- **Batch Processing**: Handles large codebases by splitting files into token-limited batches
- **Documentation Generation**: Creates Markdown reports for each batch with insights and recommendations

## Key Features

- Recursive folder scanning for source code files
- Intelligent file filtering (excludes test files)
- Token estimation and batch management
- Multiple programming language support
- Automated Markdown report generation

## Functions

### `is_excluded(filename: str) -> bool`

Determines whether a file should be excluded from the review process.

**Parameters:**
- `filename` (str): The file path to evaluate

**Returns:**
- `bool`: True if the file should be excluded (test files), False otherwise

**Exclusion Criteria:**
- Files containing "test" in the name (case-insensitive)
- Files starting with "test_"
- Files in directories containing "test"

### `estimate_tokens(text: str) -> int`

Provides a rough estimation of token count for Claude API usage.

**Parameters:**
- `text` (str): The source code content

**Returns:**
- `int`: Estimated token count (using 4 characters per token approximation)

### `main()`

The primary execution function that orchestrates the entire review process.

**Process Flow:**
1. **Setup**: Loads environment variables and initializes Claude client
2. **File Discovery**: Recursively scans for valid source files
3. **Token Batching**: Groups files into batches under 10k tokens
4. **Review Generation**: Sends batches to Claude and saves responses

## Configuration

### Environment Variables

```bash
ANTHROPIC_API_KEY=your_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, has default
```

### Supported File Extensions

- **Python**: `.py`
- **JavaScript/TypeScript**: `.js`, `.ts`, `.tsx`, `.jsx`
- **Web**: `.html`, `.css`
- **Data**: `.json`, `.yaml`, `.yml`
- **Other Languages**: `.go`, `.java`

## Usage

### Basic Usage

```bash
python script_name.py [folder_path]
```

### Examples

```bash
# Review default folder (../137docs)
python claude_folder_review.py

# Review specific folder
python claude_folder_review.py /path/to/your/codebase
```

## Output

The script generates individual Markdown files in the `docs/folder_review/` directory:

```
docs/folder_review/
├── folder_review_batch_01.md
├── folder_review_batch_02.md
└── folder_review_batch_03.md
```

Each file contains:
- Batch header with timestamp
- Code organization analysis
- Bug pattern identification
- Architecture recommendations
- Modularization suggestions

## Configuration Parameters

| Parameter | Default Value | Description |
|-----------|---------------|-------------|
| `MAX_TOKENS` | 10000 | Maximum tokens per batch |
| `output_root` | `docs/folder_review` | Output directory for reviews |
| `folder` | `../137docs` | Default input folder |

## Error Handling

- **File Reading Errors**: Logs errors and continues processing other files
- **API Errors**: Reports Claude API issues per batch but continues with remaining batches
- **Missing Files**: Exits gracefully if no valid files are found

## Notes and Suggestions

### Performance Considerations

- **Rate Limiting**: Consider adding delays between API calls for large batches
- **Token Accuracy**: The 4-character-per-token estimation is approximate; actual usage may vary

### Potential Improvements

1. **Add Configuration File**: Move hardcoded values to a config file
2. **Enhanced File Filtering**: Add more sophisticated exclusion patterns
3. **Progress Indicators**: Add progress bars for long-running operations
4. **Resume Capability**: Skip already processed batches on restart
5. **Language-Specific Prompts**: Tailor review prompts based on detected file types

### Security Notes

- Ensure your `.env` file is in `.gitignore`
- Be mindful of sending proprietary code to external APIs
- Consider using local models for sensitive codebases

## Dependencies

```python
anthropic>=0.7.0
python-dotenv>=1.0.0
```

Install with:
```bash
pip install anthropic python-dotenv
```