<!-- Auto-generated by Claude on 2025-06-23 09:25 -->

# Claude Folder Review (Batched) Documentation

## Overview

This Python script provides an automated code review system that uses Anthropic's Claude AI to analyze source code files in batches. The tool recursively scans a folder for source code files, groups them into manageable chunks based on token limits, and generates comprehensive Markdown reviews for each batch.

## Purpose

- **Automated Code Reviews**: Leverage Claude AI to perform systematic code reviews
- **Batch Processing**: Handle large codebases by splitting files into token-optimized batches
- **Documentation Generation**: Create structured Markdown reports for review insights
- **Multi-language Support**: Review various programming languages and file types

## Key Features

- ‚úÖ Recursive folder scanning
- ‚úÖ Intelligent file filtering (excludes test files)
- ‚úÖ Token-based batching (~10k tokens per batch)
- ‚úÖ Multi-format support (Python, JavaScript, TypeScript, etc.)
- ‚úÖ Structured Markdown output
- ‚úÖ Error handling and progress tracking

## Installation & Setup

### Prerequisites

```bash
pip install anthropic python-dotenv
```

### Environment Configuration

Create a `.env` file in your project root:

```env
ANTHROPIC_API_KEY=your_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, defaults to this model
```

## Usage

### Basic Usage

```bash
python claude_folder_review.py /path/to/your/codebase
```

### Default Folder

If no folder is specified, it defaults to `../137docs`:

```bash
python claude_folder_review.py
```

## Core Functions

### `is_excluded(filename: str) -> bool`

Filters out test files from the review process.

**Parameters:**
- `filename`: Full file path to evaluate

**Returns:**
- `bool`: True if file should be excluded

**Exclusion Criteria:**
- Files containing "test" in the name
- Files starting with "test_"
- Files in "/test" or "\\test" directories

### `estimate_tokens(text: str) -> int`

Provides a rough estimation of token count for batching purposes.

**Parameters:**
- `text`: Source code content

**Returns:**
- `int`: Estimated token count (text length √∑ 4)

> **Note**: This is a simplified estimation. For production use, consider using a more accurate tokenizer.

### `main()`

The primary orchestration function that handles:

1. **Environment Setup**: Loads API credentials and configuration
2. **File Discovery**: Recursively finds valid source files
3. **Token Batching**: Groups files into ~10k token batches
4. **AI Processing**: Sends batches to Claude for review
5. **Output Generation**: Creates timestamped Markdown reports

## Supported File Types

The script processes files with the following extensions:

- **Python**: `.py`
- **JavaScript/TypeScript**: `.js`, `.ts`, `.tsx`, `.jsx`
- **Web**: `.html`, `.css`
- **Configuration**: `.json`, `.yaml`, `.yml`
- **Other Languages**: `.go`, `.java`

## Output Structure

Reviews are saved in the `docs/folder_review/` directory with the following format:

```
docs/folder_review/
‚îú‚îÄ‚îÄ folder_review_batch_01.md
‚îú‚îÄ‚îÄ folder_review_batch_02.md
‚îî‚îÄ‚îÄ ...
```

Each file contains:
- Batch number and timestamp
- Code organization analysis  
- Bug pattern identification
- Architecture assessments
- Improvement suggestions

## Configuration Options

| Variable | Default | Description |
|----------|---------|-------------|
| `MAX_TOKENS` | 10000 | Maximum tokens per batch |
| `output_root` | `docs/folder_review` | Output directory |
| `model` | `claude-sonnet-4-20250514` | Claude model version |

## Error Handling

The script includes robust error handling for:

- **File Reading Errors**: Skips unreadable files with error logging
- **API Failures**: Continues processing remaining batches
- **Missing Dependencies**: Clear error messages for setup issues

## Suggestions & Improvements

### Performance Optimizations

- **Parallel Processing**: Consider using `asyncio` for concurrent API calls
- **Token Estimation**: Implement more accurate tokenization using `tiktoken`
- **Caching**: Add file hash-based caching to avoid re-reviewing unchanged files

### Feature Enhancements

```python
# Potential configuration additions
CUSTOM_EXCLUSIONS = [".git", "node_modules", "__pycache__"]
REVIEW_FOCUS = ["security", "performance", "maintainability"]
OUTPUT_FORMAT = "markdown"  # Could support JSON, HTML
```

### Usage Tips

1. **Large Codebases**: Monitor API usage and costs for extensive reviews
2. **Custom Prompts**: Modify the review prompt to focus on specific concerns
3. **Integration**: Consider integrating with CI/CD pipelines for automated reviews
4. **Follow-up**: Use generated reviews as starting points for team discussions

## Example Output

The tool generates reviews focusing on:

- üèóÔ∏è **Code Organization**: Module structure and separation of concerns
- üêõ **Bug Patterns**: Common issues and potential vulnerabilities  
- üèõÔ∏è **Architecture**: Design patterns and system structure
- üí° **Suggestions**: Specific improvements for modularity and clarity

This makes it an excellent tool for code audits, onboarding new team members, or preparing for refactoring efforts.