<!-- Auto-generated by Claude on 2025-05-31 20:31 -->

# Code Folder Review Script

## Overview

This Python script provides automated code review functionality using Anthropic's Claude AI model. It analyzes entire folders of source code files, batches them appropriately to respect API token limits, and generates detailed code review reports in Markdown format.

## Purpose

- **Automated Code Review**: Leverages Claude AI to perform comprehensive code analysis
- **Batch Processing**: Intelligently groups files to stay within API token limits (~10k tokens per batch)
- **Multi-language Support**: Reviews various file types including Python, JavaScript, TypeScript, HTML, CSS, and more
- **Organized Output**: Generates timestamped Markdown reports for each batch

## Key Features

### File Discovery and Filtering
- Recursively scans target directories for source code files
- Supports multiple file extensions
- Automatically excludes test files to focus on main codebase

### Intelligent Batching
- Estimates token usage to optimize API calls
- Groups files into batches under 10,000 token limit
- Handles large codebases efficiently

### AI-Powered Analysis
- Uses Claude AI for senior-level code review
- Focuses on architecture, organization, and improvement suggestions
- Generates actionable insights in Markdown format

## Configuration

### Environment Variables
```bash
ANTHROPIC_API_KEY=your_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, defaults to specified model
```

### Supported File Types
```python
valid_exts = (".py", ".js", ".ts", ".tsx", ".jsx", ".html", ".css", ".json", ".go", ".java", ".yaml", ".yml")
```

## Usage

### Basic Usage
```bash
python code_review_script.py /path/to/your/code/folder
```

### Default Folder
```bash
python code_review_script.py  # Uses "../137docs" as default
```

## Key Functions

### `is_excluded(filename)`
- **Purpose**: Filters out test files from review
- **Logic**: Excludes files containing "test" in name or path
- **Returns**: Boolean indicating if file should be excluded

### `estimate_tokens(text)`
- **Purpose**: Estimates token count for API planning
- **Formula**: `len(text) / 4` (rough approximation)
- **Usage**: Helps batch files within token limits

## Output Structure

### File Organization
```
output/folder_review/
├── batch_01_2025-05-31T14-30-25.md
├── batch_02_2025-05-31T14-31-02.md
└── batch_03_2025-05-31T14-31-35.md
```

### Review Focus Areas
- **Code Organization**: Structure and modularity analysis
- **Bug Patterns**: Identification of potential issues
- **Architecture Weaknesses**: High-level design concerns
- **Improvement Suggestions**: Actionable recommendations

## Dependencies

```python
import os
import sys
import anthropic
from dotenv import load_dotenv
from datetime import datetime
import time
```

### Required Packages
- `anthropic`: Claude AI API client
- `python-dotenv`: Environment variable management

## Error Handling

- **File Reading Errors**: Continues processing other files if individual files fail
- **API Errors**: Reports Claude API failures per batch
- **Empty Directory**: Exits gracefully if no valid files found

## Performance Features

- **Progress Tracking**: Shows batch processing progress
- **Timing**: Reports total execution time
- **Token Management**: Prevents API limit violations

## Notes and Suggestions

### Best Practices
- Ensure your `ANTHROPIC_API_KEY` is properly set in your environment
- Review the `valid_exts` list to match your project's file types
- Consider adjusting `MAX_TOKENS` based on your API tier limits

### Potential Improvements
- Add configuration file support for customizable settings
- Implement parallel processing for faster execution
- Add support for custom exclusion patterns
- Include summary report across all batches

### Limitations
- Token estimation is approximate and may not be perfectly accurate
- Large individual files might exceed token limits
- Test file exclusion logic is basic pattern matching

## Example Output

The generated reports include structured analysis like:

```markdown
## Code Organization
- Well-structured module separation
- Clear naming conventions

## Bug Patterns
- Missing error handling in file operations
- Potential race conditions in concurrent operations

## Architecture Weaknesses
- Tight coupling between components
- Limited abstraction layers

## Suggestions
- Implement proper exception handling
- Consider using design patterns for better modularity
```