<!-- Auto-generated by Claude on 2025-06-02 06:37 -->

# Claude Folder Review (Batched) Documentation

## Overview

This Python script provides automated code review functionality using Anthropic's Claude AI model. It recursively scans a source code folder, batches files by token count, and generates comprehensive markdown reviews for each batch.

## Purpose

- **Automated Code Review**: Leverages Claude AI to analyze codebases and provide insights
- **Batch Processing**: Handles large codebases by splitting files into manageable token-sized chunks
- **Documentation Generation**: Creates structured markdown reports for easy review and sharing
- **Multi-language Support**: Supports various programming languages and file types

## Key Features

- Recursive folder scanning with file filtering
- Token-based batching to optimize API usage
- Exclusion of test files to focus on production code
- Error handling for file reading and API calls
- Timestamped output files for tracking reviews

## Functions

### `is_excluded(filename: str) -> bool`

Filters out test files from the review process.

**Parameters:**
- `filename` (str): Full file path to evaluate

**Returns:**
- `bool`: `True` if file should be excluded, `False` otherwise

**Exclusion Criteria:**
- Files containing "test" in the name (case-insensitive)
- Files starting with "test_"
- Files in directories containing "test"

### `estimate_tokens(text: str) -> int`

Provides a rough estimation of token count for API rate limiting.

**Parameters:**
- `text` (str): Source code content

**Returns:**
- `int`: Estimated token count (using 4:1 character-to-token ratio)

### `main()`

Main execution function that orchestrates the entire review process:

1. **Setup Phase**: Loads environment variables and initializes Claude client
2. **File Discovery**: Recursively finds valid source files
3. **Token Batching**: Groups files into ~10k token batches
4. **Review Generation**: Processes each batch through Claude API
5. **Output Creation**: Saves markdown reviews to disk

## Configuration

### Environment Variables

Create a `.env` file with the following variables:

```bash
ANTHROPIC_API_KEY=your_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, has default
```

### Supported File Extensions

```python
valid_exts = (
    ".py", ".js", ".ts", ".tsx", ".jsx", 
    ".html", ".css", ".json", ".go", 
    ".java", ".yaml", ".yml"
)
```

## Usage

### Basic Usage

```bash
python claude_folder_review.py /path/to/your/codebase
```

### Default Folder

If no path is provided, it defaults to `../137docs`:

```bash
python claude_folder_review.py
```

## Output Structure

Reviews are saved to `docs/folder_review/` with the following naming convention:

```
docs/folder_review/
├── folder_review_batch_01.md
├── folder_review_batch_02.md
└── folder_review_batch_XX.md
```

Each file contains:
- Batch number and timestamp
- Code organization analysis
- Bug pattern identification
- Architecture recommendations
- Modularization suggestions

## Review Focus Areas

The script instructs Claude to analyze:

- **Code Organization**: Structure and file organization patterns
- **Bug Patterns**: Common issues and potential problems
- **Architecture Weaknesses**: Design flaws and improvement opportunities
- **Modularization**: Suggestions for better code separation and clarity

## Performance Considerations

### Token Management
- **Batch Size**: ~10,000 tokens per batch to optimize API usage
- **Rate Limiting**: Processes batches sequentially to avoid API limits
- **Memory Efficiency**: Processes files in chunks rather than loading entire codebase

### Error Handling
- Graceful handling of unreadable files
- API error recovery with detailed error messages
- Continues processing remaining batches if individual batches fail

## Suggestions and Best Practices

### Before Running
1. **API Key Setup**: Ensure your Anthropic API key is properly configured
2. **Folder Structure**: Organize your codebase with clear directory structure
3. **File Cleanup**: Remove unnecessary files that might skew the review

### After Running
1. **Review Analysis**: Carefully read through each batch review
2. **Action Items**: Extract specific recommendations for implementation
3. **Follow-up**: Re-run reviews after making significant changes

### Customization Options
- **Add File Types**: Extend `valid_exts` tuple for additional languages
- **Adjust Batch Size**: Modify `MAX_TOKENS` based on your needs
- **Custom Exclusions**: Enhance `is_excluded()` function for specific filtering needs
- **Review Focus**: Modify the prompt to target specific analysis areas

## Error Messages

| Message | Meaning | Action |
|---------|---------|---------|
| `❌ No valid files found` | No supported files in directory | Check path and file extensions |
| `[ERR] ❌ Error reading` | File access issues | Check file permissions |
| `❌ Claude API error` | API communication failure | Verify API key and connection |

## Dependencies

```python
anthropic  # Claude AI API client
python-dotenv  # Environment variable management
```

Install with:
```bash
pip install anthropic python-dotenv
```