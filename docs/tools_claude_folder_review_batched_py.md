<!-- Auto-generated by Claude on 2025-06-22 13:27 -->

# Claude Folder Review (Batched) - Documentation

## Overview

This Python script provides an automated code review solution that uses Anthropic's Claude AI to analyze source code files in batches. The tool recursively scans a directory, groups files into manageable token-sized batches, and generates comprehensive Markdown reviews for each batch.

## Purpose

- **Automated Code Review**: Leverage Claude AI to perform intelligent code analysis
- **Batch Processing**: Handle large codebases by splitting files into ~10k token chunks
- **Documentation Generation**: Create structured Markdown reports for review insights
- **Multi-Language Support**: Review various file types including Python, JavaScript, TypeScript, and more

## Key Features

- **Smart File Filtering**: Automatically excludes test files and supports multiple programming languages
- **Token Management**: Intelligently batches files to stay within API token limits
- **Error Handling**: Robust error handling for file reading and API communication
- **Structured Output**: Generates timestamped Markdown reports for each batch

## Functions

### `is_excluded(filename: str) -> bool`

Determines whether a file should be excluded from the review process.

**Parameters:**
- `filename` (str): The file path to evaluate

**Returns:**
- `bool`: True if the file should be excluded (test files), False otherwise

**Logic:**
- Excludes files containing "test" in the name or path
- Case-insensitive matching
- Handles both Unix and Windows path separators

### `estimate_tokens(text: str) -> int`

Provides a rough estimation of token count for API planning.

**Parameters:**
- `text` (str): The source code content

**Returns:**
- `int`: Estimated token count (using 4 characters per token approximation)

### `main()`

The primary orchestration function that handles the entire review process.

**Key Operations:**
1. **Environment Setup**: Loads API credentials and configuration
2. **File Discovery**: Recursively finds valid source files
3. **Token Batching**: Groups files into manageable chunks
4. **AI Processing**: Sends batches to Claude for review
5. **Report Generation**: Saves structured Markdown output

## Configuration

### Environment Variables

```bash
ANTHROPIC_API_KEY=your_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, defaults to specified model
```

### Supported File Extensions

- **Python**: `.py`
- **JavaScript/TypeScript**: `.js`, `.ts`, `.tsx`, `.jsx`
- **Web**: `.html`, `.css`
- **Data**: `.json`, `.yaml`, `.yml`
- **Other Languages**: `.go`, `.java`

## Usage

### Command Line

```bash
# Review default folder (../137docs)
python claude_folder_review.py

# Review specific folder
python claude_folder_review.py /path/to/your/codebase
```

### Output Structure

```
docs/folder_review/
‚îú‚îÄ‚îÄ folder_review_batch_01.md
‚îú‚îÄ‚îÄ folder_review_batch_02.md
‚îî‚îÄ‚îÄ folder_review_batch_03.md
```

Each batch file contains:
- **Header**: Batch number and timestamp
- **Review Content**: Claude's analysis focusing on:
  - Code organization
  - Bug patterns
  - Architecture weaknesses
  - Modularization suggestions

## Technical Specifications

### Token Management
- **Maximum Batch Size**: 10,000 tokens
- **Estimation Method**: 4 characters per token approximation
- **API Response Limit**: 2,000 tokens per response

### Error Handling
- File reading errors are logged but don't stop processing
- API errors are caught and reported per batch
- Invalid file paths are handled gracefully

## Dependencies

```python
anthropic>=0.3.0
python-dotenv>=0.19.0
```

## Notes and Suggestions

### ‚ö†Ô∏è Important Considerations

1. **API Costs**: Monitor your Anthropic API usage as large codebases can generate significant costs
2. **Rate Limits**: The script doesn't implement rate limiting - consider adding delays for large batches
3. **Token Estimation**: The 4-character approximation may not be accurate for all content types

### üîß Potential Improvements

1. **Add Rate Limiting**: Implement delays between API calls to avoid rate limits
2. **Better Token Estimation**: Use a more sophisticated tokenization method
3. **Configuration File**: Support for `.config` files instead of just environment variables
4. **Resume Capability**: Add ability to resume interrupted batch processing
5. **Summary Report**: Generate an overall summary combining all batch insights

### üí° Usage Tips

- Start with smaller folders to test API costs and output quality
- Review the generated Markdown files to understand Claude's analysis patterns
- Consider excluding additional file types or directories based on your needs
- Use the timestamp information to track review history over time

## Example Output Preview

```markdown
# üì¶ Folder Review Batch 1

_Last updated: 2024-01-15 14:30_

## Code Organization
The codebase shows good separation of concerns with clear module boundaries...

## Bug Patterns
Several potential issues were identified:
- Missing error handling in file operations
- Inconsistent input validation...
```