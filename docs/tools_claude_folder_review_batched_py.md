<!-- Auto-generated by Claude on 2025-06-01 10:20 -->

# Claude Folder Review (Batched) Documentation

## Overview

This Python script provides automated code review functionality using Anthropic's Claude AI. It recursively scans a folder for source code files, intelligently batches them based on token limits, and generates comprehensive markdown reviews for each batch.

## Purpose

- **Automated Code Review**: Leverages Claude AI to analyze source code and provide architectural insights
- **Batch Processing**: Handles large codebases by splitting files into manageable chunks (~10k tokens each)
- **Documentation Generation**: Creates organized markdown reports for code review findings
- **Multi-language Support**: Reviews various file types including Python, JavaScript, TypeScript, Go, Java, and more

## Key Features

### File Discovery and Filtering
- Recursively scans directories for source code files
- Automatically excludes test files to focus on production code
- Supports multiple programming languages and configuration files

### Intelligent Batching
- Estimates token count to stay within Claude's API limits
- Groups files into batches of approximately 10,000 tokens
- Prevents API errors due to oversized requests

### Review Generation
- Focuses on code organization, bug patterns, and architecture
- Generates actionable suggestions for improvement
- Creates timestamped markdown reports for each batch

## Important Functions

### `is_excluded(filename: str) -> bool`
Determines whether a file should be excluded from review based on naming patterns.

**Parameters:**
- `filename`: Full path or name of the file to check

**Returns:**
- `bool`: True if the file should be excluded (test files), False otherwise

**Usage:**
```python
if not is_excluded(full_path):
    files.append(full_path)
```

### `estimate_tokens(text: str) -> int`
Provides a rough estimation of token count for API planning.

**Parameters:**
- `text`: Source code content to analyze

**Returns:**
- `int`: Estimated token count (using 4 characters per token approximation)

**Note:** This is a simplified estimation. For production use, consider using more accurate tokenization libraries.

### `main()`
The primary orchestration function that handles the complete workflow:

1. **Setup Phase**: Loads environment variables and initializes Claude client
2. **File Discovery**: Scans directory structure for valid source files
3. **Batch Creation**: Groups files into token-appropriate batches
4. **Review Generation**: Sends batches to Claude and saves markdown reports

## Configuration

### Environment Variables
Create a `.env` file with the following variables:

```env
ANTHROPIC_API_KEY=your_claude_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, has default
```

### Supported File Extensions
```python
valid_exts = (
    ".py", ".js", ".ts", ".tsx", ".jsx", 
    ".html", ".css", ".json", ".go", 
    ".java", ".yaml", ".yml"
)
```

## Usage

### Basic Usage
```bash
python claude_folder_review.py /path/to/your/codebase
```

### Default Folder
If no folder is specified, it defaults to `../137docs`:
```bash
python claude_folder_review.py
```

## Output Structure

The script creates a `docs/folder_review/` directory containing:

```
docs/folder_review/
├── folder_review_batch_01.md
├── folder_review_batch_02.md
└── folder_review_batch_XX.md
```

Each batch file includes:
- Batch number and timestamp
- Code organization analysis
- Bug pattern identification
- Architecture recommendations
- Modularization suggestions

## Error Handling

The script includes robust error handling for:
- **File Reading Errors**: Continues processing if individual files can't be read
- **API Errors**: Reports Claude API failures while continuing with remaining batches
- **Missing Files**: Validates folder existence and file discovery

## Suggestions and Notes

### Performance Considerations
- **Rate Limiting**: Consider adding delays between API calls for large codebases
- **Token Accuracy**: The current token estimation is approximate; consider using `tiktoken` for precise counting
- **Parallel Processing**: For very large codebases, consider implementing concurrent batch processing

### Security Recommendations
- Store API keys securely using environment variables or secure key management
- Avoid committing sensitive code to review systems
- Consider data privacy implications when sending code to external APIs

### Enhancement Opportunities
```python
# Potential improvements:
# 1. Add progress bars for long-running operations
# 2. Implement retry logic for failed API calls
# 3. Add configuration file support for custom file extensions
# 4. Include file change detection to avoid re-reviewing unchanged code
```

### Usage Tips
- **Large Codebases**: For repositories with 100+ files, expect processing times of 10-30 minutes
- **Review Quality**: Claude provides better insights when batch sizes are balanced (not too small or large)
- **Follow-up**: Use the generated reviews as starting points for manual code review sessions

## Dependencies

```bash
pip install anthropic python-dotenv
```

## Exit Codes
- `0`: Successful completion
- `1`: No valid files found in specified directory