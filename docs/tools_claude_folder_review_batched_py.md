<!-- Auto-generated by Claude on 2025-06-07 22:18 -->

# Claude Folder Review (Batched) Documentation

## Overview

This Python script provides an automated code review solution that analyzes source code files in a folder using Claude AI. The script intelligently batches files to work within token limits and generates comprehensive Markdown-formatted reviews for each batch.

## Purpose

- **Automated Code Review**: Leverage Claude AI to review codebases for architecture, bugs, and improvements
- **Batch Processing**: Handle large codebases by splitting files into manageable chunks (~10k tokens each)
- **Documentation Generation**: Create structured Markdown reports for each batch of reviewed files
- **Multi-language Support**: Review various file types including Python, JavaScript, TypeScript, HTML, CSS, and more

## Key Features

### File Discovery and Filtering
- Recursively scans directories for source code files
- Filters out test files automatically
- Supports multiple programming languages and file formats

### Intelligent Batching
- Estimates token usage to stay within API limits
- Groups files into batches of ~10,000 tokens
- Prevents API failures due to context length restrictions

### Structured Output
- Generates timestamped Markdown reports
- Organizes reviews by batch for easy navigation
- Provides clear progress indicators during processing

## Important Functions

### `is_excluded(filename: str) -> bool`

Determines whether a file should be excluded from review based on naming patterns.

**Parameters:**
- `filename`: Path or name of the file to check

**Returns:**
- `bool`: True if the file should be excluded (test files), False otherwise

**Logic:**
- Excludes files containing "test" in the name
- Excludes files starting with "test_"
- Excludes files in test directories

```python
# Examples of excluded files:
# - test_utils.py
# - /tests/test_main.py  
# - TestClass.js
```

### `estimate_tokens(text: str) -> int`

Provides a rough estimate of token count for API usage planning.

**Parameters:**
- `text`: Source code content as string

**Returns:**
- `int`: Estimated token count (uses 4 characters ≈ 1 token rule)

**Note:** This is a simplified estimation. Actual token counts may vary based on Claude's tokenization.

## Configuration

### Environment Variables

The script requires the following environment variables (typically stored in `.env`):

```bash
ANTHROPIC_API_KEY=your_claude_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, defaults to specified model
```

### Supported File Extensions

```python
valid_exts = (
    ".py", ".js", ".ts", ".tsx", ".jsx", 
    ".html", ".css", ".json", ".go", 
    ".java", ".yaml", ".yml"
)
```

## Usage

### Basic Usage

```bash
python claude_folder_review.py /path/to/your/codebase
```

### Default Behavior

```bash
python claude_folder_review.py
# Reviews "../137docs" folder by default
```

## Output Structure

Reviews are saved in the `docs/folder_review/` directory with the following format:

```
docs/folder_review/
├── folder_review_batch_01.md
├── folder_review_batch_02.md
└── folder_review_batch_03.md
```

Each file contains:
- Batch number and timestamp
- Structured review focusing on:
  - Code organization
  - Bug patterns  
  - Architecture weaknesses
  - Modularization suggestions

## Dependencies

```python
# Required packages
anthropic      # Claude AI API client
python-dotenv  # Environment variable management
```

Install with:
```bash
pip install anthropic python-dotenv
```

## Performance Considerations

### Token Management
- **Batch Size**: ~10,000 tokens per batch to stay within API limits
- **Estimation**: Uses 4:1 character-to-token ratio for planning
- **Error Handling**: Continues processing if individual files fail to read

### Rate Limiting
- Processes batches sequentially to respect API rate limits
- Includes error handling for API failures
- Displays progress indicators for long-running operations

## Suggestions and Best Practices

### Before Running
1. **Verify API Key**: Ensure your Anthropic API key is properly configured
2. **Check Folder Structure**: Review the target folder for sensitive files
3. **Backup Important Data**: While the script is read-only, always backup before bulk operations

### Optimization Tips
- **Large Codebases**: Consider running on subfolders first to test output quality
- **File Filtering**: Modify `valid_exts` to include/exclude specific file types
- **Custom Exclusions**: Extend `is_excluded()` function for project-specific needs

### Output Review
- **Batch Organization**: Reviews are split by batch, not by logical code modules
- **Cross-References**: Consider consolidating findings across batches for overall insights
- **Action Items**: Extract specific recommendations into separate tracking documents

## Error Handling

The script includes robust error handling for:
- **File Access**: Continues processing if individual files can't be read
- **API Failures**: Reports errors but continues with remaining batches  
- **Missing Dependencies**: Clear error messages for setup issues
- **Invalid Paths**: Validates folder existence and file discovery

## Limitations

- **Context Separation**: Files are batched by size, not logical grouping
- **Token Estimation**: Rough approximation may not match actual Claude tokenization
- **Language Detection**: Relies on file extensions, not content analysis
- **Review Depth**: Limited by batch size and API response length constraints