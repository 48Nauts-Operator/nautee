<!-- Auto-generated by Claude on 2025-06-08 06:34 -->

# Claude Folder Review (Batched) Script Documentation

## Overview

The `claude_folder_review.py` script is an automated code review tool that uses Claude AI to analyze source code files in batches. It recursively scans a folder for source code files, splits them into manageable chunks based on token limits, and generates detailed markdown reviews for each batch.

## Purpose

- **Automated Code Review**: Leverages Claude AI to provide architectural insights and code quality feedback
- **Batch Processing**: Handles large codebases by splitting files into token-optimized batches
- **Documentation Generation**: Creates structured markdown reports for each review batch

## Key Features

- Recursive folder scanning with file type filtering
- Automatic test file exclusion
- Token-based batching to respect API limits
- Markdown-formatted review generation
- Error handling and progress tracking

## Functions

### `is_excluded(filename: str) -> bool`

Filters out test files from the review process.

**Parameters:**
- `filename`: Path or name of the file to check

**Returns:**
- `True` if the file should be excluded (contains "test" patterns)

**Usage:**
```python
if not is_excluded(full_path):
    files.append(full_path)
```

### `estimate_tokens(text: str) -> int`

Provides a rough token count estimate for API planning.

**Parameters:**
- `text`: Source code content

**Returns:**
- Estimated token count (using 4:1 character-to-token ratio)

**Note:** This is a simplified estimation. For production use, consider using a proper tokenizer.

### `main()`

The primary orchestration function that handles:
- Environment setup and API client initialization
- File discovery and filtering
- Batch creation based on token limits
- Claude API interactions
- Review file generation

## Configuration

### Environment Variables

Create a `.env` file with the following variables:

```env
ANTHROPIC_API_KEY=your_claude_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514
```

### Supported File Types

The script processes files with these extensions:
- **Python**: `.py`
- **JavaScript/TypeScript**: `.js`, `.ts`, `.tsx`, `.jsx`
- **Web**: `.html`, `.css`
- **Data**: `.json`, `.yaml`, `.yml`
- **Other**: `.go`, `.java`

## Usage

### Basic Usage
```bash
python claude_folder_review.py /path/to/source/folder
```

### Default Folder
```bash
python claude_folder_review.py
# Uses "../137docs" as default
```

## Output Structure

Reviews are saved to `docs/folder_review/` with the following naming pattern:
```
docs/folder_review/
├── folder_review_batch_01.md
├── folder_review_batch_02.md
└── folder_review_batch_03.md
```

Each review file contains:
- Batch header with timestamp
- Code organization analysis
- Bug pattern identification
- Architecture recommendations
- Modularization suggestions

## Configuration Constants

| Constant | Value | Purpose |
|----------|-------|---------|
| `MAX_TOKENS` | 10,000 | Maximum tokens per batch |
| `output_root` | "docs/folder_review" | Output directory |
| `valid_exts` | Multiple extensions | Supported file types |

## Error Handling

The script includes robust error handling for:
- Missing or invalid files
- API connection issues
- File reading permissions
- Empty folder scenarios

## Performance Considerations

- **Token Batching**: Prevents API limit exceeded errors
- **Progress Tracking**: Shows real-time processing status
- **Time Tracking**: Reports total execution time

## Suggestions for Improvement

### 1. Enhanced Token Estimation
```python
# Consider using tiktoken for accurate token counting
import tiktoken
encoding = tiktoken.get_encoding("cl100k_base")
tokens = len(encoding.encode(text))
```

### 2. Configuration File Support
Add support for a config file to customize:
- File extensions
- Exclusion patterns
- Batch sizes
- Output formats

### 3. Parallel Processing
For large codebases, consider implementing concurrent batch processing:
```python
import asyncio
import aiofiles
# Implement async batch processing
```

### 4. Review Aggregation
Add a summary generation feature that combines insights from all batches into a single overview document.

## Dependencies

- `anthropic`: Claude AI API client
- `python-dotenv`: Environment variable management
- `os`, `sys`, `time`, `datetime`: Standard library modules

## Installation

```bash
pip install anthropic python-dotenv
```

## Notes

- Ensure your Claude API key has sufficient credits for large codebases
- The script creates output directories automatically
- Test files are excluded by default to focus on production code
- Review quality depends on the Claude model version used