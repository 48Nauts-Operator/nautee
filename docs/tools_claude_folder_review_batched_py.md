<!-- Auto-generated by Claude on 2025-06-08 03:24 -->

# Claude Folder Review (Batched) Documentation

## Overview

This Python script provides an automated code review system that uses Anthropic's Claude AI to analyze source code files in batches. The tool recursively scans a specified folder, groups files into manageable chunks based on token limits, and generates detailed markdown reviews for each batch.

## Purpose

- **Automated Code Review**: Leverage Claude AI to perform comprehensive code analysis
- **Batch Processing**: Handle large codebases by splitting files into ~10k token chunks
- **Documentation Generation**: Create structured markdown reports for each batch
- **Scalable Analysis**: Process multiple file types across entire project directories

## Key Features

- Recursive folder scanning with file type filtering
- Intelligent token-based batching to stay within API limits
- Exclusion of test files to focus on production code
- Timestamped markdown output for tracking review history

## Functions and Classes

### `is_excluded(filename: str) -> bool`

Determines whether a file should be excluded from the review process.

**Parameters:**
- `filename` (str): The file path to evaluate

**Returns:**
- `bool`: True if the file should be excluded (test files), False otherwise

**Logic:**
- Excludes files containing "test" in the filename
- Excludes files starting with "test_"
- Excludes files in test directories

### `estimate_tokens(text: str) -> int`

Provides a rough estimation of token count for API rate limiting.

**Parameters:**
- `text` (str): The source code content

**Returns:**
- `int`: Estimated token count (uses 4 characters per token approximation)

**Note:** This is a simplified estimation. For production use, consider integrating a proper tokenizer.

### `main()`

The primary execution function that orchestrates the entire review process.

#### Workflow:

1. **Setup Phase**
   ```python
   load_dotenv()
   client = anthropic.Anthropic(api_key=os.getenv("ANTHROPIC_API_KEY"))
   ```

2. **File Discovery**
   - Recursively scans the target folder
   - Filters by supported file extensions
   - Excludes test files

3. **Token Batching**
   - Groups files to stay under 10,000 token limit
   - Prevents API request failures due to size limits

4. **Review Generation**
   - Sends batches to Claude API
   - Generates structured markdown reviews
   - Saves timestamped output files

## Configuration

### Environment Variables

| Variable | Description | Default |
|----------|-------------|---------|
| `ANTHROPIC_API_KEY` | Your Anthropic API key | Required |
| `ANTHROPIC_MODEL` | Claude model to use | `claude-sonnet-4-20250514` |

### Supported File Types

```python
valid_exts = (".py", ".js", ".ts", ".tsx", ".jsx", ".html", ".css", ".json", ".go", ".java", ".yaml", ".yml")
```

## Usage

### Basic Usage
```bash
python claude_folder_review.py
```
*Reviews the default `../137docs` folder*

### Custom Folder
```bash
python claude_folder_review.py /path/to/your/project
```

### Output Structure
```
docs/folder_review/
‚îú‚îÄ‚îÄ folder_review_batch_01.md
‚îú‚îÄ‚îÄ folder_review_batch_02.md
‚îî‚îÄ‚îÄ folder_review_batch_03.md
```

## Review Focus Areas

The AI reviewer analyzes code for:

- **Code Organization**: Structure and modularity assessment
- **Bug Patterns**: Common error-prone patterns
- **Architecture Weaknesses**: Design and scalability issues  
- **Improvement Suggestions**: Refactoring and clarity recommendations

## Requirements

### Dependencies
```python
pip install anthropic python-dotenv
```

### Setup Steps
1. Install required packages
2. Create `.env` file with your Anthropic API key:
   ```
   ANTHROPIC_API_KEY=your_api_key_here
   ```
3. Run the script with your target folder

## Notes and Suggestions

### ‚ö†Ô∏è Important Considerations

- **API Costs**: Each batch makes an API call to Claude - monitor usage for large codebases
- **Token Estimation**: The current token estimation is approximate; consider using tiktoken for accuracy
- **Rate Limiting**: No built-in rate limiting - add delays for very large projects
- **Error Handling**: Failed batches are logged but don't stop the entire process

### üîß Potential Improvements

1. **Enhanced Token Counting**: Integrate proper tokenization library
2. **Configurable Exclusions**: Make file exclusion patterns configurable
3. **Resume Capability**: Add ability to resume interrupted batch processing
4. **Output Formats**: Support additional output formats (PDF, HTML)
5. **Parallel Processing**: Implement concurrent batch processing with rate limiting

### üí° Best Practices

- Test with small folders first to understand output quality
- Review generated documentation for accuracy
- Use version control to track review history
- Consider integrating into CI/CD pipelines for automated reviews

## Error Handling

The script includes robust error handling for:
- File reading errors (logged and skipped)
- API failures (logged with batch information)
- Missing environment variables
- Invalid folder paths

Failed operations are logged but don't terminate the entire review process, ensuring maximum coverage even with problematic files.