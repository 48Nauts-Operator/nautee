<!-- Auto-generated by Claude on 2025-06-22 16:23 -->

# Claude Folder Review (Batched) Documentation

## Overview

This script provides an automated code review solution that recursively analyzes source code files in a folder using Anthropic's Claude AI model. The tool intelligently batches files to handle large codebases efficiently and generates comprehensive markdown reviews for each batch.

## Purpose

- **Automated Code Review**: Leverage Claude AI to perform systematic code reviews
- **Batch Processing**: Handle large codebases by splitting files into manageable chunks (~10k tokens)
- **Documentation Generation**: Create structured markdown reports for review insights
- **Multi-language Support**: Review various programming languages and file types

## Key Features

- ‚úÖ Recursive file discovery with filtering
- ‚úÖ Intelligent token-based batching
- ‚úÖ Test file exclusion
- ‚úÖ Multiple file format support
- ‚úÖ Error handling and progress tracking
- ‚úÖ Timestamped output files

## Functions

### `is_excluded(filename: str) -> bool`

Determines whether a file should be excluded from review based on naming patterns.

**Parameters:**
- `filename` (str): The file path to evaluate

**Returns:**
- `bool`: True if the file should be excluded (test files), False otherwise

**Logic:**
- Excludes files containing "test" in the name
- Excludes files starting with "test_"
- Excludes files in test directories

```python
# Examples of excluded files:
# - test_example.py
# - /tests/unit_test.py
# - example_test.js
```

### `estimate_tokens(text: str) -> int`

Provides a rough estimation of token count for API usage planning.

**Parameters:**
- `text` (str): Source code content

**Returns:**
- `int`: Estimated token count (using 4 characters ‚âà 1 token rule)

**Note:** This is an approximation. Actual token counts may vary based on Claude's tokenization.

### `main()`

The primary execution function that orchestrates the entire review process.

**Process Flow:**
1. **Setup Phase**: Load environment variables and initialize Claude client
2. **File Discovery**: Recursively find valid source files
3. **Token Batching**: Group files into batches under token limit
4. **Review Generation**: Process each batch through Claude API
5. **Output Creation**: Save markdown reports with timestamps

## Configuration

### Environment Variables

```bash
# Required
ANTHROPIC_API_KEY=your_claude_api_key_here

# Optional
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Default model
```

### Supported File Extensions

```python
valid_exts = (
    ".py",    # Python
    ".js",    # JavaScript
    ".ts",    # TypeScript
    ".tsx",   # TypeScript React
    ".jsx",   # JavaScript React
    ".html",  # HTML
    ".css",   # CSS
    ".json",  # JSON
    ".go",    # Go
    ".java",  # Java
    ".yaml",  # YAML
    ".yml"    # YAML
)
```

## Usage

### Basic Usage

```bash
python claude_folder_review.py /path/to/your/codebase
```

### Default Folder

```bash
python claude_folder_review.py
# Uses "../137docs" as default folder
```

## Output

### File Structure

```
docs/folder_review/
‚îú‚îÄ‚îÄ folder_review_batch_01.md
‚îú‚îÄ‚îÄ folder_review_batch_02.md
‚îî‚îÄ‚îÄ folder_review_batch_03.md
```

### Output Format

Each batch file contains:

```markdown
# üì¶ Folder Review Batch 1

_Last updated: 2024-01-15 14:30_

[Claude's review content with insights on:]
- Code organization
- Bug patterns  
- Architecture weaknesses
- Suggestions for improvement
```

## Technical Specifications

| Parameter | Value | Description |
|-----------|-------|-------------|
| Max Tokens per Batch | 10,000 | Prevents API token limits |
| Max Response Tokens | 2,000 | Claude response limit |
| Default Model | claude-sonnet-4-20250514 | Configurable via env |
| Output Directory | `docs/folder_review` | Auto-created |

## Error Handling

The script includes robust error handling for:

- **File Reading Errors**: Logs and continues processing
- **API Errors**: Catches Claude API exceptions per batch
- **Missing Files**: Validates folder existence and content
- **Environment Issues**: Checks for required API keys

## Performance Notes

- **Batch Processing**: Prevents overwhelming the API with large requests
- **Token Estimation**: Helps optimize batch sizes for efficiency  
- **Progress Tracking**: Visual feedback during long operations
- **Timing Reports**: Shows total processing time

## Suggestions for Enhancement

### üîß Potential Improvements

1. **Parallel Processing**: Implement concurrent batch processing
2. **Caching**: Add file hash-based caching to skip unchanged files
3. **Custom Filters**: Allow user-defined exclusion patterns
4. **Output Formats**: Support JSON, HTML, or PDF output options
5. **Integration**: Add CI/CD pipeline integration capabilities

### ‚ö†Ô∏è Current Limitations

- Token estimation is approximate
- No incremental updates (processes all files each run)  
- Limited to text-based source files
- Requires internet connection for Claude API

### üí° Usage Tips

- Use `.env` file for secure API key storage
- Run on clean, committed codebases for best results
- Review batch size if hitting API limits
- Consider excluding generated or vendor files manually