<!-- Auto-generated by Claude on 2025-06-21 22:18 -->

# Claude Folder Review (Batched) Documentation

## Overview

This Python script provides an automated code review solution that uses Anthropic's Claude AI to analyze source code files in batches. The tool recursively scans a directory for source code files, groups them into manageable token-sized batches, and generates comprehensive markdown reviews for each batch.

## Purpose

- **Automated Code Review**: Leverage Claude AI to perform systematic code reviews
- **Batch Processing**: Handle large codebases by splitting files into ~10k token chunks
- **Documentation Generation**: Create structured markdown reports for review insights
- **Multi-language Support**: Review various programming languages and file types

## Key Features

- Recursive directory scanning
- Intelligent file filtering (excludes test files)
- Token-based batching to respect API limits
- Markdown report generation with timestamps
- Error handling and progress tracking

## Functions

### `is_excluded(filename: str) -> bool`

Determines whether a file should be excluded from the review process.

**Parameters:**
- `filename` (str): The file path to evaluate

**Returns:**
- `bool`: True if the file should be excluded (test files), False otherwise

**Exclusion Criteria:**
- Files containing "test" in the name (case-insensitive)
- Files starting with "test_"
- Files in directories containing "test"

### `estimate_tokens(text: str) -> int`

Provides a rough estimation of token count for API usage planning.

**Parameters:**
- `text` (str): The source code content

**Returns:**
- `int`: Estimated token count (uses 4:1 character-to-token ratio)

### `main()`

The primary function that orchestrates the entire review process:

1. **Setup Phase**: Loads environment variables and initializes Claude client
2. **File Discovery**: Recursively finds valid source files
3. **Batching**: Groups files into token-appropriate batches
4. **Review Generation**: Processes each batch through Claude API
5. **Output**: Saves markdown reviews to the output directory

## Configuration

### Environment Variables

```bash
ANTHROPIC_API_KEY=your_claude_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, has default
```

### Supported File Extensions

```python
valid_exts = (
    ".py", ".js", ".ts", ".tsx", ".jsx", 
    ".html", ".css", ".json", ".go", 
    ".java", ".yaml", ".yml"
)
```

## Usage

### Basic Usage

```bash
python claude_folder_review.py [folder_path]
```

### Examples

```bash
# Review current directory's parent folder
python claude_folder_review.py ../myproject

# Review specific folder
python claude_folder_review.py /path/to/codebase

# Use default folder (../137docs)
python claude_folder_review.py
```

## Output Structure

The script generates markdown files in the `docs/folder_review/` directory:

```
docs/folder_review/
â”œâ”€â”€ folder_review_batch_01.md
â”œâ”€â”€ folder_review_batch_02.md
â””â”€â”€ folder_review_batch_03.md
```

Each file contains:
- Batch number and timestamp
- Code organization analysis
- Bug pattern identification
- Architecture assessment
- Improvement suggestions

## Dependencies

```python
pip install anthropic python-dotenv
```

## Configuration Notes

### Token Limits
- **Batch Size**: ~10,000 tokens per batch
- **Response Limit**: 2,000 tokens per review
- Adjust `MAX_TOKENS` variable if needed

### Rate Limiting
The script processes batches sequentially to respect API rate limits. For large codebases, consider adding delays between requests.

## Error Handling

- **File Reading Errors**: Skips problematic files and continues processing
- **API Errors**: Reports errors but continues with remaining batches
- **Missing Files**: Exits gracefully if no valid files are found

## Suggestions for Enhancement

### Performance Improvements
- Add configurable delay between API calls
- Implement parallel processing for independent batches
- Add resume functionality for interrupted runs

### Feature Extensions
- Support for additional file types
- Configurable exclusion patterns
- Integration with version control systems
- HTML report generation

### Usage Tips
- Ensure your `ANTHROPIC_API_KEY` is properly set
- Monitor your API usage when processing large codebases
- Review the exclusion logic to match your project structure
- Consider customizing the review prompt for specific focus areas

## Example Output

```markdown
# ðŸ“¦ Folder Review Batch 1

_Last updated: 2024-01-15 14:30_

## Code Organization
The codebase shows good separation of concerns with clear module boundaries...

## Bug Patterns
Several potential issues were identified:
- Missing error handling in file operations
- Inconsistent null checking patterns

## Architecture Weaknesses
- Tight coupling between data access and business logic
- Missing abstraction layers for external dependencies
```