<!-- Auto-generated by Claude on 2025-06-23 05:22 -->

# Claude Folder Review (Batched) Documentation

## Overview

This Python script automates the code review process by analyzing source code files in a folder using Anthropic's Claude AI model. The script intelligently batches files to stay within token limits and generates comprehensive markdown reviews for each batch.

## Purpose

- **Automated Code Review**: Leverages Claude AI to provide insights on code organization, bug patterns, and architecture
- **Batch Processing**: Handles large codebases by splitting files into manageable chunks (~10k tokens each)
- **Documentation Generation**: Creates structured markdown reports for easy reading and sharing

## Key Features

- Recursive folder scanning for source files
- Intelligent file filtering (excludes test files)
- Token-based batching to optimize API usage
- Support for multiple programming languages
- Automated markdown report generation

## Dependencies

```python
import os
import sys
import anthropic
from dotenv import load_dotenv
from datetime import datetime
import time
```

### Required Packages
- `anthropic` - Claude API client
- `python-dotenv` - Environment variable management

## Important Functions

### `is_excluded(filename: str) -> bool`

Determines whether a file should be excluded from review based on naming patterns.

**Parameters:**
- `filename` (str): The file path to check

**Returns:**
- `bool`: True if the file should be excluded (test files), False otherwise

**Exclusion Criteria:**
- Files containing "test" in the name
- Files starting with "test_"
- Files in directories containing "test"

### `estimate_tokens(text: str) -> int`

Provides a rough estimate of token count for API usage planning.

**Parameters:**
- `text` (str): Source code content

**Returns:**
- `int`: Estimated token count (uses 4 characters per token approximation)

**Note:** This is a simplified estimation. For production use, consider using a proper tokenizer.

## Configuration

### Environment Variables

Create a `.env` file with the following variables:

```bash
ANTHROPIC_API_KEY=your_claude_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, defaults to specified model
```

### Supported File Extensions

The script processes files with these extensions:
- Python: `.py`
- JavaScript/TypeScript: `.js`, `.ts`, `.tsx`, `.jsx`
- Web: `.html`, `.css`
- Data: `.json`, `.yaml`, `.yml`
- Other: `.go`, `.java`

## Usage

### Basic Usage

```bash
python claude_folder_review.py /path/to/your/codebase
```

### Default Behavior

If no folder is specified, it defaults to `../137docs`:

```bash
python claude_folder_review.py
```

## Output

### Directory Structure

Reviews are saved to `docs/folder_review/` with the following naming pattern:

```
docs/folder_review/
├── folder_review_batch_01.md
├── folder_review_batch_02.md
└── folder_review_batch_XX.md
```

### Review Content

Each batch review includes:
- **Header**: Batch number and timestamp
- **Code Organization Analysis**: Structure and modularity insights
- **Bug Pattern Detection**: Potential issues and vulnerabilities
- **Architecture Assessment**: Design weaknesses and strengths
- **Improvement Suggestions**: Recommendations for refactoring and clarity

## Configuration Options

### Batch Size

```python
MAX_TOKENS = 10000  # Adjust based on your needs and API limits
```

### Output Directory

```python
output_root = "docs/folder_review"  # Customize output location
```

## Error Handling

The script includes robust error handling for:
- **File Reading Errors**: Continues processing other files if one fails
- **API Errors**: Reports Claude API issues without stopping the entire process
- **Missing Files**: Validates folder existence and file availability

## Performance Notes

- **Execution Time**: Displays total processing time upon completion
- **Progress Tracking**: Shows current batch progress
- **API Optimization**: Batches files to minimize API calls while staying within token limits

## Suggestions for Enhancement

### 1. Token Counting Improvement

Consider integrating a proper tokenizer for more accurate token estimation:

```python
# Example using tiktoken (for OpenAI) - adapt for Claude
import tiktoken

def accurate_token_count(text: str) -> int:
    encoding = tiktoken.get_encoding("cl100k_base")
    return len(encoding.encode(text))
```

### 2. Configuration File Support

Add support for a configuration file to customize:
- File extensions to include
- Exclusion patterns
- Review focus areas
- Output formatting options

### 3. Parallel Processing

For large codebases, consider implementing concurrent batch processing:

```python
import asyncio
import aiohttp

# Implement async batch processing for faster reviews
```

### 4. Review Aggregation

Add functionality to combine batch reviews into a comprehensive summary report.

## Troubleshooting

### Common Issues

1. **Missing API Key**: Ensure `ANTHROPIC_API_KEY` is set in your `.env` file
2. **No Files Found**: Check folder path and file extensions
3. **API Rate Limits**: Add delays between batches if needed
4. **Large Files**: Consider implementing file size limits to prevent token overflow

### Debug Mode

Add verbose logging by modifying the script to include debug output:

```python
import logging

logging.basicConfig(level=logging.DEBUG)
logger = logging.getLogger(__name__)
```