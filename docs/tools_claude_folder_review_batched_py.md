<!-- Auto-generated by Claude on 2025-06-01 11:15 -->

# Claude Folder Review (Batched) Documentation

## Overview

This script provides an automated code review solution that uses Anthropic's Claude AI to analyze source code files in batches. It recursively scans a directory for source files, groups them into manageable chunks based on token limits, and generates comprehensive markdown reviews for each batch.

## Purpose

- **Automated Code Review**: Leverages Claude AI to provide intelligent insights on code organization, architecture, and potential improvements
- **Batch Processing**: Handles large codebases by splitting files into ~10,000 token chunks to respect API limits
- **Documentation Generation**: Creates structured markdown reports for easy review and sharing

## Key Features

- Recursive directory scanning
- Intelligent file filtering (excludes test files)
- Token-based batching to optimize API usage
- Support for multiple programming languages
- Markdown output with timestamps

## Functions

### `is_excluded(filename: str) -> bool`

Determines whether a file should be excluded from the review process.

**Parameters:**
- `filename` (str): The file path to check

**Returns:**
- `bool`: True if the file should be excluded (test files), False otherwise

**Logic:**
- Excludes files containing "test" in the name or path
- Case-insensitive matching
- Handles both Unix and Windows path separators

```python
# Examples of excluded files:
# - test_something.py
# - /tests/unit.py
# - TestClass.java
```

### `estimate_tokens(text: str) -> int`

Provides a rough estimate of token count for API planning.

**Parameters:**
- `text` (str): The source code content

**Returns:**
- `int`: Estimated token count (uses 4 characters ‚âà 1 token rule)

**Note:** This is a simplified estimation. For production use, consider using a proper tokenizer library.

## Main Workflow

### 1. Setup Phase
- Loads environment variables from `.env` file
- Initializes Anthropic client with API key
- Sets up output directory structure
- Configures supported file extensions

### 2. File Discovery
- Recursively walks the target directory
- Filters files by supported extensions:
  ```python
  valid_exts = (".py", ".js", ".ts", ".tsx", ".jsx", ".html", 
                ".css", ".json", ".go", ".java", ".yaml", ".yml")
  ```
- Excludes test files using `is_excluded()` function

### 3. Token Batching
- Groups files into batches with maximum 10,000 tokens each
- Prevents API limit violations
- Optimizes for efficient processing

### 4. AI Review Generation
- Sends each batch to Claude for analysis
- Focuses on:
  - Code organization
  - Bug patterns
  - Architecture weaknesses
  - Modularization suggestions
- Generates markdown-formatted reviews

## Configuration

### Environment Variables

Create a `.env` file with the following variables:

```env
ANTHROPIC_API_KEY=your_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, has default
```

### Command Line Usage

```bash
# Review specific folder
python script.py /path/to/your/codebase

# Review default folder (../137docs)
python script.py
```

## Output

The script generates individual markdown files for each batch:

```
docs/folder_review/
‚îú‚îÄ‚îÄ folder_review_batch_01.md
‚îú‚îÄ‚îÄ folder_review_batch_02.md
‚îî‚îÄ‚îÄ folder_review_batch_03.md
```

Each file contains:
- Batch header with number
- Timestamp of generation
- Detailed AI-generated review and recommendations

## Dependencies

```python
pip install anthropic python-dotenv
```

## Suggestions and Notes

### ‚ö†Ô∏è Important Considerations

1. **API Costs**: This script makes multiple API calls to Claude. Monitor your usage to avoid unexpected charges.

2. **Rate Limiting**: Consider adding delays between batches for high-volume usage:
   ```python
   time.sleep(1)  # Add after each API call
   ```

3. **Error Handling**: The script continues processing even if individual files fail to read, but logs errors.

### üîß Potential Improvements

1. **Better Tokenization**: Replace the simple character-based estimation with a proper tokenizer
2. **Configurable Exclusions**: Make file exclusion patterns configurable
3. **Resume Capability**: Add ability to resume interrupted batch processing
4. **Summary Report**: Generate an overall summary combining all batch reviews
5. **Custom Prompts**: Allow customization of the review prompt for different focuses

### üí° Usage Tips

- Start with smaller directories to test the output quality
- Review the generated markdown files to ensure the AI feedback meets your needs
- Consider running this regularly as part of your code quality workflow
- Use the timestamp information to track improvements over time

### üöÄ Integration Ideas

- Integrate with CI/CD pipelines for automated code reviews
- Set up scheduled runs for periodic codebase health checks
- Combine with other static analysis tools for comprehensive reviews