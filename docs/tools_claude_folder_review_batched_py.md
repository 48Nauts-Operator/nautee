<!-- Auto-generated by Claude on 2025-06-22 09:20 -->

# Claude Folder Review (Batched) Documentation

## Overview

This script provides an automated code review solution that uses Anthropic's Claude AI to analyze source code files in batches. It recursively scans a directory for source code files, groups them into manageable chunks based on token limits, and generates comprehensive Markdown reviews for each batch.

## Purpose

- **Automated Code Review**: Leverages Claude AI to provide intelligent code analysis and suggestions
- **Batch Processing**: Handles large codebases by splitting files into token-efficient batches
- **Documentation Generation**: Creates organized Markdown documentation for review insights
- **Multi-language Support**: Supports various programming languages and file types

## Key Features

- Token-based batching to stay within API limits
- Automatic exclusion of test files
- Multi-language source code support
- Timestamped output documentation
- Error handling and progress tracking

## Configuration

### Environment Variables

The script requires the following environment variables (loaded via `.env` file):

- `ANTHROPIC_API_KEY`: Your Anthropic API key for Claude access
- `ANTHROPIC_MODEL`: (Optional) Claude model to use (defaults to `claude-sonnet-4-20250514`)

### Supported File Extensions

```python
valid_exts = (".py", ".js", ".ts", ".tsx", ".jsx", ".html", ".css", ".json", ".go", ".java", ".yaml", ".yml")
```

## Usage

```bash
python script_name.py [folder_path]
```

- `folder_path`: (Optional) Path to the folder to review. Defaults to `../137docs`

## Important Functions

### `is_excluded(filename: str) -> bool`

Determines whether a file should be excluded from review based on naming patterns.

**Parameters:**
- `filename`: The file path to evaluate

**Returns:**
- `True` if the file should be excluded (contains "test" patterns)
- `False` if the file should be included

**Exclusion Criteria:**
- Files containing "test" in the name (case-insensitive)
- Files starting with "test_"
- Files in directories containing "test"

### `estimate_tokens(text: str) -> int`

Provides a rough estimate of token count for API usage planning.

**Parameters:**
- `text`: The source code content

**Returns:**
- Estimated token count (using 4 characters per token approximation)

**Note:** This is a simplified estimation. For production use, consider using a more accurate tokenization library.

### `main()`

The primary execution function that orchestrates the entire review process:

1. **Setup Phase**: Loads environment variables and initializes Claude client
2. **File Discovery**: Recursively finds valid source files
3. **Token Batching**: Groups files into batches under the token limit
4. **Review Generation**: Processes each batch through Claude API
5. **Output Creation**: Saves results as timestamped Markdown files

## Configuration Constants

- `MAX_TOKENS = 10000`: Maximum tokens per batch to stay within API limits
- `output_root = "docs/folder_review"`: Directory where review files are saved
- `max_tokens=2000`: Maximum tokens for Claude's response

## Output Structure

Generated files follow this naming pattern:
```
docs/folder_review/folder_review_batch_01.md
docs/folder_review/folder_review_batch_02.md
...
```

Each file contains:
- Batch number header
- Timestamp
- Claude's analysis focusing on:
  - Code organization
  - Bug patterns
  - Architecture weaknesses
  - Modularization suggestions

## Error Handling

The script includes comprehensive error handling for:
- Missing or invalid files
- API communication errors
- File reading permissions
- Missing environment variables

## Suggestions and Notes

### Improvements to Consider

1. **Token Estimation**: Replace the simple character-based estimation with a proper tokenizer for more accurate batching
2. **Configuration File**: Move constants to a configuration file for easier customization
3. **Parallel Processing**: Implement concurrent API calls for faster processing
4. **Resume Capability**: Add ability to resume interrupted batch processing
5. **Custom Prompts**: Allow customizable review prompts for different analysis focuses

### Best Practices

- **API Key Security**: Ensure your `.env` file is in `.gitignore`
- **Rate Limiting**: Consider adding delays between API calls for large batches
- **Output Management**: Regularly clean up old review files to avoid clutter
- **Backup**: Keep backups of important review outputs

### Limitations

- Token estimation is approximate and may not be perfectly accurate
- Large files might be split across batches, potentially losing context
- No support for binary files or specialized formats
- Test file exclusion logic might be too broad for some projects

## Example Usage

```bash
# Review current directory
python claude_folder_review.py .

# Review specific project
python claude_folder_review.py /path/to/my/project

# Review with default folder
python claude_folder_review.py
```

The script will output progress information and create batch review files in the `docs/folder_review/` directory.