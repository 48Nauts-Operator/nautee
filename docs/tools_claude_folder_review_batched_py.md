<!-- Auto-generated by Claude on 2025-06-22 10:20 -->

# Claude Folder Review (Batched) Documentation

## Overview

This Python script performs automated code reviews of entire folder structures using Anthropic's Claude AI model. It processes source code files in batches to work within token limits and generates comprehensive markdown reports for each batch.

## Purpose

The script is designed to:
- Recursively scan folders for source code files
- Batch files into manageable chunks (~10k tokens per batch)
- Send each batch to Claude for AI-powered code review
- Generate individual markdown reports with insights and suggestions
- Provide architectural feedback and identify potential issues

## Key Features

- **Batch Processing**: Automatically splits large codebases into token-limited batches
- **Multiple Language Support**: Handles various file types (Python, JavaScript, TypeScript, etc.)
- **Test File Filtering**: Excludes test files from review
- **Token Estimation**: Calculates approximate token usage before API calls
- **Markdown Output**: Generates structured, readable review reports

## Functions

### `is_excluded(filename: str) -> bool`

Determines whether a file should be excluded from the review process.

**Parameters:**
- `filename` (str): The file path to check

**Returns:**
- `bool`: True if the file should be excluded (test files), False otherwise

**Logic:**
- Excludes files containing "test" in the name or path
- Case-insensitive matching
- Handles both Unix and Windows path separators

### `estimate_tokens(text: str) -> int`

Provides a rough estimate of token count for API planning.

**Parameters:**
- `text` (str): The source code content

**Returns:**
- `int`: Estimated token count (using 4 characters per token approximation)

**Note:** This is a simplified estimation. Actual token counts may vary.

### `main()`

The primary function that orchestrates the entire review process.

**Process Flow:**
1. **Setup**: Loads environment variables and initializes Claude client
2. **File Discovery**: Recursively finds valid source files
3. **Batching**: Groups files into token-limited batches
4. **Review Generation**: Sends batches to Claude for analysis
5. **Output**: Saves markdown reports for each batch

## Configuration

### Environment Variables

```bash
ANTHROPIC_API_KEY=your_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, defaults to this model
```

### Supported File Extensions

```python
valid_exts = (
    ".py", ".js", ".ts", ".tsx", ".jsx", 
    ".html", ".css", ".json", ".go", 
    ".java", ".yaml", ".yml"
)
```

## Usage

### Basic Usage

```bash
python claude_folder_review.py /path/to/your/codebase
```

### Default Folder

If no folder is specified, it defaults to `../137docs`:

```bash
python claude_folder_review.py
```

## Output Structure

The script creates a `docs/folder_review/` directory with numbered batch files:

```
docs/folder_review/
├── folder_review_batch_01.md
├── folder_review_batch_02.md
└── folder_review_batch_03.md
```

Each file contains:
- Batch number and timestamp
- Detailed code review from Claude
- Architecture insights and suggestions

## Review Focus Areas

The Claude prompt specifically targets:

- **Code Organization**: Structure and modularity assessment
- **Bug Patterns**: Potential issues and anti-patterns
- **Architecture Weaknesses**: Design flaws and improvements
- **Modularization Suggestions**: Recommendations for better code organization

## Limitations and Considerations

### Token Limits
- Maximum 10,000 tokens per batch
- Large files may need manual splitting
- API costs scale with codebase size

### File Type Support
- Only processes files with recognized extensions
- Binary files are ignored
- Configuration files (like `.env`) are excluded

### Error Handling
- Continues processing if individual files fail to read
- Reports API errors but continues with remaining batches
- Graceful handling of permission issues

## Suggestions for Improvement

1. **Add Configuration File**: Consider using a config file for extensions and exclusions
2. **Progress Indicators**: Add progress bars for large codebases
3. **Resumable Processing**: Add ability to resume interrupted reviews
4. **Custom Prompts**: Allow customization of review focus areas
5. **Output Formats**: Support additional output formats (HTML, PDF)
6. **Parallel Processing**: Consider async processing for multiple batches

## Dependencies

```python
pip install anthropic python-dotenv
```

## Error Scenarios

- **Missing API Key**: Script will fail if `ANTHROPIC_API_KEY` is not set
- **No Valid Files**: Exits with error code 1 if no processable files found
- **API Rate Limits**: May encounter rate limiting with large codebases
- **File Permission Issues**: Individual file errors are logged but don't stop processing

## Best Practices

1. **Test on Small Folders First**: Verify setup before processing large codebases
2. **Monitor API Usage**: Be aware of costs for large projects
3. **Review Output**: Claude's suggestions should be validated by human developers
4. **Version Control**: Keep review outputs in version control for historical comparison