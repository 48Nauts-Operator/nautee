<!-- Auto-generated by Claude on 2025-06-07 23:20 -->

# Claude Folder Review (Batched) Documentation

## Overview

This Python script provides an automated code review solution that recursively scans source code files in a folder and uses Claude AI to generate comprehensive batch reviews. The script intelligently splits files into manageable chunks based on token limits and produces individual markdown review documents.

## Purpose

- **Automated Code Review**: Leverage Claude AI to review multiple source code files simultaneously
- **Batch Processing**: Handle large codebases by splitting files into ~10k token batches
- **Documentation Generation**: Create structured markdown reviews for easy reading and sharing
- **Quality Assurance**: Identify code organization issues, bug patterns, and architectural weaknesses

## Key Features

- Recursive folder scanning with file type filtering
- Intelligent token-based batching to stay within API limits
- Exclusion of test files to focus on production code
- Structured markdown output with timestamps
- Error handling and progress tracking

## Functions

### `is_excluded(filename: str) -> bool`

Determines whether a file should be excluded from the review process.

**Parameters:**
- `filename` (str): The file path to check

**Returns:**
- `bool`: True if the file should be excluded (test files), False otherwise

**Logic:**
- Excludes files containing "test" in the name or path
- Case-insensitive matching
- Handles both Unix and Windows path separators

### `estimate_tokens(text: str) -> int`

Provides a rough estimation of token count for API limit management.

**Parameters:**
- `text` (str): Source code content

**Returns:**
- `int`: Estimated token count

**Note:** Uses a simple heuristic of 4 characters per token. For production use, consider using a more accurate tokenizer.

### `main()`

The primary function that orchestrates the entire review process.

**Workflow:**
1. **Setup**: Load environment variables and initialize Claude client
2. **File Discovery**: Scan folder for valid source files
3. **Token Batching**: Group files into batches under token limit
4. **API Processing**: Send batches to Claude for review
5. **Output Generation**: Save reviews as markdown files

## Configuration

### Environment Variables

Create a `.env` file with the following variables:

```env
ANTHROPIC_API_KEY=your_claude_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514
```

### Supported File Types

The script processes the following file extensions:
- Python: `.py`
- JavaScript/TypeScript: `.js`, `.ts`, `.tsx`, `.jsx`
- Web: `.html`, `.css`
- Configuration: `.json`, `.yaml`, `.yml`
- Other: `.go`, `.java`

## Usage

### Basic Usage

```bash
python claude_folder_review.py
```
*Reviews the default folder: `../137docs`*

### Custom Folder

```bash
python claude_folder_review.py /path/to/your/codebase
```

### Output Structure

Reviews are saved to `docs/folder_review/` with the naming pattern:
```
docs/folder_review/
‚îú‚îÄ‚îÄ folder_review_batch_01.md
‚îú‚îÄ‚îÄ folder_review_batch_02.md
‚îî‚îÄ‚îÄ folder_review_batch_03.md
```

## Dependencies

Install required packages:

```bash
pip install anthropic python-dotenv
```

## Configuration Options

| Variable | Default Value | Description |
|----------|---------------|-------------|
| `MAX_TOKENS` | 10000 | Maximum tokens per batch |
| `folder` | `../137docs` | Default folder to review |
| `output_root` | `docs/folder_review` | Output directory for reviews |
| `model` | `claude-sonnet-4-20250514` | Claude model to use |

## Error Handling

The script includes robust error handling for:
- Missing or invalid files
- API rate limits and errors
- File reading permissions
- Network connectivity issues

## Suggestions for Improvement

### Performance Enhancements
- **Parallel Processing**: Implement concurrent batch processing
- **Caching**: Add file hash-based caching to avoid re-reviewing unchanged files
- **Progress Persistence**: Save progress to resume interrupted reviews

### Feature Additions
- **Custom Exclusion Patterns**: Allow user-defined exclusion rules via config file
- **Review Templates**: Support different review focuses (security, performance, style)
- **Integration**: Add Git integration to review only changed files
- **Output Formats**: Support additional output formats (HTML, PDF)

### Code Quality
- **Token Accuracy**: Replace simple estimation with proper tokenizer
- **Configuration Management**: Move hardcoded values to configuration file
- **Logging**: Implement proper logging instead of print statements
- **Type Hints**: Add comprehensive type annotations

## Example Output

Each generated review file contains:

```markdown
# üì¶ Folder Review Batch 1

_Last updated: 2024-01-15 14:30_

## Code Organization
- Well-structured module hierarchy
- Clear separation of concerns

## Bug Patterns
- Potential null pointer exceptions in user input handling
- Missing error handling in network requests

## Architecture Weaknesses
- Tight coupling between data and presentation layers
- Lack of dependency injection

## Suggestions
- Implement proper error handling patterns
- Consider using design patterns for better modularity
```

## Notes

‚ö†Ô∏è **API Costs**: Be mindful of Claude API costs when reviewing large codebases
‚ö†Ô∏è **Rate Limits**: The script doesn't implement rate limiting - add delays if needed
‚ö†Ô∏è **File Size**: Very large files may exceed token limits even individually