<!-- Auto-generated by Claude on 2025-06-23 01:50 -->

# Claude Folder Review (Batched) Documentation

## Overview

This Python script is an automated code review tool that uses Anthropic's Claude AI to analyze source code files in batches. It recursively scans a directory for source code files, groups them into manageable batches based on token limits, and generates comprehensive Markdown reviews for each batch.

## Purpose

- **Automated Code Review**: Leverages Claude AI to provide intelligent code analysis
- **Batch Processing**: Handles large codebases by splitting files into ~10k token chunks
- **Documentation Generation**: Creates organized Markdown reports for review findings
- **Multi-language Support**: Reviews various programming languages and file types

## Key Features

- Recursive directory scanning
- Intelligent file filtering (excludes test files)
- Token-based batching to respect API limits
- Automated Markdown report generation
- Error handling and progress tracking

## Functions

### `is_excluded(filename: str) -> bool`

Determines whether a file should be excluded from the review process.

**Parameters:**
- `filename` (str): The file path to check

**Returns:**
- `bool`: True if the file should be excluded (test files), False otherwise

**Exclusion Criteria:**
- Files containing "test" in the name (case-insensitive)
- Files starting with "test_"
- Files in directories containing "test"

```python
# Examples of excluded files:
# - test_utils.py
# - /tests/example.py  
# - MyTestFile.js
```

### `estimate_tokens(text: str) -> int`

Provides a rough estimation of token count for API planning.

**Parameters:**
- `text` (str): Source code content

**Returns:**
- `int`: Estimated token count (using 4 characters per token approximation)

**Note:** This is a simplified estimation. For production use, consider using a proper tokenizer.

### `main()`

The primary orchestration function that handles the entire review process.

**Process Flow:**
1. **Setup**: Load environment variables and initialize Claude client
2. **File Discovery**: Recursively scan directory for valid source files
3. **Token Batching**: Group files into batches under the token limit
4. **Review Generation**: Send batches to Claude and save responses

## Configuration

### Environment Variables

Create a `.env` file with the following variables:

```env
ANTHROPIC_API_KEY=your_claude_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, has default
```

### Supported File Extensions

```python
valid_exts = (
    ".py", ".js", ".ts", ".tsx", ".jsx", 
    ".html", ".css", ".json", ".go", 
    ".java", ".yaml", ".yml"
)
```

## Usage

### Basic Usage

```bash
python claude_folder_review.py /path/to/your/codebase
```

### Default Behavior

```bash
python claude_folder_review.py
# Uses default folder: "../137docs"
```

## Output Structure

The script generates output files in the following structure:

```
docs/folder_review/
├── folder_review_batch_01.md
├── folder_review_batch_02.md
└── folder_review_batch_XX.md
```

### Output Format

Each batch file contains:
- Batch number and timestamp
- Code organization analysis
- Bug pattern identification
- Architecture weakness assessment
- Modularization suggestions

## Review Focus Areas

The Claude AI reviews focus on:

- **Code Organization**: Structure and maintainability
- **Bug Patterns**: Potential issues and vulnerabilities  
- **Architecture Weaknesses**: Design flaws and improvements
- **Suggestions**: Modularization and clarity recommendations

## Configuration Options

| Setting | Default Value | Description |
|---------|---------------|-------------|
| `MAX_TOKENS` | 10,000 | Maximum tokens per batch |
| `output_root` | `"docs/folder_review"` | Output directory |
| `model` | `"claude-sonnet-4-20250514"` | Claude model version |

## Error Handling

The script includes comprehensive error handling for:

- Missing or invalid API keys
- File reading errors
- Claude API failures
- Invalid directory paths

## Dependencies

```python
pip install anthropic python-dotenv
```

## Performance Notes

- **API Rate Limits**: Respects Claude's API constraints through batching
- **Token Management**: Automatically splits large codebases into manageable chunks
- **Progress Tracking**: Provides real-time feedback during processing

## Suggestions for Improvement

1. **Token Estimation**: Consider using a proper tokenizer library for more accurate estimates
2. **File Type Detection**: Add support for additional programming languages
3. **Configuration File**: Move settings to a separate config file for easier customization
4. **Parallel Processing**: Implement concurrent batch processing for faster execution
5. **Report Aggregation**: Add a summary report that combines insights from all batches
6. **Custom Exclusions**: Allow users to specify custom exclusion patterns

## Troubleshooting

**Common Issues:**

- **No files found**: Check file extensions and exclusion patterns
- **API errors**: Verify your `ANTHROPIC_API_KEY` is valid
- **Permission errors**: Ensure read access to source directory and write access to output directory
- **Large files**: Consider increasing `MAX_TOKENS` or implementing file splitting for very large individual files