<!-- Auto-generated by Claude on 2025-06-22 18:24 -->

# Claude Folder Review (Batched) Documentation

## Overview

This Python script automates code review for entire folders using Anthropic's Claude AI. It recursively processes source code files, batches them by token count, and generates comprehensive markdown reviews for each batch.

## Purpose

- **Automated Code Review**: Review large codebases efficiently using AI
- **Batch Processing**: Handle large folders by splitting into manageable chunks (~10k tokens each)
- **Documentation Generation**: Create structured markdown reports for code analysis
- **Multi-language Support**: Works with various programming languages and file types

## Key Features

- 🔍 **Recursive File Discovery**: Scans folders and subfolders for source files
- 📦 **Smart Batching**: Groups files by estimated token count to optimize API usage
- 🚫 **Test File Exclusion**: Automatically skips test files to focus on production code
- 📝 **Markdown Output**: Generates structured review documents
- ⚡ **Progress Tracking**: Shows real-time progress and timing information

## Functions

### `is_excluded(filename: str) -> bool`

Determines whether a file should be excluded from review based on naming patterns.

**Parameters:**
- `filename` (str): The file path to check

**Returns:**
- `bool`: True if the file should be excluded (test files), False otherwise

**Exclusion Criteria:**
- Files containing "test" in the name
- Files starting with "test_"
- Files in directories containing "test"

```python
# Examples of excluded files:
# - test_utils.py
# - /tests/test_main.py
# - utils_test.js
```

### `estimate_tokens(text: str) -> int`

Provides a rough estimate of token count for API planning purposes.

**Parameters:**
- `text` (str): The source code content

**Returns:**
- `int`: Estimated token count (using 4 characters per token approximation)

**Note:** This is a simplified estimation. Actual token counts may vary based on Claude's tokenization.

### `main()`

The primary function that orchestrates the entire review process.

**Workflow:**
1. **Setup**: Load environment variables and initialize Claude client
2. **File Discovery**: Recursively find valid source files
3. **Token Batching**: Group files into batches under the token limit
4. **API Processing**: Send batches to Claude for review
5. **Output Generation**: Save markdown reviews to disk

## Usage

### Command Line

```bash
# Review specific folder
python claude_folder_review.py /path/to/your/project

# Review default folder (../137docs)
python claude_folder_review.py
```

### Environment Setup

Create a `.env` file with your Anthropic API credentials:

```env
ANTHROPIC_API_KEY=your_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, has default
```

## Supported File Types

The script processes the following file extensions:

- **Python**: `.py`
- **JavaScript/TypeScript**: `.js`, `.ts`, `.tsx`, `.jsx`
- **Web**: `.html`, `.css`
- **Data**: `.json`, `.yaml`, `.yml`
- **Other Languages**: `.go`, `.java`

## Output Structure

Reviews are saved to `docs/folder_review/` with the following naming pattern:

```
docs/folder_review/
├── folder_review_batch_01.md
├── folder_review_batch_02.md
└── ...
```

Each file contains:
- Batch number and timestamp
- Code organization analysis
- Bug pattern identification
- Architecture recommendations
- Modularization suggestions

## Configuration

### Token Limits

```python
MAX_TOKENS = 10000  # Adjust based on your API limits and needs
```

### Review Focus Areas

The script prompts Claude to focus on:
- **Code Organization**: Structure and maintainability
- **Bug Patterns**: Common error-prone code
- **Architecture Weaknesses**: Design issues
- **Suggestions**: Improvements for clarity and modularity

## Error Handling

- **File Read Errors**: Skips unreadable files and continues processing
- **API Errors**: Reports Claude API failures but continues with remaining batches
- **Missing Files**: Exits gracefully if no valid files are found

## Performance Considerations

- **Batch Size**: 10k tokens per batch balances API efficiency with processing time
- **Rate Limiting**: No built-in rate limiting - consider adding delays for large codebases
- **Memory Usage**: Loads files into memory - may need optimization for very large files

## Suggestions for Enhancement

1. **Add Rate Limiting**: Implement delays between API calls for large batches
2. **Configuration File**: Move settings like `MAX_TOKENS` and file extensions to a config file
3. **Resume Capability**: Add ability to resume interrupted reviews
4. **Summary Report**: Generate an overall summary combining all batch reviews
5. **Custom Exclusions**: Allow user-defined exclusion patterns via command line or config

## Dependencies

```python
pip install anthropic python-dotenv
```

## Example Output

The generated markdown files will contain structured reviews like:

```markdown
# 📦 Folder Review Batch 1

_Last updated: 2024-01-15 14:30_

## Code Organization
The codebase shows good separation of concerns...

## Potential Issues
- Missing error handling in utils.py line 45
- Inconsistent naming conventions...

## Recommendations
- Consider extracting common functionality into shared modules
- Add type hints for better maintainability
```