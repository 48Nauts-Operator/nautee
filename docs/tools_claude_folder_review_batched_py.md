<!-- Auto-generated by Claude on 2025-06-01 16:23 -->

# Claude Folder Review (Batched) Documentation

## Overview

This Python script provides an automated code review system that uses Anthropic's Claude AI to analyze source code files in batches. The tool recursively scans a folder structure, groups files into manageable chunks based on token limits, and generates detailed markdown reviews for each batch.

## Purpose

- **Automated Code Review**: Leverages Claude AI to provide insights on code organization, bug patterns, and architecture
- **Batch Processing**: Handles large codebases by splitting files into ~10k token chunks
- **Documentation Generation**: Creates structured markdown reports for easy review and sharing
- **Multi-language Support**: Works with various programming languages and file types

## Key Features

- Recursive folder scanning with file filtering
- Token-based batching to respect API limits
- Exclusion of test files to focus on production code
- Structured markdown output with timestamps
- Error handling and progress tracking

## Functions

### `is_excluded(filename: str) -> bool`

Determines whether a file should be excluded from the review process.

**Parameters:**
- `filename` (str): The file path to check

**Returns:**
- `bool`: True if the file should be excluded (test files), False otherwise

**Logic:**
- Excludes files containing "test" in the name or path
- Case-insensitive matching
- Handles both Unix and Windows path separators

```python
# Examples of excluded files:
# - test_utils.py
# - /tests/unit.py  
# - TestComponent.jsx
```

### `estimate_tokens(text: str) -> int`

Provides a rough estimation of token count for API usage planning.

**Parameters:**
- `text` (str): Source code content

**Returns:**
- `int`: Estimated token count

**Note:** Uses a simple 4:1 character-to-token ratio approximation. This is a rough estimate and may vary based on actual tokenization.

### `main()`

The primary function that orchestrates the entire review process.

**Process Flow:**
1. **Setup**: Loads environment variables and initializes Claude client
2. **File Discovery**: Recursively scans folder for valid source files
3. **Token Batching**: Groups files into batches under token limit
4. **Review Generation**: Sends batches to Claude and saves markdown reports

## Configuration

### Environment Variables

```bash
ANTHROPIC_API_KEY=your_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, has default
```

### Supported File Extensions

- **Python**: `.py`
- **JavaScript/TypeScript**: `.js`, `.ts`, `.tsx`, `.jsx`
- **Web**: `.html`, `.css`
- **Data**: `.json`, `.yaml`, `.yml`
- **Other Languages**: `.go`, `.java`

### Configuration Constants

```python
MAX_TOKENS = 10000        # Token limit per batch
output_root = "docs/folder_review"  # Output directory
```

## Usage

### Basic Usage

```bash
python claude_folder_review.py /path/to/your/project
```

### Default Folder

If no folder is specified, it defaults to `../137docs`:

```bash
python claude_folder_review.py
```

## Output Structure

The script generates numbered markdown files in the `docs/folder_review/` directory:

```
docs/folder_review/
├── folder_review_batch_01.md
├── folder_review_batch_02.md
└── folder_review_batch_03.md
```

Each file contains:
- Batch number and timestamp
- Claude's analysis focusing on:
  - Code organization
  - Bug patterns  
  - Architecture weaknesses
  - Modularization suggestions

## Error Handling

- **File Read Errors**: Continues processing other files, logs errors
- **API Errors**: Reports Claude API issues per batch
- **Missing Files**: Exits gracefully if no valid files found
- **Missing API Key**: Will fail with anthropic client initialization error

## Performance Notes

- **Token Estimation**: Uses approximate calculation for batching
- **API Limits**: Respects Claude's token limits through batching
- **Progress Tracking**: Shows real-time batch processing status
- **Timing**: Reports total execution time

## Suggestions for Enhancement

### Recommended Improvements

1. **Configuration File**: Add YAML/JSON config for customizable settings
2. **Filter Options**: Allow custom file extension and exclusion patterns
3. **Parallel Processing**: Implement concurrent API calls for faster processing
4. **Token Accuracy**: Use tiktoken or similar for precise token counting
5. **Output Formats**: Support JSON, HTML, or other output formats
6. **Incremental Updates**: Only review changed files on subsequent runs

### Example Configuration Enhancement

```python
# config.yaml
batch_size: 10000
output_format: ["markdown", "json"]
include_extensions: [".py", ".js", ".go"]
exclude_patterns: ["*test*", "*.min.js", "node_modules/*"]
review_focus: ["security", "performance", "maintainability"]
```

## Dependencies

```bash
pip install anthropic python-dotenv
```

## Security Considerations

- Store API keys in `.env` file, never commit to version control
- Be mindful of sending proprietary code to external APIs
- Consider using local models for sensitive codebases
- Review Claude's data usage policies for your use case