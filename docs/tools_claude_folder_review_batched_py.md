<!-- Auto-generated by Claude on 2025-06-02 08:28 -->

# Claude Folder Review (Batched) - Documentation

## Overview

This script performs automated code reviews of entire folders using Anthropic's Claude AI model. It intelligently processes source code files in batches to handle large codebases while respecting API token limits.

## Purpose

- **Automated Code Review**: Leverages Claude AI to provide senior-level code review insights
- **Batch Processing**: Splits large codebases into manageable chunks (~10k tokens each)
- **Documentation Generation**: Creates organized Markdown reports for each batch
- **Multi-Language Support**: Handles various programming languages and file types

## Key Features

- üîç **Smart File Discovery**: Recursively scans folders for valid source files
- üì¶ **Token-Aware Batching**: Automatically groups files to optimize API usage
- üö´ **Test File Exclusion**: Filters out test files to focus on core functionality
- üìù **Markdown Output**: Generates structured documentation with timestamps

## Functions

### `is_excluded(filename: str) -> bool`

Determines whether a file should be excluded from review based on naming patterns.

**Parameters:**
- `filename`: File path to evaluate

**Returns:**
- `bool`: True if file should be excluded (test files)

**Exclusion Criteria:**
- Files containing "test" in the name
- Files starting with "test_"
- Files in test directories

```python
# Examples of excluded files:
# - test_utils.py
# - /tests/integration.py
# - components/Button.test.tsx
```

### `estimate_tokens(text: str) -> int`

Provides a rough estimate of token count for API planning.

**Parameters:**
- `text`: Source code content

**Returns:**
- `int`: Estimated token count (using 4 characters per token approximation)

**Note:** This is a simplified estimation. For production use, consider using tiktoken or similar libraries for more accurate token counting.

### `main()`

The primary orchestration function that handles the entire review process.

**Workflow:**
1. **Setup**: Loads environment variables and initializes Claude client
2. **Discovery**: Scans folder for valid source files
3. **Batching**: Groups files by estimated token count
4. **Processing**: Sends batches to Claude for review
5. **Output**: Saves individual Markdown reports

## Configuration

### Environment Variables

Create a `.env` file with the following variables:

```env
ANTHROPIC_API_KEY=your_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, defaults to this model
```

### Supported File Extensions

```python
valid_exts = (
    ".py", ".js", ".ts", ".tsx", ".jsx", 
    ".html", ".css", ".json", ".go", 
    ".java", ".yaml", ".yml"
)
```

## Usage

### Basic Usage

```bash
# Review default folder (../137docs)
python claude_folder_review.py

# Review specific folder
python claude_folder_review.py /path/to/your/project
```

### Output Structure

```
docs/folder_review/
‚îú‚îÄ‚îÄ folder_review_batch_01.md
‚îú‚îÄ‚îÄ folder_review_batch_02.md
‚îî‚îÄ‚îÄ folder_review_batch_03.md
```

Each batch file contains:
- Header with batch number
- Timestamp of generation
- Claude's review insights covering:
  - Code organization
  - Bug patterns
  - Architecture weaknesses
  - Modularization suggestions

## Configuration Options

| Setting | Default | Description |
|---------|---------|-------------|
| `MAX_TOKENS` | 10,000 | Maximum tokens per batch |
| `output_root` | `docs/folder_review` | Output directory |
| `model` | `claude-sonnet-4-20250514` | Claude model version |

## Best Practices

### Before Running
- ‚úÖ Ensure your `ANTHROPIC_API_KEY` is valid
- ‚úÖ Check that the target folder contains source code
- ‚úÖ Verify you have write permissions to the output directory

### Optimization Tips
- **Large Codebases**: Consider excluding non-essential directories
- **API Costs**: Monitor token usage for large projects
- **Review Quality**: Smaller batches may provide more focused insights

## Error Handling

The script includes robust error handling for:
- **File Read Errors**: Continues processing other files
- **API Errors**: Reports failures but continues with remaining batches
- **Missing Files**: Validates folder existence before processing

## Limitations

‚ö†Ô∏è **Important Considerations:**
- Token estimation is approximate and may not reflect exact API usage
- Large files may dominate smaller batches
- API rate limits may require delays between requests
- Test file detection is pattern-based and may miss edge cases

## Extension Ideas

- Add support for more file types
- Implement more sophisticated token counting
- Add configuration file support
- Include diff-based reviews for changed files
- Add integration with version control systems

## Dependencies

```bash
pip install anthropic python-dotenv
```