<!-- Auto-generated by Claude on 2025-06-22 15:19 -->

# Claude Folder Review (Batched) Documentation

## Overview

This Python script provides an automated code review system that uses Anthropic's Claude AI to analyze source code files in batches. The script recursively scans a folder for source code files, groups them into manageable token-sized batches, and generates individual markdown review reports for each batch.

## Purpose

- **Automated Code Review**: Leverage Claude AI to perform comprehensive code reviews
- **Batch Processing**: Handle large codebases by splitting files into ~10k token chunks
- **Documentation Generation**: Create structured markdown reports for review insights
- **Multi-language Support**: Review various file types including Python, JavaScript, TypeScript, and more

## Key Features

- Recursive folder scanning with file filtering
- Token estimation and intelligent batching
- Exclusion of test files
- Markdown-formatted output reports
- Progress tracking and error handling

## Functions

### `is_excluded(filename: str) -> bool`

Determines whether a file should be excluded from the review process.

**Parameters:**
- `filename` (str): The full path of the file to check

**Returns:**
- `bool`: True if the file should be excluded (test files), False otherwise

**Logic:**
- Excludes files containing "test" in the name or path
- Case-insensitive matching
- Handles both Unix and Windows path separators

```python
# Examples of excluded files:
# - test_example.py
# - /tests/unit.js
# - TestHelper.java
```

### `estimate_tokens(text: str) -> int`

Provides a rough estimation of token count for API usage planning.

**Parameters:**
- `text` (str): Source code content

**Returns:**
- `int`: Estimated token count

**Note:** Uses a simple 4:1 character-to-token ratio approximation.

### `main()`

The primary function that orchestrates the entire review process.

**Process Flow:**
1. **Setup**: Load environment variables and initialize Claude client
2. **File Discovery**: Scan folder for valid source files
3. **Token Batching**: Group files into batches under token limit
4. **Review Generation**: Send batches to Claude and save results

## Configuration

### Environment Variables

Create a `.env` file with the following variables:

```env
ANTHROPIC_API_KEY=your_claude_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514
```

### Supported File Extensions

The script processes files with these extensions:
- **Python**: `.py`
- **JavaScript/TypeScript**: `.js`, `.ts`, `.tsx`, `.jsx`
- **Web**: `.html`, `.css`
- **Data**: `.json`, `.yaml`, `.yml`
- **Other**: `.go`, `.java`

## Usage

### Basic Usage

```bash
python claude_folder_review.py [folder_path]
```

### Examples

```bash
# Review current directory
python claude_folder_review.py .

# Review specific folder
python claude_folder_review.py /path/to/my/project

# Use default folder (../137docs)
python claude_folder_review.py
```

## Output

### Directory Structure

```
docs/
└── folder_review/
    ├── folder_review_batch_01.md
    ├── folder_review_batch_02.md
    └── folder_review_batch_03.md
```

### Report Format

Each batch report includes:
- Batch number and timestamp
- Code organization analysis
- Bug pattern identification
- Architecture weakness assessment
- Modularization suggestions

## Dependencies

Install required packages:

```bash
pip install anthropic python-dotenv
```

## Configuration Options

| Setting | Default | Description |
|---------|---------|-------------|
| `MAX_TOKENS` | 10,000 | Maximum tokens per batch |
| `folder` | `../137docs` | Default folder to review |
| `output_root` | `docs/folder_review` | Output directory |
| `model` | `claude-sonnet-4-20250514` | Claude model version |

## Error Handling

The script includes robust error handling for:
- Missing API keys
- File read errors
- Claude API failures
- Invalid folder paths

## Performance Notes

- **Token Estimation**: Uses approximation for speed; actual API usage may vary
- **Batch Processing**: Processes batches sequentially to avoid rate limits
- **Progress Tracking**: Displays real-time progress and timing information

## Suggestions for Improvement

1. **Concurrent Processing**: Add async/await for parallel batch processing
2. **Token Accuracy**: Implement proper tokenization for precise counting
3. **File Filtering**: Add configuration file for custom exclusion rules
4. **Output Formats**: Support additional output formats (HTML, PDF)
5. **Caching**: Implement file hash-based caching to avoid re-reviewing unchanged files
6. **Rate Limiting**: Add intelligent rate limiting based on API quotas

## Troubleshooting

### Common Issues

- **No files found**: Check file extensions and exclusion rules
- **API errors**: Verify API key and model availability
- **Permission errors**: Ensure read/write access to input and output directories
- **Token limits**: Reduce `MAX_TOKENS` if hitting API limits

### Debug Tips

- Check console output for detailed error messages
- Verify `.env` file configuration
- Test with small folders first
- Monitor API usage and quotas