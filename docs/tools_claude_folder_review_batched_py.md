<!-- Auto-generated by Claude on 2025-06-22 12:38 -->

# Claude Folder Review (Batched) Documentation

## Overview

This Python script provides an automated code review solution that recursively analyzes source code files in a folder using Anthropic's Claude AI model. The script intelligently batches files to stay within token limits and generates comprehensive markdown reviews for code quality assessment.

## Purpose

- **Automated Code Review**: Leverage Claude AI to review large codebases systematically
- **Batch Processing**: Handle large folders by splitting content into manageable chunks
- **Documentation Generation**: Create structured markdown reports for each batch
- **Architecture Analysis**: Focus on code organization, bug patterns, and improvement suggestions

## Key Features

- âœ… Recursive folder scanning with file type filtering
- âœ… Intelligent token-based batching (~10k tokens per batch)
- âœ… Test file exclusion to focus on production code
- âœ… Multiple programming language support
- âœ… Structured markdown output with timestamps

## Important Functions

### `is_excluded(filename: str) -> bool`

Filters out test files from the review process.

**Parameters:**
- `filename`: File path to evaluate

**Returns:**
- `True` if file should be excluded (test files), `False` otherwise

**Logic:**
- Checks for "test" in filename (case-insensitive)
- Detects test file patterns like `test_*.py`
- Handles both Unix and Windows path separators

### `estimate_tokens(text: str) -> int`

Provides a rough estimation of token count for batching purposes.

**Parameters:**
- `text`: Source code content

**Returns:**
- Estimated token count (using 4 characters â‰ˆ 1 token rule)

**Note:** This is a simplified estimation. For production use, consider using a proper tokenizer.

### `main()`

The primary orchestration function that handles the complete workflow:

1. **Setup Phase**
   - Loads environment variables
   - Initializes Anthropic client
   - Sets up output directories

2. **File Discovery**
   - Recursively scans the target folder
   - Filters by supported file extensions
   - Excludes test files

3. **Batching Logic**
   - Groups files to stay under 10k token limit
   - Prevents API request failures due to size limits

4. **Review Generation**
   - Sends batches to Claude for analysis
   - Saves structured markdown reports
   - Provides progress feedback

## Configuration

### Environment Variables

Create a `.env` file with the following variables:

```bash
ANTHROPIC_API_KEY=your_claude_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, defaults to this model
```

### Supported File Extensions

```python
valid_exts = (
    ".py", ".js", ".ts", ".tsx", ".jsx", 
    ".html", ".css", ".json", ".go", 
    ".java", ".yaml", ".yml"
)
```

## Usage

### Basic Usage

```bash
python claude_folder_review.py /path/to/your/codebase
```

### Default Folder

If no path is provided, it defaults to `../137docs`:

```bash
python claude_folder_review.py
```

## Output Structure

The script generates markdown files in the `docs/folder_review/` directory:

```
docs/folder_review/
â”œâ”€â”€ folder_review_batch_01.md
â”œâ”€â”€ folder_review_batch_02.md
â””â”€â”€ folder_review_batch_03.md
```

Each file contains:
- Batch number and timestamp
- Code organization analysis
- Bug pattern identification
- Architecture recommendations
- Modularization suggestions

## Dependencies

```bash
pip install anthropic python-dotenv
```

## Limitations & Considerations

### Current Limitations

- **Token Estimation**: Uses a simple 4:1 character-to-token ratio which may be inaccurate
- **Error Handling**: Limited retry logic for API failures
- **File Encoding**: Assumes UTF-8 encoding for all files
- **Language Detection**: No automatic syntax highlighting in code blocks

### Recommendations for Improvement

1. **Enhanced Token Counting**
   ```python
   # Consider using tiktoken for accurate token counting
   import tiktoken
   
   def accurate_token_count(text: str, model: str) -> int:
       encoding = tiktoken.encoding_for_model(model)
       return len(encoding.encode(text))
   ```

2. **Retry Logic**
   ```python
   import backoff
   
   @backoff.on_exception(backoff.expo, anthropic.APIError, max_tries=3)
   def call_claude_with_retry(client, prompt):
       # API call logic here
   ```

3. **Configuration File**
   - Add support for YAML/JSON configuration files
   - Allow customizable file extensions and exclusion patterns

4. **Progress Tracking**
   - Add progress bars for long-running operations
   - Include ETA calculations

## Security Notes

- Store API keys securely in environment variables
- Never commit `.env` files to version control
- Consider implementing rate limiting for API calls
- Validate file paths to prevent directory traversal attacks

## Example Output

```markdown
# ðŸ“¦ Folder Review Batch 1

_Last updated: 2024-01-15 14:30_

## Code Organization
The codebase shows good separation of concerns with clear module boundaries...

## Bug Patterns
Several files contain potential null pointer exceptions...

## Architecture Recommendations
Consider implementing a service layer to decouple business logic...
```