<!-- Auto-generated by Claude on 2025-06-22 11:16 -->

# Claude Folder Review (Batched) Documentation

## Overview

This Python script provides an automated code review system that leverages Anthropic's Claude AI to analyze source code files in batches. The tool recursively scans a directory for source code files, intelligently groups them into manageable chunks based on token limits, and generates comprehensive Markdown reviews for each batch.

## Purpose

- **Automated Code Review**: Provides AI-powered analysis of codebases using Claude
- **Batch Processing**: Handles large codebases by splitting files into ~10k token chunks
- **Documentation Generation**: Creates structured Markdown reports for easy consumption
- **Multi-language Support**: Reviews various file types including Python, JavaScript, TypeScript, HTML, CSS, and more

## Key Features

### File Discovery and Filtering
- Recursively scans directories for source code files
- Supports multiple programming languages and file formats
- Automatically excludes test files to focus on production code
- Configurable file extension filtering

### Intelligent Batching
- Estimates token count to stay within API limits
- Groups files into batches of approximately 10,000 tokens
- Prevents API quota issues while maximizing efficiency

### AI-Powered Analysis
- Uses Claude AI for sophisticated code review
- Focuses on code organization, bug patterns, and architecture
- Provides actionable suggestions for improvement

## Important Functions

### `is_excluded(filename: str) -> bool`
Determines whether a file should be excluded from review based on naming patterns.

**Parameters:**
- `filename`: The file path to evaluate

**Returns:**
- `bool`: True if the file should be excluded (test files), False otherwise

**Usage:**
```python
if not is_excluded(full_path):
    files.append(full_path)
```

### `estimate_tokens(text: str) -> int`
Provides a rough estimation of token count for API planning.

**Parameters:**
- `text`: Source code content

**Returns:**
- `int`: Estimated token count (uses 4-character-per-token approximation)

**Note:** This is a simplified estimation. For production use, consider using more accurate tokenization libraries.

## Configuration

### Environment Variables
The script requires the following environment variables (typically stored in a `.env` file):

```bash
ANTHROPIC_API_KEY=your_claude_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, has default
```

### Supported File Extensions
```python
valid_exts = (
    ".py", ".js", ".ts", ".tsx", ".jsx", 
    ".html", ".css", ".json", ".go", 
    ".java", ".yaml", ".yml"
)
```

## Usage

### Basic Usage
```bash
python claude_folder_review.py /path/to/your/codebase
```

### Default Behavior
If no path is provided, it defaults to reviewing the `../137docs` directory:
```bash
python claude_folder_review.py
```

## Output Structure

The script generates individual Markdown files for each batch:

```
docs/folder_review/
├── folder_review_batch_01.md
├── folder_review_batch_02.md
└── folder_review_batch_03.md
```

Each file contains:
- Batch number and timestamp
- AI-generated review focusing on:
  - Code organization
  - Bug patterns
  - Architecture weaknesses  
  - Modularization suggestions

## Performance Considerations

### Token Management
- **Batch Size**: ~10,000 tokens per batch
- **API Limits**: Designed to stay within Claude's token limits
- **Processing Time**: Displays progress and total execution time

### Error Handling
- Graceful handling of file read errors
- API error recovery with detailed error messages
- Continues processing even if individual files fail

## Suggestions and Best Practices

### Before Running
1. **Set up environment**: Ensure `.env` file contains valid `ANTHROPIC_API_KEY`
2. **Check API quota**: Verify sufficient Claude API credits
3. **Clean codebase**: Remove unnecessary files to improve review quality

### Customization Options
- **File Extensions**: Modify `valid_exts` tuple to include/exclude file types
- **Batch Size**: Adjust `MAX_TOKENS` constant for different batch sizes
- **Exclusion Logic**: Enhance `is_excluded()` function for custom filtering rules
- **Output Format**: Modify prompt template for different review focuses

### Potential Improvements
- **Better Tokenization**: Replace simple character-based estimation with actual tokenization
- **Parallel Processing**: Add concurrent batch processing for faster execution
- **Configuration File**: Move settings to external config file
- **Resume Capability**: Add ability to resume interrupted processing
- **Summary Generation**: Create an overview document combining all batch reviews

## Dependencies

```python
anthropic  # Claude AI API client
python-dotenv  # Environment variable management
```

Install with:
```bash
pip install anthropic python-dotenv
```

## Error Scenarios

The script handles several error conditions:
- **Missing API key**: Will fail with authentication error
- **Invalid directory**: Exits gracefully if no valid files found
- **File read errors**: Logs error and continues with remaining files
- **API errors**: Reports error for specific batch but continues processing