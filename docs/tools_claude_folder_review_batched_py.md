<!-- Auto-generated by Claude on 2025-06-01 13:27 -->

# Claude Folder Review (Batched) Documentation

## Overview

This Python script provides an automated code review solution that leverages Claude AI to analyze source code files in batches. It recursively scans a folder structure, groups files into token-efficient batches, and generates comprehensive Markdown reviews for each batch.

## Purpose

- **Automated Code Review**: Systematically review large codebases using AI assistance
- **Batch Processing**: Handle large projects by splitting files into manageable chunks (~10k tokens each)
- **Documentation Generation**: Create structured Markdown reports for review insights
- **Quality Analysis**: Focus on code organization, bug patterns, and architectural improvements

## Key Features

- Recursive folder scanning with file type filtering
- Intelligent token-based batching to optimize API usage
- Exclusion of test files to focus on core functionality
- Structured Markdown output with timestamps
- Error handling and progress tracking

## Functions

### `is_excluded(filename: str) -> bool`

Determines whether a file should be excluded from review based on naming patterns.

**Parameters:**
- `filename` (str): The file path to evaluate

**Returns:**
- `bool`: True if the file should be excluded (test files), False otherwise

**Logic:**
- Excludes files containing "test" in the name
- Excludes files starting with "test_"
- Excludes files in test directories

```python
# Examples of excluded files:
# - test_utils.py
# - /tests/unit_test.py
# - TestRunner.js
```

### `estimate_tokens(text: str) -> int`

Provides a rough estimation of token count for API planning purposes.

**Parameters:**
- `text` (str): Source code content

**Returns:**
- `int`: Estimated token count (uses 4 characters ‚âà 1 token approximation)

**Note:** This is a simplified estimation. Actual token counts may vary based on Claude's tokenization.

### `main()`

The primary execution function that orchestrates the entire review process.

## Workflow

### 1. Setup Phase
```python
# Environment configuration
load_dotenv()
client = anthropic.Anthropic(api_key=os.getenv("ANTHROPIC_API_KEY"))
model = os.getenv("ANTHROPIC_MODEL", "claude-sonnet-4-20250514")
```

### 2. File Discovery
- Scans specified folder recursively
- Filters by supported file extensions
- Excludes test files
- Supported extensions: `.py`, `.js`, `.ts`, `.tsx`, `.jsx`, `.html`, `.css`, `.json`, `.go`, `.java`, `.yaml`, `.yml`

### 3. Batch Creation
- Groups files into batches with maximum 10,000 tokens each
- Prevents API token limit violations
- Optimizes processing efficiency

### 4. AI Review Generation
- Sends each batch to Claude AI
- Focuses on:
  - Code organization
  - Bug patterns
  - Architecture weaknesses
  - Modularization suggestions
- Generates structured Markdown output

### 5. Output Management
- Creates individual files for each batch: `folder_review_batch_XX.md`
- Includes timestamps and batch numbers
- Stores in `docs/folder_review/` directory

## Usage

### Basic Usage
```bash
python claude_folder_review.py /path/to/source/folder
```

### Default Folder
```bash
python claude_folder_review.py
# Uses "../137docs" as default folder
```

## Configuration

### Environment Variables

Create a `.env` file with:
```env
ANTHROPIC_API_KEY=your_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514
```

### Dependencies

```bash
pip install anthropic python-dotenv
```

## Output Structure

Each batch review generates a file with this structure:

```markdown
# üì¶ Folder Review Batch 01

_Last updated: 2024-01-15 14:30_

[Claude's review content with insights on code organization, 
bug patterns, architecture weaknesses, and improvement suggestions]
```

## Suggestions and Notes

### ‚ö†Ô∏è Important Considerations

1. **API Costs**: Each batch consumes Claude API tokens. Monitor usage for large codebases.

2. **Token Estimation**: The 4:1 character-to-token ratio is approximate. Consider implementing more accurate token counting for production use.

3. **File Type Coverage**: Currently supports common web and backend languages. Extend `valid_exts` for additional file types.

### üîß Potential Improvements

1. **Enhanced Token Counting**: Integrate with `tiktoken` or similar libraries for precise token calculation

2. **Configurable Exclusions**: Make exclusion patterns configurable via command line or config file

3. **Progress Persistence**: Add ability to resume interrupted batch processing

4. **Summary Generation**: Create an overall summary combining insights from all batches

5. **Parallel Processing**: Implement concurrent batch processing for faster execution

### üí° Usage Tips

- Start with smaller folders to test configuration
- Review generated markdown files for quality and adjust prompts as needed
- Consider running during off-peak hours for large codebases
- Use version control to track review history over time

## Error Handling

The script includes error handling for:
- File reading errors (permissions, encoding issues)
- Claude API errors (rate limits, network issues)
- Missing environment variables
- Empty or invalid folders

Errors are logged with descriptive emoji indicators for easy identification.