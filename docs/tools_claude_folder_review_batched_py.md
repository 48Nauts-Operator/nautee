<!-- Auto-generated by Claude on 2025-06-01 14:17 -->

# Claude Folder Review (Batched) Documentation

## Overview

This script provides an automated code review solution that uses Anthropic's Claude AI to analyze source code files in batches. It recursively scans a folder for source code files, groups them into manageable chunks based on token limits, and generates detailed Markdown reviews for each batch.

## Purpose

- **Automated Code Review**: Leverage Claude AI to perform comprehensive code analysis
- **Batch Processing**: Handle large codebases by splitting files into ~10k token chunks
- **Documentation Generation**: Output structured Markdown reviews for easy consumption
- **Scalable Analysis**: Process multiple file types across entire project directories

## Key Features

- Recursive folder scanning with file type filtering
- Intelligent token-based batching to stay within API limits
- Exclusion of test files to focus on core functionality
- Structured Markdown output with timestamps
- Error handling and progress tracking

## Functions

### `is_excluded(filename: str) -> bool`

Determines whether a file should be excluded from review based on naming patterns.

**Parameters:**
- `filename` (str): The file path to check

**Returns:**
- `bool`: True if the file should be excluded (test files), False otherwise

**Exclusion Criteria:**
- Files containing "test" in the name (case-insensitive)
- Files starting with "test_"
- Files in directories containing "test"

```python
# Examples of excluded files
is_excluded("test_module.py")      # True
is_excluded("src/test/unit.py")    # True  
is_excluded("main.py")             # False
```

### `estimate_tokens(text: str) -> int`

Provides a rough estimate of token count for API usage planning.

**Parameters:**
- `text` (str): Source code content

**Returns:**
- `int`: Estimated token count (using 4 characters per token average)

**Note:** This is a simplified estimation. For production use, consider using a proper tokenizer library.

### `main()`

The primary function that orchestrates the entire review process.

#### Setup Phase
- Loads environment variables for API configuration
- Initializes Anthropic client
- Sets up output directory structure
- Defines supported file extensions

#### File Discovery
- Recursively scans the target folder
- Filters files by extension and exclusion rules
- Builds a list of files to process

#### Token Batching
- Groups files into batches under the 10k token limit
- Formats each file with proper Markdown syntax
- Handles file reading errors gracefully

#### Review Generation
- Sends batches to Claude AI for analysis
- Saves individual Markdown files for each batch
- Provides progress feedback and timing information

## Configuration

### Environment Variables

Create a `.env` file in your project root:

```env
ANTHROPIC_API_KEY=your_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514
```

### Supported File Types

The script processes the following file extensions:
- **Python**: `.py`
- **JavaScript/TypeScript**: `.js`, `.ts`, `.tsx`, `.jsx`
- **Web**: `.html`, `.css`
- **Configuration**: `.json`, `.yaml`, `.yml`
- **Other Languages**: `.go`, `.java`

## Usage

### Basic Usage
```bash
python claude_folder_review.py
```
*Uses default folder: `../137docs`*

### Custom Folder
```bash
python claude_folder_review.py /path/to/your/project
```

### Output Structure
```
docs/folder_review/
‚îú‚îÄ‚îÄ folder_review_batch_01.md
‚îú‚îÄ‚îÄ folder_review_batch_02.md
‚îî‚îÄ‚îÄ folder_review_batch_03.md
```

## Output Format

Each batch review includes:
- **Header**: Batch number and timestamp
- **Code Organization**: Analysis of file structure and organization
- **Bug Patterns**: Identification of potential issues
- **Architecture Weaknesses**: Structural concerns and recommendations
- **Suggestions**: Specific improvements for modularity and clarity

## Notes and Suggestions

### ‚ö†Ô∏è Important Considerations

1. **API Costs**: Monitor your Anthropic API usage, as large codebases can generate significant costs
2. **Rate Limits**: The script doesn't implement rate limiting - add delays if needed
3. **Token Estimation**: The 4-character-per-token estimate is approximate; consider using proper tokenizers for accuracy

### üöÄ Potential Improvements

- **Add rate limiting** to avoid API throttling
- **Implement proper tokenization** using `tiktoken` or similar libraries
- **Add configuration file support** for custom file extensions and exclusions
- **Include summary generation** across all batches
- **Add retry logic** for failed API calls
- **Support for different output formats** (HTML, PDF, etc.)

### üí° Best Practices

- Run reviews on clean, committed code
- Review the exclusion patterns for your specific project structure
- Consider running on smaller directories first to gauge output quality
- Regularly update the Claude model version for improved analysis

## Dependencies

```bash
pip install anthropic python-dotenv
```

## Error Handling

The script includes error handling for:
- Missing or invalid files
- API communication failures
- File reading permissions
- Missing environment variables

Errors are logged to console with descriptive messages and don't halt the entire process.