<!-- Auto-generated by Claude on 2025-06-22 06:34 -->

# Claude Folder Review (Batched) Documentation

## Overview

This Python script provides an automated code review system that uses Anthropic's Claude AI to analyze source code files in a directory. The script recursively scans a folder, groups files into token-optimized batches, and generates comprehensive markdown reviews for each batch.

## Purpose

- **Automated Code Review**: Leverage Claude AI to perform consistent, thorough code reviews
- **Batch Processing**: Handle large codebases by splitting files into manageable chunks
- **Documentation Generation**: Create structured markdown reports for each review batch
- **Multi-language Support**: Review various file types including Python, JavaScript, TypeScript, and more

## Key Features

### File Discovery & Filtering
- Recursively scans directories for source code files
- Supports multiple programming languages and file formats
- Automatically excludes test files to focus on production code
- Configurable file extension filtering

### Intelligent Batching
- Estimates token usage to stay within API limits (~10k tokens per batch)
- Groups files efficiently to maximize Claude API usage
- Prevents API errors due to token limit exceeded

### Review Generation
- Uses Claude AI to analyze code patterns, architecture, and potential issues
- Generates structured markdown reports with timestamps
- Focuses on actionable insights and improvement suggestions

## Important Functions

### `is_excluded(filename: str) -> bool`
Determines whether a file should be excluded from review based on naming patterns.

```python
# Excludes files containing "test" in various forms
return "test" in lower or lower.startswith("test_") or "/test" in lower or "\\test" in lower
```

**Parameters:**
- `filename`: Full path or name of the file to check

**Returns:** `True` if the file should be excluded (test files), `False` otherwise

### `estimate_tokens(text: str) -> int`
Provides a rough estimation of token count for API planning.

```python
# Simple estimation: ~4 characters per token
return int(len(text) / 4)
```

**Parameters:**
- `text`: Source code content to analyze

**Returns:** Estimated token count

### `main()`
The primary orchestration function that handles the complete workflow:

1. **Environment Setup**: Loads API keys and configuration
2. **File Discovery**: Scans directory for valid source files
3. **Batch Creation**: Groups files by estimated token count
4. **API Processing**: Sends batches to Claude for review
5. **Output Generation**: Saves markdown reports to disk

## Configuration

### Environment Variables
```bash
ANTHROPIC_API_KEY=your_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, has default
```

### Supported File Extensions
```python
valid_exts = (
    ".py", ".js", ".ts", ".tsx", ".jsx", 
    ".html", ".css", ".json", ".go", 
    ".java", ".yaml", ".yml"
)
```

## Usage

### Basic Usage
```bash
python script.py /path/to/your/codebase
```

### Default Behavior
```bash
python script.py  # Reviews "../137docs" by default
```

## Output Structure

The script generates markdown files in the `docs/folder_review/` directory:

```
docs/folder_review/
‚îú‚îÄ‚îÄ folder_review_batch_01.md
‚îú‚îÄ‚îÄ folder_review_batch_02.md
‚îî‚îÄ‚îÄ folder_review_batch_XX.md
```

Each file contains:
- Batch number and timestamp
- Structured code review focusing on:
  - Code organization
  - Bug patterns  
  - Architecture weaknesses
  - Modularization suggestions

## Notes and Suggestions

### ‚ö†Ô∏è Current Limitations
- **Token estimation is approximate**: Uses simple 4:1 character-to-token ratio
- **Fixed language detection**: All code blocks marked as Python regardless of actual language
- **No error recovery**: Failed batches don't retry automatically

### üîß Suggested Improvements

1. **Enhanced Token Estimation**
   ```python
   # Consider using tiktoken for accurate token counting
   import tiktoken
   encoding = tiktoken.get_encoding("cl100k_base")
   return len(encoding.encode(text))
   ```

2. **Dynamic Language Detection**
   ```python
   def get_language_from_extension(file_path):
       ext_map = {'.py': 'python', '.js': 'javascript', '.ts': 'typescript'}
       return ext_map.get(os.path.splitext(file_path)[1], 'text')
   ```

3. **Progress Tracking**
   - Add progress bars for long-running operations
   - Include estimated completion times

4. **Error Handling**
   - Implement retry logic for API failures
   - Add graceful handling of rate limits
   - Log detailed error information

5. **Configuration File**
   - Move settings to external config file
   - Allow customizable exclusion patterns
   - Configurable review focus areas

### üí° Usage Tips

- **Start Small**: Test with a small directory first to verify API setup
- **Monitor Costs**: Each batch uses Claude API tokens - be aware of usage
- **Review Quality**: The 2000 token max response limit may truncate detailed reviews for large batches
- **API Rate Limits**: Consider adding delays between requests for high-volume usage

## Dependencies

```python
anthropic      # Claude AI API client
python-dotenv  # Environment variable management
```

Install with:
```bash
pip install anthropic python-dotenv
```