<!-- Auto-generated by Claude on 2025-06-23 10:23 -->

# Claude Folder Review (Batched) Documentation

## Overview

This Python script provides an automated code review system that recursively analyzes source code files in a folder using Anthropic's Claude AI model. The script intelligently batches files based on token limits and generates comprehensive markdown reviews for each batch.

## Purpose

- **Automated Code Review**: Leverage Claude AI to perform systematic code reviews
- **Batch Processing**: Handle large codebases by splitting files into manageable chunks
- **Documentation Generation**: Create organized markdown reports for review insights
- **Multi-language Support**: Review various programming languages and file formats

## Key Features

- Token-aware batching (≤10k tokens per batch)
- Automatic test file exclusion
- Multi-format file support
- Markdown report generation with timestamps
- Error handling and progress tracking

## Functions

### `is_excluded(filename: str) -> bool`

Determines whether a file should be excluded from review based on naming patterns.

**Parameters:**
- `filename` (str): The file path to evaluate

**Returns:**
- `bool`: True if the file should be excluded (test files), False otherwise

**Logic:**
- Excludes files containing "test" in the name
- Excludes files starting with "test_"
- Excludes files in test directories

```python
# Examples of excluded files:
# - test_example.py
# - /tests/unit_test.py
# - example_test.js
```

### `estimate_tokens(text: str) -> int`

Provides a rough estimate of token count for Claude API usage planning.

**Parameters:**
- `text` (str): Source code content

**Returns:**
- `int`: Estimated token count (characters ÷ 4)

**Note:** This is a simplified estimation. Actual token counts may vary based on Claude's tokenizer.

### `main()`

The primary execution function that orchestrates the entire review process.

**Process Flow:**
1. **Setup**: Load environment variables and initialize Claude client
2. **File Discovery**: Recursively find valid source files
3. **Token Batching**: Group files into batches under token limit
4. **Review Generation**: Send batches to Claude for analysis
5. **Output**: Save markdown reviews to disk

## Configuration

### Environment Variables

```bash
# Required
ANTHROPIC_API_KEY=your_api_key_here

# Optional (defaults to claude-sonnet-4-20250514)
ANTHROPIC_MODEL=claude-3-sonnet-20240229
```

### Supported File Extensions

The script processes files with the following extensions:
- **Python**: `.py`
- **JavaScript/TypeScript**: `.js`, `.ts`, `.tsx`, `.jsx`
- **Web**: `.html`, `.css`
- **Data**: `.json`, `.yaml`, `.yml`
- **Other**: `.go`, `.java`

## Usage

### Basic Usage
```bash
python claude_folder_review.py
```
*Reviews the default folder: `../137docs`*

### Custom Folder
```bash
python claude_folder_review.py /path/to/your/codebase
```

### Output Structure
```
docs/folder_review/
├── folder_review_batch_01.md
├── folder_review_batch_02.md
└── folder_review_batch_03.md
```

## Review Focus Areas

Each batch review covers:
- **Code Organization**: Structure and maintainability
- **Bug Patterns**: Potential issues and vulnerabilities  
- **Architecture Weaknesses**: Design flaws and improvements
- **Modularization**: Suggestions for better code organization
- **Clarity**: Readability and documentation recommendations

## Dependencies

```python
# Required packages
pip install anthropic python-dotenv
```

## Limitations & Considerations

### Token Limits
- **Batch Size**: Maximum 10,000 tokens per batch
- **Response Limit**: 2,000 tokens per review
- Large files may be truncated or split across batches

### File Exclusions
- Automatically excludes test files
- May miss important test-related code architecture
- Consider reviewing test files separately if needed

### API Costs
- Each batch consumes Claude API tokens
- Monitor usage for large codebases
- Consider using cheaper models for initial reviews

## Suggestions for Improvement

### Enhanced Filtering
```python
# Add more sophisticated exclusion rules
def is_excluded(filename: str) -> bool:
    excluded_patterns = [
        "test", "__pycache__", ".git", "node_modules",
        "dist", "build", ".env"
    ]
    return any(pattern in filename.lower() for pattern in excluded_patterns)
```

### Better Token Estimation
```python
# Use tiktoken for more accurate token counting
import tiktoken

def estimate_tokens(text: str) -> int:
    encoding = tiktoken.get_encoding("cl100k_base")
    return len(encoding.encode(text))
```

### Progress Tracking
```python
# Add progress bars for better UX
from tqdm import tqdm

for i, batch in enumerate(tqdm(batches, desc="Processing batches")):
    # ... processing logic
```

## Error Handling

The script includes basic error handling for:
- File reading errors
- Claude API failures
- Missing environment variables

Consider adding more robust error recovery and retry logic for production use.