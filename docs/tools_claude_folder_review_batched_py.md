<!-- Auto-generated by Claude on 2025-06-22 01:52 -->

# Claude Folder Review (Batched) Documentation

## Overview

This Python script provides an automated code review system that uses Anthropic's Claude AI to analyze source code files in batches. The tool recursively scans a folder structure, groups files into manageable chunks based on token limits, and generates comprehensive Markdown reviews for each batch.

## Purpose

- **Automated Code Review**: Leverage Claude AI to perform systematic code reviews
- **Batch Processing**: Handle large codebases by splitting them into manageable token-sized chunks
- **Documentation Generation**: Create structured Markdown reports for each batch of reviewed files
- **Quality Assurance**: Identify code organization issues, bug patterns, and architectural weaknesses

## Key Features

- Recursive folder scanning with file type filtering
- Intelligent token-based batching (~10k tokens per batch)
- Automatic exclusion of test files
- Structured Markdown output with timestamps
- Progress tracking and error handling

## Requirements

### Dependencies
```python
pip install anthropic python-dotenv
```

### Environment Variables
Create a `.env` file with:
```env
ANTHROPIC_API_KEY=your_claude_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, defaults to this model
```

## Usage

### Basic Usage
```bash
python script_name.py [folder_path]
```

### Examples
```bash
# Review files in default folder (../137docs)
python claude_folder_review.py

# Review specific folder
python claude_folder_review.py /path/to/your/project

# Review current directory
python claude_folder_review.py .
```

## Important Functions

### `is_excluded(filename: str) -> bool`
- **Purpose**: Filters out test files from the review process
- **Logic**: Excludes files containing "test" in their name or path
- **Returns**: `True` if file should be excluded, `False` otherwise

### `estimate_tokens(text: str) -> int`
- **Purpose**: Estimates token count for Claude API usage
- **Algorithm**: Uses a 4:1 character-to-token ratio approximation
- **Returns**: Estimated token count as integer

### `main()`
The primary orchestration function that:
1. Sets up the Anthropic client and configuration
2. Discovers valid source files
3. Groups files into token-limited batches
4. Processes each batch through Claude API
5. Generates timestamped Markdown reports

## Supported File Types

The script processes files with the following extensions:
- **Python**: `.py`
- **JavaScript/TypeScript**: `.js`, `.ts`, `.tsx`, `.jsx`
- **Web**: `.html`, `.css`
- **Data**: `.json`, `.yaml`, `.yml`
- **Other Languages**: `.go`, `.java`

## Output Structure

### File Organization
```
docs/
└── folder_review/
    ├── folder_review_batch_01.md
    ├── folder_review_batch_02.md
    └── ...
```

### Review Content Focus
Each batch review includes analysis of:
- **Code Organization**: Structure and maintainability
- **Bug Patterns**: Potential issues and vulnerabilities
- **Architecture Weaknesses**: Design flaws and improvements
- **Modularization Suggestions**: Code organization recommendations

## Configuration

### Token Limits
- **Batch Size**: 10,000 tokens per batch (configurable via `MAX_TOKENS`)
- **Response Limit**: 2,000 tokens per Claude response

### Default Settings
- **Default Folder**: `../137docs`
- **Output Directory**: `docs/folder_review`
- **Default Model**: `claude-sonnet-4-20250514`

## Error Handling

The script includes comprehensive error handling for:
- Missing or invalid API keys
- File reading errors
- Claude API failures
- Empty folder scenarios

## Performance Notes

- **Token Estimation**: Uses approximation for speed; actual usage may vary
- **API Rate Limits**: Processes batches sequentially to avoid rate limiting
- **Progress Tracking**: Displays real-time progress and completion time

## Suggestions for Improvement

### Potential Enhancements
1. **Parallel Processing**: Add concurrent batch processing with rate limiting
2. **Custom Filters**: Allow user-defined file exclusion patterns
3. **Incremental Updates**: Skip unchanged files in subsequent runs
4. **Summary Reports**: Generate consolidated reviews across all batches
5. **Configuration File**: Support for YAML/JSON configuration instead of hardcoded values

### Usage Tips
- **Large Codebases**: Consider running on subfolders first to test output quality
- **API Costs**: Monitor token usage for cost management
- **Review Quality**: Experiment with different models for varying analysis depth
- **Custom Prompts**: Modify the review prompt for specific focus areas

## Exit Codes
- **0**: Successful completion
- **1**: No valid files found in specified folder