<!-- Auto-generated by Claude on 2025-06-01 22:18 -->

# Claude Folder Review (Batched) Documentation

## Overview

This Python script provides an automated code review solution that uses Anthropic's Claude AI to analyze source code files in a folder structure. The tool processes files in intelligent batches to work within API token limits and generates comprehensive markdown reviews for each batch.

## Purpose

- **Automated Code Review**: Leverages Claude AI to perform systematic code reviews
- **Batch Processing**: Intelligently splits large codebases into manageable chunks (~10k tokens each)
- **Markdown Output**: Generates structured documentation with timestamps for easy reference
- **Multi-language Support**: Handles various programming languages and file types

## Key Features

- Recursive folder scanning with file filtering
- Token estimation and intelligent batching
- Exclusion of test files to focus on core functionality
- Error handling for file reading and API calls
- Progress tracking and time reporting

## Functions

### `is_excluded(filename: str) -> bool`

Filters out files that should not be included in the review process.

**Parameters:**
- `filename` (str): Path or name of the file to check

**Returns:**
- `bool`: True if file should be excluded (test files), False otherwise

**Logic:**
- Excludes files containing "test" in the name
- Excludes files starting with "test_"
- Excludes files in test directories

### `estimate_tokens(text: str) -> int`

Provides a rough estimation of token count for API usage planning.

**Parameters:**
- `text` (str): Source code content

**Returns:**
- `int`: Estimated token count (uses 4 characters per token approximation)

### `main()`

Core orchestration function that handles the entire review process.

**Key Steps:**
1. **Setup**: Loads environment variables and initializes Claude client
2. **File Discovery**: Recursively scans folder for valid source files
3. **Token Batching**: Groups files into batches under token limit
4. **API Processing**: Sends batches to Claude for review
5. **Output Generation**: Saves markdown reviews with timestamps

## Configuration

### Environment Variables

```bash
ANTHROPIC_API_KEY=your_claude_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, has default
```

### Supported File Extensions

```python
valid_exts = (".py", ".js", ".ts", ".tsx", ".jsx", ".html", ".css", 
              ".json", ".go", ".java", ".yaml", ".yml")
```

### Default Settings

- **Max tokens per batch**: 10,000
- **Default folder**: `../137docs`
- **Output directory**: `docs/folder_review/`
- **Max response tokens**: 2,000

## Usage

### Basic Usage
```bash
python claude_folder_review.py
```

### Specify Custom Folder
```bash
python claude_folder_review.py /path/to/your/codebase
```

## Output Structure

The script generates numbered markdown files in the output directory:

```
docs/folder_review/
â”œâ”€â”€ folder_review_batch_01.md
â”œâ”€â”€ folder_review_batch_02.md
â””â”€â”€ folder_review_batch_03.md
```

Each file contains:
- Batch number and timestamp
- Code organization analysis
- Bug pattern identification
- Architecture recommendations
- Modularization suggestions

## Dependencies

```python
anthropic>=0.3.0
python-dotenv>=0.19.0
```

## Error Handling

- **File Reading Errors**: Continues processing other files, logs errors
- **API Errors**: Reports batch failures but continues with remaining batches
- **Missing Files**: Graceful exit with error message
- **Missing API Key**: Will fail with Anthropic client initialization error

## Limitations & Considerations

### Token Estimation
- Uses simple 4:1 character-to-token ratio
- May not be perfectly accurate for all content types
- Consider monitoring actual API usage

### API Rate Limits
- No built-in rate limiting
- Add delays between requests if hitting rate limits
- Monitor your Anthropic API usage quotas

### File Size Limitations
- Very large individual files may exceed token limits
- Consider file splitting for extremely large files

## Suggested Improvements

1. **Add Rate Limiting**
   ```python
   import time
   time.sleep(1)  # Add between API calls
   ```

2. **Enhanced Token Estimation**
   - Use tiktoken library for more accurate counting
   - Different ratios for different file types

3. **Configuration File Support**
   ```python
   # Add support for config.yaml
   max_tokens: 10000
   excluded_patterns: ["test*", "*.min.js"]
   ```

4. **Progress Bar**
   ```python
   from tqdm import tqdm
   # Add visual progress indication
   ```

5. **Resume Capability**
   - Skip already processed batches
   - Add checkpoint functionality for large codebases

## Example Output Preview

```markdown
# ðŸ“¦ Folder Review Batch 1

_Last updated: 2024-01-15 14:30_

## Code Organization
The codebase shows good separation of concerns with clear module boundaries...

## Bug Patterns
Several potential issues were identified:
- Missing error handling in file operations
- Inconsistent variable naming conventions

## Architecture Recommendations
Consider implementing dependency injection for better testability...
```