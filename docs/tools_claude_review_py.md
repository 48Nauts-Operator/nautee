<!-- Auto-generated by Claude on 2025-06-22 23:19 -->

# Claude Review Tool Documentation

## Overview

The Claude Review Tool is a Python script that leverages Anthropic's Claude AI to perform automated code reviews. It can analyze either specific source files or Git diffs, providing structured feedback in Markdown format.

## Purpose

This tool automates the code review process by:
- Analyzing source code for bugs, logic issues, and style inconsistencies
- Reviewing Git diffs to provide feedback on changes
- Generating structured, readable feedback in Markdown format
- Integrating with development workflows for continuous code quality improvement

## Requirements

### Dependencies
- `anthropic` - Anthropic's Python SDK for Claude API
- `python-dotenv` - Environment variable management
- `subprocess` - Git command execution (built-in)
- `os`, `sys`, `datetime` - Standard library modules

### Environment Variables
- `ANTHROPIC_API_KEY` - Required API key for Claude access
- `ANTHROPIC_MODEL` - Optional model specification (defaults to `claude-sonnet-4-20250514`)

## Usage Modes

### Mode 1: Manual File Review
```bash
python claude_review.py file1.py file2.py file3.py
```
- Reviews specified source files
- Combines multiple files into a single review
- Skips missing files with warnings

### Mode 2: Git Diff Review
```bash
python claude_review.py
```
- Automatically detects and reviews Git changes
- Attempts `git diff origin/main...HEAD` first
- Falls back to `git diff HEAD^` if origin/main unavailable

## Key Functions

### `load_code(file_paths)`
Combines multiple source files into a markdown-formatted string for review.

**Parameters:**
- `file_paths` (list): List of file paths to process

**Returns:**
- `str`: Markdown-formatted string containing all source files

**Features:**
- Handles missing files gracefully
- Formats code in markdown code blocks
- Preserves file structure and naming

### `get_git_diff()`
Retrieves Git diff output with fallback strategies.

**Returns:**
- `str`: Git diff string or empty string if unavailable

**Fallback Strategy:**
1. Tries `git diff origin/main...HEAD`
2. Falls back to `git diff HEAD^`
3. Returns empty string if both fail

### `main()`
Primary execution function that orchestrates the review process.

**Process Flow:**
1. Loads environment variables and initializes Claude client
2. Creates output directory structure
3. Determines review mode based on command-line arguments
4. Constructs appropriate prompt for Claude
5. Makes API call and processes response
6. Saves formatted review to file

## Output

### File Location
- **Path:** `docs/claude_review.md`
- **Format:** Markdown with timestamp header

### Review Focus Areas
- **Bugs or logic issues** - Identifies potential runtime problems
- **Code clarity** - Suggests improvements for readability
- **Suggested improvements** - Recommends optimizations
- **Style consistency** - Highlights formatting inconsistencies

## Error Handling

### Missing Files
- Continues processing remaining files
- Displays warning messages for missing files

### Git Operations
- Graceful fallback for missing remote branches
- Generates stub review when no diff available

### API Errors
- Catches and displays Claude API exceptions
- Exits with error code 1 on API failures

## Configuration Notes

### Model Selection
The default model can be overridden via environment variable:
```bash
export ANTHROPIC_MODEL="claude-3-opus-20240229"
```

### Token Limits
- Current limit: 1500 tokens
- May need adjustment for large diffs or multiple files

## Suggestions for Improvement

### Enhanced Error Handling
- Add retry logic for API calls
- Implement rate limiting awareness
- Add validation for API key presence

### Extended File Support
- Auto-detect file types beyond Python
- Add language-specific review prompts
- Support for configuration files

### Output Customization
- Make output directory configurable
- Add multiple output formats (HTML, JSON)
- Include diff statistics in reviews

### Integration Features
- Add GitHub Actions workflow example
- Support for pre-commit hooks
- Integration with popular IDEs

## Example Usage

```bash
# Set up environment
echo "ANTHROPIC_API_KEY=your_key_here" > .env

# Review specific files
python claude_review.py src/main.py tests/test_main.py

# Review current Git changes
python claude_review.py

# Check the generated review
cat docs/claude_review.md
```