<!-- Auto-generated by Claude on 2025-06-02 01:47 -->

# Claude Review Tool Documentation

## Overview

The Claude Review Tool is a Python script that leverages Anthropic's Claude AI to perform automated code reviews. It supports two primary modes of operation:

1. **Manual File Review** - Reviews specific source files provided as command-line arguments
2. **Git Diff Review** - Reviews changes in a Git repository by analyzing diffs

The tool outputs structured feedback in Markdown format, making it easy to integrate into development workflows and documentation systems.

## Purpose

- Automate code review processes using AI
- Provide consistent, structured feedback on code quality
- Support both file-based and Git-based review workflows
- Generate readable Markdown reports for easy sharing and documentation

## Installation & Setup

### Prerequisites

- Python 3.x
- Anthropic API key
- Git (for diff review mode)

### Required Dependencies

```python
pip install anthropic python-dotenv
```

### Environment Configuration

Create a `.env` file in your project root:

```env
ANTHROPIC_API_KEY=your_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, has default
```

## Usage

### Mode 1: Manual File Review

Review specific files by providing them as command-line arguments:

```bash
python claude_review.py file1.py file2.py file3.py
```

### Mode 2: Git Diff Review

Review Git changes by running without arguments:

```bash
python claude_review.py
```

The script will attempt to get diffs in this order:
1. `git diff origin/main...HEAD`
2. `git diff HEAD^` (fallback)

## Key Functions

### `load_code(file_paths)`

Combines multiple source files into a single Markdown-formatted string for review.

**Parameters:**
- `file_paths` (list): List of file paths to process

**Returns:**
- `str`: Markdown-formatted string containing all file contents

**Features:**
- Handles missing files gracefully with warnings
- Formats code with proper syntax highlighting
- Preserves file structure and organization

### `get_git_diff()`

Retrieves Git diff output with intelligent fallback mechanisms.

**Returns:**
- `str`: Git diff content or empty string if unavailable

**Behavior:**
- Primary: Attempts `git diff origin/main...HEAD`
- Fallback: Uses `git diff HEAD^` if origin/main doesn't exist
- Error handling: Returns empty string on failure

### `main()`

Orchestrates the entire review process including:
- Environment setup and API client initialization
- Mode detection (file vs. diff review)
- Claude API interaction
- Output file generation

## Output

### File Location

Reviews are saved to: `docs/claude_review.md`

### Content Structure

```markdown
# ðŸ§  Claude Review

_Last updated: YYYY-MM-DD HH:MM_

[Claude's structured feedback including:]
- Bugs or logic issues
- Code clarity assessment
- Suggested improvements
- Style consistency notes
```

## Configuration Options

### Environment Variables

| Variable | Default | Description |
|----------|---------|-------------|
| `ANTHROPIC_API_KEY` | Required | Your Anthropic API key |
| `ANTHROPIC_MODEL` | `claude-sonnet-4-20250514` | Claude model to use |

### API Limits

- **Max tokens**: 1500 (configured in code)
- **Model**: Configurable via environment variable

## Error Handling

The script includes robust error handling for:

- **Missing files**: Warns and continues processing
- **Git command failures**: Graceful fallback to alternative diff strategies
- **API errors**: Clear error messages with non-zero exit codes
- **Missing API keys**: Handled by Anthropic client

## Integration Suggestions

### CI/CD Pipeline

Add to your GitHub Actions or similar:

```yaml
- name: Run Claude Review
  run: python claude_review.py
  env:
    ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
```

### Pre-commit Hook

```bash
#!/bin/sh
python claude_review.py $(git diff --cached --name-only --diff-filter=AM | grep '\.py$')
```

## Notes and Recommendations

### Security Considerations

- Store API keys securely using environment variables or secrets management
- Be mindful of code confidentiality when using external AI services
- Consider rate limiting for high-frequency usage

### Performance Tips

- The script is optimized for small to medium-sized code reviews
- For large diffs, consider filtering or chunking the input
- Monitor API usage to avoid unexpected costs

### Customization Options

- Modify the prompt in `main()` to focus on specific review criteria
- Adjust `max_tokens` based on your review needs
- Add support for additional file types by modifying the `load_code()` function

### Limitations

- Limited to 1500 tokens output (configurable)
- Requires internet connection for Claude API
- Git diff mode requires a Git repository context