<!-- Auto-generated by Claude on 2025-06-08 06:28 -->

# Claude Review Tool Documentation

## Overview

The Claude Review Tool is a Python script that leverages Anthropic's Claude AI to perform automated code reviews. It can analyze either specific source files or Git diffs, providing structured feedback in Markdown format.

## Purpose

This tool helps developers get AI-powered code reviews by:
- Analyzing individual source files for bugs, clarity, and style issues
- Reviewing Git diffs to catch issues in code changes
- Generating structured Markdown reports with actionable feedback
- Integrating into development workflows for continuous code quality improvement

## Features

- **Dual Operation Modes**: File-based review or Git diff analysis
- **Markdown Output**: Clean, structured feedback in Markdown format
- **Git Integration**: Automatic diff detection with fallback strategies
- **Error Handling**: Graceful handling of missing files and Git errors
- **Configurable**: Uses environment variables for API configuration

## Functions

### `load_code(file_paths)`

Combines multiple source files into a single Markdown-formatted string for review.

**Parameters:**
- `file_paths` (list): List of file paths to analyze

**Returns:**
- `str`: Markdown-formatted string containing all source files

**Features:**
- Skips missing files with warning messages
- Formats each file as a separate code block
- Assumes Python syntax highlighting (hardcoded)

### `get_git_diff()`

Retrieves Git diff output with multiple fallback strategies.

**Returns:**
- `str`: Git diff string or empty string if unavailable

**Fallback Strategy:**
1. Attempts `git diff origin/main...HEAD`
2. Falls back to `git diff HEAD^` if origin/main doesn't exist
3. Returns empty string if both fail

### `main()`

Main execution function that orchestrates the review process.

**Process Flow:**
1. Sets up environment and API client
2. Determines operation mode based on command-line arguments
3. Prepares appropriate prompt for Claude
4. Makes API call and processes response
5. Saves formatted review to Markdown file

## Usage

### File Review Mode
```bash
python claude_review.py file1.py file2.py file3.py
```

### Git Diff Review Mode
```bash
python claude_review.py
```

## Configuration

### Required Environment Variables

Create a `.env` file with the following variables:

```env
ANTHROPIC_API_KEY=your_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, has default
```

### Dependencies

```bash
pip install anthropic python-dotenv
```

## Output

The tool generates a Markdown file at `docs/claude_review.md` with:
- Timestamp of the review
- Structured feedback focusing on:
  - Bugs or logic issues
  - Code clarity
  - Suggested improvements
  - Style consistency

## Notes and Suggestions

### Improvements Needed

1. **Language Detection**: The `load_code()` function hardcodes Python syntax highlighting
   ```python
   # Current (hardcoded):
   combined_code += f"\n\n### `{file_path}`\n```python\n{content}\n```"
   
   # Suggested improvement:
   file_extension = os.path.splitext(file_path)[1][1:]  # Get extension without dot
   combined_code += f"\n\n### `{file_path}`\n```{file_extension}\n{content}\n```"
   ```

2. **Error Handling**: Add validation for API key presence
   ```python
   api_key = os.getenv("ANTHROPIC_API_KEY")
   if not api_key:
       print("‚ùå ANTHROPIC_API_KEY not found in environment variables")
       sys.exit(1)
   ```

3. **Token Limit**: The current limit of 1500 tokens may be insufficient for large reviews

4. **File Size Limits**: No validation for file sizes or combined content length

### Best Practices

- **API Key Security**: Never commit `.env` files to version control
- **Rate Limiting**: Consider adding delays for batch operations
- **Backup Reviews**: Consider versioning review files with timestamps
- **Git Status**: Check for uncommitted changes before diff review

### Integration Suggestions

- Add as a pre-commit hook for automatic code review
- Integrate with CI/CD pipelines for pull request reviews
- Create aliases or shell scripts for common usage patterns
- Consider adding configuration files for custom review criteria

## Error Handling

The tool includes several error handling mechanisms:
- Missing file detection and warnings
- Git command failures with fallback strategies
- API call exception handling
- Graceful exit codes for integration with other tools