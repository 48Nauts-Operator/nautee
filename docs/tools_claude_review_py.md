<!-- Auto-generated by Claude on 2025-06-02 03:21 -->

# Claude Review Tool Documentation

## Overview

The Claude Review Tool is a Python script that leverages Anthropic's Claude AI to perform automated code reviews. It can operate in two modes: reviewing specific source files or analyzing Git diffs. The tool outputs structured feedback in Markdown format, making it easy to integrate into development workflows.

## Purpose

- **Automated Code Review**: Get AI-powered feedback on code quality, bugs, and improvements
- **Git Integration**: Review changes in Git diffs automatically
- **Documentation Generation**: Output reviews in structured Markdown format
- **Development Workflow Integration**: Streamline code review processes

## Requirements

### Dependencies
- `anthropic` - Anthropic's Python client library
- `python-dotenv` - Environment variable management
- `subprocess` - Git command execution (built-in)
- `os`, `sys`, `datetime` - Standard Python libraries

### Environment Variables
- `ANTHROPIC_API_KEY` - Required API key for Claude access
- `ANTHROPIC_MODEL` - Optional model specification (defaults to `claude-sonnet-4-20250514`)

## Usage Modes

### Mode 1: Manual File Review
```bash
python claude_review.py file1.py file2.py [additional_files...]
```
- Reviews specified source files
- Combines multiple files into a single review
- Skips missing files with warnings

### Mode 2: Git Diff Review
```bash
python claude_review.py
```
- Automatically detects and reviews Git changes
- Tries `git diff origin/main...HEAD` first
- Falls back to `git diff HEAD^` if origin/main unavailable

## Key Functions

### `load_code(file_paths)`
Processes multiple source files for review.

**Parameters:**
- `file_paths` (list): List of file paths to review

**Returns:**
- `str`: Markdown-formatted string containing all file contents

**Features:**
- Handles missing files gracefully
- Formats code with syntax highlighting
- Combines multiple files into structured output

### `get_git_diff()`
Retrieves Git diff information with fallback strategies.

**Returns:**
- `str`: Git diff output or empty string if unavailable

**Fallback Strategy:**
1. First attempts `git diff origin/main...HEAD`
2. Falls back to `git diff HEAD^`
3. Returns empty string if both fail

### `main()`
Primary execution function that orchestrates the review process.

**Key Operations:**
1. Environment setup and API client initialization
2. Mode detection (file review vs. git diff)
3. Prompt construction based on selected mode
4. Claude API interaction
5. Output generation and file writing

## Output

### File Location
- **Path**: `docs/claude_review.md`
- **Directory**: Automatically created if missing

### Content Structure
```markdown
# ðŸ§  Claude Review

_Last updated: YYYY-MM-DD HH:MM_

[Claude's structured feedback]
```

## Configuration

### Environment Setup
Create a `.env` file in your project root:
```env
ANTHROPIC_API_KEY=your_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional
```

### Model Configuration
- **Default**: `claude-sonnet-4-20250514`
- **Customization**: Set `ANTHROPIC_MODEL` environment variable
- **Token Limit**: Currently set to 1500 tokens

## Error Handling

### File Access Issues
- Missing files are skipped with warning messages
- Continues processing remaining files

### Git Command Failures
- Graceful fallback between Git diff strategies
- Creates stub review file if no diff available

### API Errors
- Comprehensive error reporting
- Clean exit with error status code

## Review Focus Areas

The tool instructs Claude to focus on:
- **Bugs and Logic Issues**: Potential runtime errors and logical flaws
- **Code Clarity**: Readability and maintainability concerns
- **Suggested Improvements**: Performance and best practice recommendations
- **Style Consistency**: Coding standard adherence

## Notes and Suggestions

### Best Practices
- **API Key Security**: Store API keys in `.env` files, never commit them
- **Regular Updates**: Keep the Anthropic client library updated
- **Token Limits**: Monitor usage for large codebases; consider splitting reviews

### Potential Enhancements
- **File Type Detection**: Currently assumes Python files; could be extended
- **Configurable Output**: Allow custom output paths and formats
- **Batch Processing**: Handle large changesets more efficiently
- **Integration Hooks**: Add Git hooks or CI/CD integration

### Limitations
- **Token Constraints**: Large files may exceed model token limits
- **Language Assumption**: Code formatting assumes Python syntax
- **Network Dependency**: Requires internet connection for API calls

## Integration Examples

### Git Hook Integration
```bash
#!/bin/sh
# pre-push hook
python claude_review.py
```

### CI/CD Pipeline
```yaml
- name: Code Review
  run: python claude_review.py
- name: Upload Review
  uses: actions/upload-artifact@v2
  with:
    name: code-review
    path: docs/claude_review.md
```