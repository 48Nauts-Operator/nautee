<!-- Auto-generated by Claude on 2025-06-22 07:19 -->

# Claude Review Tool Documentation

## Overview

The **Claude Review Tool** is a Python script that leverages Anthropic's Claude AI to perform automated code reviews. It can operate in two modes: reviewing specific source files or analyzing Git diffs. The tool generates structured feedback in Markdown format, making it easy to integrate into development workflows.

## Purpose

This tool helps developers by:
- Providing automated code reviews using Claude AI
- Identifying bugs, logic issues, and style inconsistencies
- Suggesting improvements for code clarity and maintainability
- Supporting both file-based and Git diff-based review workflows
- Generating structured, readable feedback in Markdown format

## Dependencies

- `anthropic` - Claude AI API client
- `python-dotenv` - Environment variable management
- `subprocess` - Git command execution
- `os`, `sys`, `datetime` - Standard Python libraries

## Setup Requirements

### Environment Variables

Create a `.env` file in your project root with the following variables:

```env
ANTHROPIC_API_KEY=your_claude_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, defaults to this model
```

### Installation

```bash
pip install anthropic python-dotenv
```

## Usage

### Mode 1: File Review
Review specific source files by passing them as command-line arguments:

```bash
python claude_review.py file1.py file2.py file3.py
```

### Mode 2: Git Diff Review
Run without arguments to review Git changes:

```bash
python claude_review.py
```

## Key Functions

### `load_code(file_paths)`

Combines multiple source files into a single Markdown-formatted string.

**Parameters:**
- `file_paths` (list): List of file paths to process

**Returns:**
- `str`: Markdown-formatted string containing all file contents

**Features:**
- Handles missing files gracefully with warning messages
- Formats each file with proper Markdown code blocks
- Assumes Python syntax highlighting (may need adjustment for other languages)

### `get_git_diff()`

Retrieves Git diff output using a fallback strategy.

**Returns:**
- `str`: Git diff content or empty string if unavailable

**Fallback Strategy:**
1. First attempts: `git diff origin/main...HEAD`
2. If failed, tries: `git diff HEAD^`
3. Returns empty string if both fail

### `main()`

The primary orchestration function that:
- Loads environment variables and initializes the Claude client
- Determines operation mode based on command-line arguments
- Constructs appropriate prompts for Claude
- Handles API calls and error management
- Saves formatted output to `docs/claude_review.md`

## Output

The tool generates a Markdown file at `docs/claude_review.md` containing:
- Timestamp of the review
- Structured feedback from Claude
- Analysis of bugs, logic issues, and improvements
- Style and clarity recommendations

## Error Handling

- **Missing files**: Warns and skips non-existent files
- **Git errors**: Graceful fallback between Git diff strategies
- **API errors**: Catches and reports Claude API exceptions
- **No diff available**: Creates a stub review file when no changes are detected

## Suggestions for Improvement

### 1. Language Detection
The current implementation assumes Python syntax highlighting. Consider adding language detection:

```python
def detect_language(file_path):
    extension_map = {
        '.py': 'python',
        '.js': 'javascript',
        '.java': 'java',
        '.cpp': 'cpp'
    }
    return extension_map.get(os.path.splitext(file_path)[1], 'text')
```

### 2. Configuration File
Consider adding a configuration file for:
- Custom review criteria
- Output directory settings
- Model selection per project

### 3. Batch Processing
For large codebases, implement chunking to handle token limits:

```python
def chunk_files(file_paths, max_size=10000):
    # Implementation to split large file sets
    pass
```

### 4. Integration Options
- Add support for pre-commit hooks
- GitHub Actions integration
- CI/CD pipeline compatibility

## Notes

- The tool creates a `docs/` directory automatically if it doesn't exist
- Each run overwrites the previous review file
- The default token limit is set to 1500 (adjustable based on needs)
- Git diff mode prioritizes changes against `origin/main` branch

## Security Considerations

- Store API keys securely using environment variables
- Avoid committing sensitive code to version control when using file review mode
- Consider rate limiting for large-scale usage