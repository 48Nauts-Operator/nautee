<!-- Auto-generated by Claude on 2025-06-07 23:20 -->

# Claude Review Tool Documentation

## Overview

The Claude Review Tool is a Python script that leverages Anthropic's Claude AI to perform automated code reviews. It can analyze either specific source files or Git diffs, providing structured feedback in Markdown format.

## Purpose

This tool is designed to:
- Automate code review processes using AI
- Provide consistent, structured feedback on code changes
- Support both manual file review and Git-based workflow integration
- Generate readable Markdown reports for easy sharing and documentation

## Features

- **Dual Review Modes**: Review specific files or Git diffs
- **Markdown Output**: Generates structured, readable reports
- **Git Integration**: Automatically detects and reviews changes
- **Configurable AI Model**: Supports different Claude model versions
- **Error Handling**: Graceful handling of missing files and Git errors

## Dependencies

```python
import os
import sys
import anthropic
from dotenv import load_dotenv
from datetime import datetime
import subprocess
```

### Required Packages
- `anthropic` - Official Anthropic API client
- `python-dotenv` - Environment variable management

## Environment Setup

Create a `.env` file with the following variables:

```env
ANTHROPIC_API_KEY=your_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, has default
```

## Usage

### Mode 1: Manual File Review
```bash
python claude_review.py file1.py file2.py [additional_files...]
```

### Mode 2: Git Diff Review
```bash
python claude_review.py
```

## Core Functions

### `load_code(file_paths)`
Combines multiple source files into a single Markdown-formatted string.

**Parameters:**
- `file_paths` (list): List of file paths to process

**Returns:**
- `str`: Markdown-formatted string containing all file contents

**Features:**
- Skips missing files with warning messages
- Formats each file with proper Markdown syntax highlighting
- Assumes Python syntax highlighting (may need adjustment for other languages)

### `get_git_diff()`
Retrieves Git diff output with fallback strategies.

**Returns:**
- `str`: Git diff content or empty string if unavailable

**Fallback Strategy:**
1. First attempts: `git diff origin/main...HEAD`
2. If failed, tries: `git diff HEAD^`
3. Returns empty string if both fail

### `main()`
Primary execution function that orchestrates the entire review process.

**Key Steps:**
1. Environment setup and API client initialization
2. Mode detection (file review vs. Git diff)
3. Prompt generation based on selected mode
4. Claude API interaction
5. Markdown report generation

## Output

The tool generates a Markdown file at `docs/claude_review.md` containing:
- Timestamp of the review
- Structured feedback focusing on:
  - Bugs or logic issues
  - Code clarity
  - Suggested improvements
  - Style consistency

## Notes and Suggestions

### ‚ö†Ô∏è Important Considerations

- **API Key Security**: Ensure your `.env` file is added to `.gitignore`
- **Token Limits**: Current max_tokens is set to 1500, which may be insufficient for large diffs
- **Language Assumption**: Code formatting assumes Python syntax highlighting

### üîß Potential Improvements

1. **Language Detection**: 
   ```python
   # Consider adding file extension detection
   def get_language_from_extension(file_path):
       extensions = {'.py': 'python', '.js': 'javascript', '.java': 'java'}
       return extensions.get(os.path.splitext(file_path)[1], 'text')
   ```

2. **Configurable Token Limits**:
   ```python
   max_tokens = int(os.getenv("MAX_TOKENS", "1500"))
   ```

3. **Better Error Handling**:
   ```python
   # Add specific error handling for different API errors
   except anthropic.APIError as e:
       print(f"‚ùå API Error: {e}")
   except anthropic.RateLimitError as e:
       print(f"‚ùå Rate Limit: {e}")
   ```

4. **Customizable Output Path**:
   ```python
   output_path = os.getenv("OUTPUT_PATH", "docs/claude_review.md")
   ```

### üöÄ Usage Tips

- **CI/CD Integration**: This tool can be integrated into continuous integration pipelines
- **Pre-commit Hook**: Consider using as a Git pre-commit hook for automatic reviews
- **Batch Processing**: For large codebases, consider processing files in batches to stay within token limits

### üìÅ Directory Structure

The tool expects/creates the following structure:
```
project/
‚îú‚îÄ‚îÄ .env                    # Environment variables
‚îú‚îÄ‚îÄ claude_review.py        # Main script
‚îî‚îÄ‚îÄ docs/
    ‚îî‚îÄ‚îÄ claude_review.md    # Generated review output
```