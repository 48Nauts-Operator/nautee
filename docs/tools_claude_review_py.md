<!-- Auto-generated by Claude on 2025-06-22 10:20 -->

# Claude Review Tool Documentation

## Overview

The Claude Review Tool is a Python script that leverages the Anthropic Claude API to perform automated code reviews. It can operate in two modes: reviewing specific source files or analyzing Git diffs. The tool generates structured feedback in Markdown format, making it suitable for documentation and code quality assurance workflows.

## Purpose

- **Automated code review**: Get AI-powered feedback on code quality, bugs, and improvements
- **Git integration**: Review changes in Git diffs automatically
- **Documentation generation**: Output structured Markdown reports for easy sharing and archiving
- **Development workflow integration**: Can be integrated into CI/CD pipelines or used as a standalone tool

## Features

- ‚úÖ **Dual operation modes**: File-based review or Git diff analysis
- ‚úÖ **Markdown output**: Clean, structured feedback format
- ‚úÖ **Error handling**: Graceful handling of missing files and Git issues
- ‚úÖ **Configurable**: Uses environment variables for API configuration
- ‚úÖ **Timestamped reports**: Automatic timestamping of generated reviews

## Requirements

### Dependencies
```python
anthropic      # Claude API client
python-dotenv  # Environment variable management
```

### Environment Variables
```bash
ANTHROPIC_API_KEY=your_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, has default
```

## Usage

### Mode 1: File Review
Review specific source files by passing them as command-line arguments:

```bash
python claude_review.py file1.py file2.py module/file3.py
```

### Mode 2: Git Diff Review
Run without arguments to review Git changes:

```bash
python claude_review.py
```

The tool will attempt to get diffs in this order:
1. `git diff origin/main...HEAD`
2. `git diff HEAD^` (fallback)
3. Skip review if no diff available

## Key Functions

### `load_code(file_paths)`
**Purpose**: Combines multiple source files into a single Markdown-formatted string.

**Parameters**:
- `file_paths` (list): List of file paths to process

**Returns**: 
- `str`: Markdown-formatted string containing all file contents

**Features**:
- Skips missing files with warning messages
- Formats each file with proper Markdown code blocks
- Assumes Python syntax highlighting (may need adjustment for other languages)

### `get_git_diff()`
**Purpose**: Retrieves Git diff output with intelligent fallback logic.

**Returns**:
- `str`: Git diff content or empty string if unavailable

**Logic**:
- Primary: Compare against `origin/main`
- Fallback: Compare against previous commit (`HEAD^`)
- Graceful failure: Returns empty string if Git operations fail

### `main()`
**Purpose**: Main execution function that orchestrates the entire review process.

**Workflow**:
1. Load environment variables and initialize Claude client
2. Determine operation mode based on command-line arguments
3. Prepare appropriate prompt for Claude
4. Make API call and process response
5. Generate timestamped Markdown output

## Output

The tool generates a file at `docs/claude_review.md` with the following structure:

```markdown
# üß† Claude Review

_Last updated: 2024-01-15 14:30_

[Claude's structured feedback here]
```

## Configuration Notes

### API Configuration
- **Required**: `ANTHROPIC_API_KEY` environment variable
- **Optional**: `ANTHROPIC_MODEL` (defaults to `claude-sonnet-4-20250514`)
- **Token limit**: Currently set to 1500 tokens (may need adjustment for large reviews)

### File Handling
- Creates `docs/` directory automatically if it doesn't exist
- Overwrites previous reviews (consider versioning for production use)
- Only processes files that exist (skips missing files with warnings)

## Suggestions for Improvement

### üîß **Language Detection**
```python
# Current assumption: all files are Python
# Consider adding language detection:
def detect_language(file_path):
    extension = os.path.splitext(file_path)[1]
    language_map = {'.py': 'python', '.js': 'javascript', '.go': 'go'}
    return language_map.get(extension, 'text')
```

### üìä **Enhanced Error Handling**
- Add retry logic for API calls
- Implement rate limiting awareness
- Add validation for API key presence

### üîÑ **Output Management**
- Consider adding date-based filenames to preserve review history
- Add option to specify custom output paths
- Implement different output formats (JSON, HTML)

### ‚ö° **Performance Optimization**
- Add file size limits to prevent oversized API calls
- Implement chunking for large diffs
- Add progress indicators for multiple file processing

## Security Considerations

- ‚ö†Ô∏è **API Key**: Ensure `.env` file is in `.gitignore`
- ‚ö†Ô∏è **Code Privacy**: Be aware that code content is sent to Anthropic's API
- ‚ö†Ô∏è **Output Location**: Review files are stored locally in `docs/` directory

## Integration Examples

### Pre-commit Hook
```bash
#!/bin/sh
python claude_review.py && git add docs/claude_review.md
```

### CI/CD Pipeline
```yaml
- name: Generate Code Review
  run: python claude_review.py
- name: Upload Review Artifact
  uses: actions/upload-artifact@v2
  with:
    name: claude-review
    path: docs/claude_review.md
```