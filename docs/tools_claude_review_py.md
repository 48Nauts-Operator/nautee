<!-- Auto-generated by Claude on 2025-05-31 20:31 -->

# Code Review Script Documentation

## Overview

This Python script provides automated code review functionality using Anthropic's Claude AI. It can operate in two modes: reviewing individual files or analyzing Git diffs. The script generates structured feedback in Markdown format and saves the results to an output directory.

## Purpose

- **File Review**: Analyze one or more specific Python files for bugs, clarity, and style improvements
- **Git Diff Review**: Automatically review changes between Git revisions
- **CI/CD Integration**: Designed to work in continuous integration environments
- **Structured Output**: Generates timestamped Markdown reports for easy consumption

## Prerequisites

### Required Dependencies
```bash
pip install anthropic python-dotenv
```

### Environment Variables
Create a `.env` file with the following variables:
```env
ANTHROPIC_API_KEY=your_claude_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, has default
```

## Usage Modes

### Mode 1: Manual File Review
Review specific files by passing them as command-line arguments:
```bash
python review_script.py file1.py file2.py
```

### Mode 2: Git Diff Review
Run without arguments to automatically review Git changes:
```bash
python review_script.py
```

The script will attempt to compare:
1. `origin/main...HEAD` (preferred)
2. `HEAD^` (fallback)
3. Generate stub output if no Git history available

## Key Functions and Features

### File Processing
- **Multi-file support**: Can review multiple files simultaneously
- **Missing file handling**: Gracefully skips non-existent files with warnings
- **Content combination**: Merges multiple files into a single review context

### Git Integration
- **Automatic diff detection**: Tries multiple Git comparison strategies
- **Fallback mechanisms**: Handles repositories without `origin/main`
- **Error resilience**: Creates stub output when Git operations fail

### Output Management
- **Timestamped files**: Uses ISO format timestamps for unique filenames
- **Markdown formatting**: Structured output for easy reading
- **Organized storage**: All reviews saved to `output/` directory

## Code Structure

### Configuration Section
```python
load_dotenv()
client = anthropic.Anthropic(api_key=os.getenv("ANTHROPIC_API_KEY"))
model = os.getenv("ANTHROPIC_MODEL", "claude-sonnet-4-20250514")
```

### Review Focus Areas
The script instructs Claude to focus on:
- **Bugs or logic issues**
- **Code clarity**
- **Suggested improvements** 
- **Style consistency**

## Output Format

Generated files follow this naming pattern:
- File reviews: `claude_review_{filename}_{timestamp}.md`
- Git diffs: `claude_review_git_diff_{comparison}_{timestamp}.md`
- Stub files: `claude_review_nodiff_{timestamp}.md`

## Error Handling

### Robust Fallback Strategy
- Missing files are skipped with warnings
- Git failures trigger alternative comparison methods
- API errors terminate with proper exit codes
- Stub generation prevents CI pipeline failures

### Exit Codes
- `0`: Success or graceful fallback
- `1`: Claude API failure

## Suggestions for Improvement

### Security Enhancements
- Add API key validation before making calls
- Implement rate limiting for large diffs
- Consider file size limits to avoid token overflow

### Functionality Extensions
```python
# Potential additions:
- Support for multiple programming languages
- Configurable review criteria
- Integration with GitHub PR comments
- Custom output templates
```

### Configuration Options
Consider adding these environment variables:
```env
MAX_TOKENS=1500
OUTPUT_DIRECTORY=output
REVIEW_TEMPLATE=default
```

## Notes

- **Token Limit**: Currently set to 1500 tokens maximum
- **File Types**: Optimized for Python files but can handle other text files
- **CI Friendly**: Designed to work in automated environments
- **Markdown Output**: Ensures compatibility with documentation systems

## Example Output Structure

```markdown
# Claude Review

## Overview
[Summary of changes or files reviewed]

## Issues Found
- [Specific bugs or problems]

## Suggestions
- [Improvement recommendations]

## Style Notes
- [Consistency and formatting feedback]
```