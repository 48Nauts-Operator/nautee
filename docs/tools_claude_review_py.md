<!-- Auto-generated by Claude on 2025-06-22 19:15 -->

# Claude Review Tool Documentation

## Overview

The Claude Review Tool is a Python script that automates code review using Anthropic's Claude AI model. It can analyze either specific source files or Git diffs and generates structured feedback in Markdown format.

## Purpose

This tool serves as an automated code reviewer that:
- Identifies bugs and logic issues
- Suggests code improvements
- Checks for style consistency
- Provides structured feedback in a readable format

## Requirements

- Python 3.x
- Required packages: `anthropic`, `python-dotenv`
- Git (for diff review mode)
- Anthropic API key

## Environment Setup

Create a `.env` file in your project root with:

```env
ANTHROPIC_API_KEY=your_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, defaults to this model
```

## Usage Modes

### Mode 1: Manual File Review
Review specific files by providing file paths as arguments:

```bash
python claude_review.py file1.py file2.py
```

### Mode 2: Git Diff Review
Review Git changes by running without arguments:

```bash
python claude_review.py
```

The tool will attempt to get the diff using:
1. `git diff origin/main...HEAD` (primary)
2. `git diff HEAD^` (fallback)

## Key Functions

### `load_code(file_paths)`
Combines multiple source files into a single Markdown-formatted string.

**Parameters:**
- `file_paths` (list): List of file paths to process

**Returns:**
- `str`: Markdown-formatted string containing all file contents

**Features:**
- Skips missing files with warning messages
- Formats each file with appropriate code blocks
- Assumes Python syntax highlighting

### `get_git_diff()`
Retrieves Git diff output with fallback strategy.

**Returns:**
- `str`: Git diff output or empty string if unavailable

**Behavior:**
- First tries comparing against `origin/main`
- Falls back to `HEAD^` if origin/main doesn't exist
- Returns empty string if both methods fail

### `main()`
Main execution function that orchestrates the review process:

1. **Setup Phase:**
   - Loads environment variables
   - Initializes Anthropic client
   - Creates output directory
   - Determines review mode based on arguments

2. **Content Preparation:**
   - Loads files or retrieves Git diff
   - Constructs appropriate prompt for Claude

3. **API Interaction:**
   - Sends prompt to Claude API
   - Processes response and saves to Markdown file

## Output

The tool generates a Markdown file at `docs/claude_review.md` containing:
- Review header with timestamp
- Structured feedback from Claude
- Analysis of bugs, improvements, and style issues

## Error Handling

- **Missing Files:** Warns and skips non-existent files
- **Git Errors:** Gracefully falls back between diff strategies
- **API Errors:** Exits with error code 1 and descriptive message
- **No Diff Available:** Creates stub review file

## Notes and Suggestions

### Strengths
- âœ… Flexible dual-mode operation
- âœ… Robust error handling with fallbacks
- âœ… Clean output formatting with timestamps
- âœ… Environment variable configuration

### Areas for Improvement

1. **Language Detection:** Currently assumes Python syntax highlighting
   ```python
   # Consider detecting file extensions
   language = file_path.split('.')[-1] if '.' in file_path else 'text'
   ```

2. **File Size Limits:** No check for token limits with large files
   ```python
   # Add file size validation
   if len(content) > MAX_CONTENT_LENGTH:
       content = content[:MAX_CONTENT_LENGTH] + "\n# ... (truncated)"
   ```

3. **Configuration:** Hard-coded model and token limits
   ```python
   max_tokens = int(os.getenv("MAX_TOKENS", "1500"))
   ```

4. **Logging:** Consider using Python's `logging` module instead of print statements

### Security Considerations
- Ensure `.env` file is in `.gitignore`
- API key should have appropriate rate limiting
- Be cautious when reviewing sensitive code

## Example Output Structure

```markdown
# ðŸ§  Claude Review

_Last updated: 2024-01-15 14:30_

## Summary
Overall code quality analysis...

## Issues Found
- Bug in function X
- Style inconsistency in file Y

## Suggestions
- Consider refactoring...
- Add error handling...
```