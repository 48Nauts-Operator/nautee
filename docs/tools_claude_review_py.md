<!-- Auto-generated by Claude on 2025-06-01 17:16 -->

# Claude Review Tool Documentation

## Overview

The **Claude Review Tool** is a Python script that leverages Anthropic's Claude AI to perform automated code reviews. It can operate in two modes: reviewing specific source files or analyzing Git diffs. The tool generates structured feedback in Markdown format, making it easy to integrate into development workflows.

## Purpose

- **Automated Code Review**: Get AI-powered feedback on code quality, bugs, and improvements
- **Git Integration**: Review changes in pull requests or commits using Git diffs
- **Documentation Generation**: Output structured reviews in Markdown format for easy sharing
- **Development Workflow**: Streamline code review processes in teams

## Requirements

### Dependencies

- `anthropic` - Anthropic's Python client library
- `python-dotenv` - Environment variable management
- `subprocess` - Git command execution (built-in)
- `os`, `sys`, `datetime` - Standard library modules

### Environment Variables

Create a `.env` file with the following variables:

```env
ANTHROPIC_API_KEY=your_claude_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, defaults to this model
```

## Usage

### Mode 1: File Review

Review specific source files:

```bash
python claude_review.py file1.py file2.py file3.py
```

### Mode 2: Git Diff Review

Review Git changes (no arguments):

```bash
python claude_review.py
```

## Key Functions

### `load_code(file_paths)`

Combines multiple source files into a single Markdown-formatted string.

**Parameters:**
- `file_paths` (list): List of file paths to process

**Returns:**
- `str`: Markdown-formatted string containing all file contents

**Features:**
- Skips missing files with warning messages
- Formats each file as a separate code block
- Assumes Python syntax highlighting (hardcoded)

### `get_git_diff()`

Retrieves Git diff output with fallback strategies.

**Returns:**
- `str`: Git diff content or empty string if unavailable

**Fallback Strategy:**
1. Tries `git diff origin/main...HEAD` first
2. Falls back to `git diff HEAD^` if origin/main doesn't exist
3. Returns empty string if both fail

### `main()`

Main execution function that orchestrates the review process.

**Workflow:**
1. Loads environment variables and initializes Claude client
2. Creates output directory (`docs/`)
3. Determines review mode based on command-line arguments
4. Sends appropriate prompt to Claude API
5. Saves formatted review to `docs/claude_review.md`

## Output Format

The tool generates a Markdown file (`docs/claude_review.md`) with:

- **Header**: "🧠 Claude Review"
- **Timestamp**: Last updated date/time
- **Structured Feedback**: Claude's analysis focusing on:
  - Bugs or logic issues
  - Code clarity
  - Suggested improvements
  - Style consistency

## Error Handling

- **Missing Files**: Skipped with warning messages
- **Git Errors**: Graceful fallback between diff strategies
- **API Errors**: Explicit error messages with exit code 1
- **No Diff Available**: Creates stub review file

## Configuration

### Model Selection

Default model: `claude-sonnet-4-20250514`

Override via environment variable:
```env
ANTHROPIC_MODEL=your_preferred_model
```

### Token Limit

Currently set to **1500 tokens** maximum response length.

## Notes and Suggestions

### ⚠️ Current Limitations

1. **Language Detection**: Hardcoded to assume Python syntax highlighting
2. **File Size**: No validation for large files that might exceed token limits
3. **Output Location**: Fixed to `docs/claude_review.md` (not configurable)

### 🔧 Suggested Improvements

1. **Dynamic Language Detection**:
   ```python
   # Detect file extension and use appropriate syntax highlighting
   extension = os.path.splitext(file_path)[1]
   language = {'py': 'python', 'js': 'javascript', 'java': 'java'}.get(extension[1:], '')
   ```

2. **Configurable Output**:
   ```python
   output_path = os.getenv("REVIEW_OUTPUT_PATH", "docs/claude_review.md")
   ```

3. **File Size Validation**:
   ```python
   if os.path.getsize(file_path) > MAX_FILE_SIZE:
       print(f"⚠️ File {file_path} too large, skipping...")
   ```

4. **Multiple Output Formats**: Support for JSON, HTML, or plain text output

### 💡 Usage Tips

- **Git Workflow**: Run without arguments in feature branches for automatic diff review
- **Pre-commit Hook**: Integrate into Git pre-commit hooks for automatic review
- **CI/CD Integration**: Use in continuous integration pipelines
- **Team Reviews**: Share generated Markdown files in pull request comments

### 🔒 Security Considerations

- Store API keys securely using `.env` files
- Add `.env` to `.gitignore` to prevent accidental commits
- Consider using environment-specific API keys for different deployment stages