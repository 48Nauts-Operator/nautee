<!-- Auto-generated by Claude on 2025-06-07 22:18 -->

# Claude Review Tool Documentation

## Overview

The **Claude Review Tool** is a Python script that provides automated code review functionality using Anthropic's Claude AI. It can operate in two modes: reviewing specific source files or analyzing Git diffs. The tool generates structured feedback in Markdown format, making it easy to integrate into development workflows.

## Purpose

- Automate code review processes using AI
- Provide consistent, structured feedback on code changes
- Support both file-based and Git diff-based reviews
- Generate readable Markdown reports for documentation

## Requirements

- Python 3.x
- `anthropic` library
- `python-dotenv` library
- Git (for diff mode)
- Environment variables for API configuration

## Configuration

The script requires the following environment variables (typically stored in a `.env` file):

```bash
ANTHROPIC_API_KEY=your_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, defaults to specified model
```

## Usage Modes

### Mode 1: File Review
Review specific source files by providing file paths as command-line arguments:

```bash
python claude_review.py file1.py file2.py file3.py
```

### Mode 2: Git Diff Review
Review changes in a Git repository (no arguments required):

```bash
python claude_review.py
```

The tool attempts to get diffs in the following order:
1. `git diff origin/main...HEAD`
2. `git diff HEAD^` (fallback)

## Key Functions

### `load_code(file_paths)`

Combines multiple source files into a single Markdown-formatted string.

**Parameters:**
- `file_paths` (list): List of file paths to process

**Returns:**
- `str`: Markdown-formatted string containing all file contents

**Features:**
- Handles missing files gracefully with warnings
- Formats code with proper syntax highlighting
- Creates structured sections for each file

### `get_git_diff()`

Retrieves Git diff output with fallback strategies.

**Returns:**
- `str`: Git diff content or empty string if unavailable

**Behavior:**
- First attempts to diff against `origin/main`
- Falls back to `HEAD^` if main branch unavailable
- Returns empty string if Git operations fail

### `main()`

Main execution function that orchestrates the review process.

**Key responsibilities:**
- Environment setup and API client initialization
- Mode detection based on command-line arguments
- Prompt construction for Claude API
- API communication and error handling
- Output file generation

## Output

The tool generates a Markdown file at `docs/claude_review.md` containing:

- **Header**: "ðŸ§  Claude Review" with timestamp
- **Structured feedback** focusing on:
  - Bugs or logic issues
  - Code clarity and readability
  - Suggested improvements
  - Style consistency

## Error Handling

- **Missing files**: Skipped with warning messages
- **Git errors**: Graceful fallback between diff strategies
- **API errors**: Proper error reporting and script termination
- **No diff available**: Creates stub review file

## Notes and Suggestions

### Best Practices

- **Environment Security**: Store API keys in `.env` files, not in code
- **File Organization**: The script automatically creates a `docs/` directory
- **Model Selection**: Configure the appropriate Claude model for your needs

### Limitations

- **File Type Assumption**: Currently assumes Python files (`.py`) in syntax highlighting
- **Token Limits**: Limited to 1500 tokens for responses
- **Single Output**: Overwrites previous reviews in the same location

### Potential Improvements

1. **Multi-language Support**: 
   ```python
   # Detect file extension and use appropriate syntax highlighting
   file_extension = os.path.splitext(file_path)[1][1:]  # Remove the dot
   ```

2. **Configurable Output Location**:
   ```python
   output_path = os.getenv("REVIEW_OUTPUT_PATH", "docs/claude_review.md")
   ```

3. **Incremental Reviews**: Add timestamp-based file naming to preserve review history

4. **Custom Prompts**: Allow custom review criteria through configuration files

## Integration Examples

### CI/CD Pipeline
```yaml
- name: Run Claude Review
  run: python claude_review.py
  env:
    ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
```

### Pre-commit Hook
```bash
#!/bin/bash
python claude_review.py $(git diff --cached --name-only --diff-filter=ACM)
```