<!-- Auto-generated by Claude on 2025-06-01 13:27 -->

# Claude Review Tool Documentation

## Overview

The Claude Review Tool is a Python script that automates code reviews using Anthropic's Claude AI model. It provides structured feedback on source code by analyzing either specific files or Git diffs, outputting the results as a formatted Markdown document.

## Purpose

This tool serves two primary functions:
- **Manual File Review**: Analyze specific source files provided as command-line arguments
- **Git Diff Review**: Automatically review changes between Git commits using diff output

The generated reviews focus on code quality, potential bugs, clarity improvements, and style consistency.

## Setup Requirements

### Environment Variables
The script requires the following environment variables (loaded via `.env` file):

- `ANTHROPIC_API_KEY`: Your Anthropic API key for Claude access
- `ANTHROPIC_MODEL` (optional): Claude model to use (defaults to `claude-sonnet-4-20250514`)

### Dependencies
```python
pip install anthropic python-dotenv
```

## Usage

### Mode 1: Manual File Review
```bash
python claude_review.py file1.py file2.py [additional_files...]
```

### Mode 2: Git Diff Review
```bash
python claude_review.py
```
*(No arguments - automatically detects and reviews Git changes)*

## Key Functions

### `load_code(file_paths)`
**Purpose**: Combines multiple source files into a single Markdown-formatted string for review.

**Parameters**:
- `file_paths` (list): List of file paths to process

**Returns**:
- `str`: Markdown-formatted string containing all source files

**Features**:
- Handles missing files gracefully with warnings
- Formats each file with proper Markdown code blocks
- Assumes Python syntax highlighting

### `get_git_diff()`
**Purpose**: Retrieves Git diff output with fallback strategies.

**Returns**:
- `str`: Git diff string or empty string if unavailable

**Behavior**:
- First attempts: `git diff origin/main...HEAD`
- Fallback: `git diff HEAD^` if origin/main doesn't exist
- Returns empty string if both fail

### `main()`
**Purpose**: Main execution function that orchestrates the entire review process.

**Workflow**:
1. Loads environment configuration
2. Determines review mode based on command-line arguments
3. Prepares appropriate prompt for Claude
4. Makes API call to Claude
5. Saves formatted review to `docs/claude_review.md`

## Output

The tool generates a Markdown file at `docs/claude_review.md` with:
- Timestamp of review
- Structured feedback from Claude
- Focus areas: bugs, clarity, improvements, style consistency

## Error Handling

- **Missing Files**: Warns and skips non-existent files
- **Git Errors**: Graceful fallback between different Git diff strategies  
- **API Errors**: Exits with error code 1 and descriptive message
- **No Diff Available**: Creates stub review file when no changes detected

## Notes and Suggestions

### Strengths
- ✅ Flexible dual-mode operation
- ✅ Robust error handling with user-friendly messages
- ✅ Automatic output directory creation
- ✅ Clean Markdown formatting

### Areas for Improvement

1. **Language Detection**: Currently assumes Python syntax - consider auto-detecting file types
   ```python
   # Suggested enhancement
   def get_language_from_extension(file_path):
       extensions = {'.py': 'python', '.js': 'javascript', '.java': 'java'}
       return extensions.get(os.path.splitext(file_path)[1], 'text')
   ```

2. **Configuration**: Consider adding a config file for customizable review criteria

3. **Token Management**: The 1500 token limit might be restrictive for large diffs

4. **Git Branch Flexibility**: Allow custom branch comparisons via command-line arguments

### Security Considerations
- Ensure `.env` file is in `.gitignore`
- API key should have appropriate permissions only
- Be mindful of sending sensitive code to external AI services

## Example Usage

```bash
# Review specific files
python claude_review.py src/main.py tests/test_main.py

# Review current Git changes
python claude_review.py

# Output will be saved to docs/claude_review.md
```