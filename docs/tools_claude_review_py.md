<!-- Auto-generated by Claude on 2025-06-08 04:30 -->

# Claude Review Tool Documentation

## Overview

The Claude Review Tool is a Python script that leverages Anthropic's Claude AI to perform automated code reviews. It can operate in two modes: reviewing specific source files or analyzing Git diffs. The tool generates structured feedback in Markdown format, making it easy to integrate into development workflows.

## Purpose

- **Automated Code Review**: Get AI-powered feedback on code quality, bugs, and improvements
- **Git Integration**: Review changes in Git diffs automatically
- **Documentation Generation**: Output structured reviews in Markdown format
- **Development Workflow Integration**: Easy to incorporate into CI/CD pipelines or local development

## Requirements

### Dependencies
- `anthropic` - Claude AI API client
- `python-dotenv` - Environment variable management
- `subprocess` - Git command execution
- Standard library modules: `os`, `sys`, `datetime`

### Environment Variables
- `ANTHROPIC_API_KEY` - Required API key for Claude access
- `ANTHROPIC_MODEL` - Optional model specification (defaults to `claude-sonnet-4-20250514`)

## Usage

### Mode 1: File Review
```bash
python claude_review.py file1.py file2.py file3.py
```
Reviews specific files provided as command-line arguments.

### Mode 2: Git Diff Review
```bash
python claude_review.py
```
Reviews Git changes when no files are specified.

## Key Functions

### `load_code(file_paths)`
Combines multiple source files into a single Markdown-formatted string.

**Parameters:**
- `file_paths` (list): List of file paths to process

**Returns:**
- `str`: Markdown-formatted string containing all file contents

**Features:**
- Handles missing files gracefully with warnings
- Formats code in proper Markdown code blocks
- Includes file path headers for clarity

### `get_git_diff()`
Retrieves Git diff output with fallback strategies.

**Returns:**
- `str`: Git diff content or empty string if unavailable

**Behavior:**
- First attempts: `git diff origin/main...HEAD`
- Fallback: `git diff HEAD^`
- Returns empty string if both fail

### `main()`
Primary execution function that orchestrates the review process.

**Workflow:**
1. Loads environment configuration
2. Determines review mode (files vs. diff)
3. Prepares appropriate prompt for Claude
4. Calls Claude API
5. Saves formatted review to `docs/claude_review.md`

## Output Format

The tool generates a Markdown file at `docs/claude_review.md` with:
- Header with brain emoji (üß†)
- Timestamp of review
- Structured feedback from Claude
- Focus areas include:
  - Bugs or logic issues
  - Code clarity
  - Suggested improvements
  - Style consistency

## Error Handling

### Graceful Degradation
- **Missing Files**: Continues processing with warnings
- **Git Errors**: Falls back to alternative diff strategies
- **No Diff Available**: Creates stub review file
- **API Errors**: Exits with error code 1

### User Feedback
The script provides clear status messages using emojis:
- üì¶ Git operations
- ‚ö†Ô∏è Warnings
- ‚úÖ Success
- ‚ùå Errors
- üìù File operations

## Configuration Notes

### Model Selection
- Default model: `claude-sonnet-4-20250514`
- Override via `ANTHROPIC_MODEL` environment variable
- Token limit: 1500 (may need adjustment for large reviews)

### Output Directory
- Creates `docs/` directory automatically
- Always outputs to `docs/claude_review.md`
- Overwrites previous reviews

## Suggestions for Improvement

### Security
- Consider validating file paths to prevent directory traversal
- Add input sanitization for Git commands

### Functionality
- Add support for multiple output formats (JSON, HTML)
- Implement file size limits to prevent API quota exhaustion
- Add configuration file support for custom prompts

### Error Handling
- Implement retry logic for API failures
- Add more specific error messages for different failure modes
- Consider logging for debugging purposes

### Performance
- Add file caching to avoid re-reviewing unchanged files
- Implement incremental reviews for large codebases
- Add progress indicators for large file sets

## Integration Examples

### Pre-commit Hook
```bash
#!/bin/sh
python claude_review.py
```

### CI/CD Pipeline
```yaml
- name: Code Review
  run: python claude_review.py $(git diff --name-only HEAD^)
```