<!-- Auto-generated by Claude on 2025-06-23 10:23 -->

# Claude Review Tool Documentation

## Overview

The Claude Review Tool is a Python script that leverages Anthropic's Claude AI to perform automated code reviews. It supports two modes of operation:

1. **Manual File Review**: Reviews specific source files provided as command-line arguments
2. **Git Diff Review**: Reviews changes between Git commits automatically

The tool outputs structured feedback in Markdown format, making it easy to integrate into development workflows and documentation.

## Purpose

- Automate code review processes using AI
- Provide consistent, structured feedback on code quality
- Support both targeted file reviews and Git-based change reviews
- Generate documentation-ready output in Markdown format

## Requirements

- Python 3.x
- `anthropic` Python package
- `python-dotenv` package
- Git (for diff mode)
- Anthropic API key

## Environment Setup

Create a `.env` file in your project root with the following variables:

```env
ANTHROPIC_API_KEY=your_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, defaults to this model
```

## Usage

### Mode 1: Manual File Review
```bash
python claude_review.py file1.py file2.py [additional_files...]
```

### Mode 2: Git Diff Review
```bash
python claude_review.py
```

## Key Functions

### `load_code(file_paths)`

Combines multiple source files into a single Markdown-formatted string for review.

**Parameters:**
- `file_paths` (list): List of file paths to process

**Returns:**
- `str`: Markdown-formatted string containing all file contents

**Features:**
- Handles missing files gracefully with warning messages
- Formats each file with proper Markdown code blocks
- Assumes Python syntax highlighting (may need adjustment for other languages)

### `get_git_diff()`

Retrieves Git diff output with fallback logic for different Git configurations.

**Returns:**
- `str`: Git diff string or empty string if unavailable

**Behavior:**
- First attempts `git diff origin/main...HEAD`
- Falls back to `git diff HEAD^` if origin/main doesn't exist
- Returns empty string if both commands fail

### `main()`

Main execution function that orchestrates the review process.

**Key Steps:**
1. Loads environment variables and initializes Claude client
2. Creates output directory structure
3. Determines review mode based on command-line arguments
4. Constructs appropriate prompts for Claude
5. Makes API call and processes response
6. Saves formatted output to Markdown file

## Output

The tool generates a Markdown file at `docs/claude_review.md` containing:

- Timestamp of the review
- Structured feedback focusing on:
  - Bugs or logic issues
  - Code clarity
  - Suggested improvements
  - Style consistency

## Error Handling

- **Missing Files**: Skips non-existent files with warning messages
- **Git Errors**: Provides fallback diff strategies
- **API Errors**: Catches and reports Claude API exceptions
- **No Changes**: Creates stub review file when no diff is available

## Notes and Suggestions

### Current Limitations

- **Language Assumption**: Code blocks are hardcoded with Python syntax highlighting
- **File Type Detection**: No automatic detection of programming language
- **Token Limits**: Limited to 1500 tokens in Claude response

### Recommended Improvements

1. **Dynamic Language Detection**:
   ```python
   def detect_language(file_path):
       extension_map = {'.py': 'python', '.js': 'javascript', '.java': 'java'}
       return extension_map.get(os.path.splitext(file_path)[1], 'text')
   ```

2. **Configurable Token Limits**:
   ```python
   max_tokens = int(os.getenv("ANTHROPIC_MAX_TOKENS", "1500"))
   ```

3. **Enhanced Error Logging**:
   Consider adding proper logging instead of print statements for better debugging.

4. **Configuration File Support**:
   Add support for a configuration file to customize review criteria and output formats.

### Integration Tips

- Add this tool to your CI/CD pipeline for automated code reviews
- Use as a pre-commit hook for immediate feedback
- Integrate with GitHub Actions for pull request reviews
- Consider rate limiting for large codebases to avoid API limits

### Security Considerations

- Store API keys securely using environment variables
- Be cautious when reviewing proprietary code through external APIs
- Consider using local models for sensitive codebases