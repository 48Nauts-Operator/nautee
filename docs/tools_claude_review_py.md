<!-- Auto-generated by Claude on 2025-06-22 03:25 -->

# Claude Review Tool Documentation

## Overview

The Claude Review Tool is a Python script that provides automated code review functionality using Anthropic's Claude AI. It can analyze either specific source files or Git diffs, generating structured feedback in Markdown format.

## Purpose

This tool helps developers get AI-powered code reviews by:
- Analyzing individual source files for bugs, clarity, and improvements
- Reviewing Git diffs to catch issues in code changes
- Generating consistent, structured feedback in Markdown format
- Integrating easily into development workflows

## Features

- **Dual Operation Modes**: Review specific files or Git diffs
- **Automatic Git Integration**: Attempts multiple Git diff strategies
- **Markdown Output**: Generates well-formatted review documents
- **Error Handling**: Gracefully handles missing files and Git errors
- **Configurable**: Uses environment variables for API configuration

## Requirements

- Python 3.x
- Required packages:
  - `anthropic`
  - `python-dotenv`
- Environment variables:
  - `ANTHROPIC_API_KEY` (required)
  - `ANTHROPIC_MODEL` (optional, defaults to `claude-sonnet-4-20250514`)

## Usage

### Mode 1: File Review
```bash
python claude_review.py file1.py file2.py [additional_files...]
```

### Mode 2: Git Diff Review
```bash
python claude_review.py
```

## Functions

### `load_code(file_paths)`

Combines multiple source files into a single Markdown-formatted string for review.

**Parameters:**
- `file_paths` (list): List of file paths to process

**Returns:**
- `str`: Markdown-formatted string containing all file contents

**Features:**
- Skips missing files with warning messages
- Formats each file as a separate code block
- Assumes Python syntax highlighting (hardcoded)

### `get_git_diff()`

Retrieves Git diff output using a fallback strategy.

**Returns:**
- `str`: Git diff content or empty string if unavailable

**Strategy:**
1. First attempts: `git diff origin/main...HEAD`
2. Fallback: `git diff HEAD^`
3. Returns empty string if both fail

### `main()`

Main execution function that orchestrates the review process.

**Process:**
1. Loads environment variables and initializes Claude client
2. Creates output directory (`docs/`)
3. Determines operation mode based on command-line arguments
4. Generates appropriate prompt for Claude
5. Calls Claude API and saves formatted review

## Output

The tool generates a file at `docs/claude_review.md` containing:
- Header with brain emoji and timestamp
- Structured feedback focusing on:
  - Bugs or logic issues
  - Code clarity
  - Suggested improvements
  - Style consistency

## Configuration

Create a `.env` file in the project root:

```bash
ANTHROPIC_API_KEY=your_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional
```

## Error Handling

- **Missing Files**: Skipped with warning messages
- **Git Errors**: Falls back to alternative diff commands
- **API Errors**: Exits with error code 1 and descriptive message
- **No Diff Available**: Creates stub review file

## Suggestions for Improvement

### Code Quality
- **Language Detection**: Currently hardcodes Python syntax highlighting
- **File Type Validation**: Could validate file extensions before processing
- **Configurable Output**: Make output directory and filename configurable

### Functionality
- **Custom Prompts**: Allow users to specify custom review criteria
- **Batch Processing**: Add support for directory-wide reviews
- **Integration**: Add hooks for CI/CD pipeline integration

### Error Handling
- **Retry Logic**: Implement retry mechanism for API failures
- **Validation**: Add API key validation before processing
- **Logging**: Replace print statements with proper logging

### Example Enhancement
```python
# Suggested improvement for language detection
def detect_language(file_path):
    """Detect programming language from file extension."""
    extension_map = {
        '.py': 'python',
        '.js': 'javascript',
        '.java': 'java',
        '.cpp': 'cpp',
        '.c': 'c'
    }
    ext = os.path.splitext(file_path)[1]
    return extension_map.get(ext, 'text')
```

## Notes

- The tool creates a `docs/` directory automatically
- Reviews are timestamped for tracking purposes
- The Claude model can be customized via environment variables
- Git diff mode prioritizes comparing against `origin/main` branch