<!-- Auto-generated by Claude on 2025-06-22 09:20 -->

# Claude Review Tool Documentation

## Overview

The Claude Review Tool is a Python script that leverages Anthropic's Claude AI to perform automated code reviews. It can analyze either specific source files or Git diffs, providing structured feedback in Markdown format.

## Purpose

This tool automates the code review process by:
- Analyzing individual source files for bugs, clarity, and style issues
- Reviewing Git diffs to provide feedback on code changes
- Generating structured, readable feedback in Markdown format
- Integrating with development workflows for continuous code quality improvement

## Features

- **Dual Operation Modes**: Review specific files or Git diffs
- **Markdown Output**: Generates clean, structured feedback
- **Git Integration**: Automatically detects and reviews changes
- **Error Handling**: Graceful handling of missing files and Git errors
- **Configurable**: Uses environment variables for API configuration

## Installation & Setup

### Prerequisites

```bash
pip install anthropic python-dotenv
```

### Environment Configuration

Create a `.env` file in your project root:

```env
ANTHROPIC_API_KEY=your_claude_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, defaults to this model
```

## Usage

### Mode 1: File Review
Review specific source files:

```bash
python claude_review.py file1.py file2.py module/file3.py
```

### Mode 2: Git Diff Review
Review Git changes (no arguments):

```bash
python claude_review.py
```

## Core Functions

### `load_code(file_paths)`

Combines multiple source files into a single Markdown-formatted string for review.

**Parameters:**
- `file_paths` (list): List of file paths to load

**Returns:**
- `str`: Markdown-formatted string containing all file contents

**Features:**
- Skips missing files with warning messages
- Formats each file as a separate code block
- Preserves file structure and naming

### `get_git_diff()`

Retrieves Git diff output with fallback strategies.

**Returns:**
- `str`: Git diff content or empty string if unavailable

**Behavior:**
- First attempts `git diff origin/main...HEAD`
- Falls back to `git diff HEAD^` if origin/main doesn't exist
- Returns empty string if Git operations fail

### `main()`

Primary execution function that orchestrates the review process.

**Workflow:**
1. Loads environment variables and initializes Claude client
2. Determines operation mode based on command-line arguments
3. Prepares appropriate prompt for Claude
4. Calls Claude API for review
5. Saves formatted output to `docs/claude_review.md`

## Output

The tool generates a Markdown file at `docs/claude_review.md` with:
- Timestamp of the review
- Structured feedback focusing on:
  - Bugs or logic issues
  - Code clarity
  - Suggested improvements
  - Style consistency

## Error Handling

- **Missing Files**: Skips with warning, continues processing
- **Git Errors**: Provides fallback diff strategies
- **API Errors**: Exits gracefully with error message
- **No Changes**: Creates stub review file when no diff is available

## Configuration Options

| Environment Variable | Default Value | Description |
|---------------------|---------------|-------------|
| `ANTHROPIC_API_KEY` | Required | Your Claude API key |
| `ANTHROPIC_MODEL` | `claude-sonnet-4-20250514` | Claude model to use |

## Best Practices

### Usage Recommendations
- Run as part of your CI/CD pipeline for automated reviews
- Use file mode for initial code review of new modules
- Use diff mode for pull request reviews
- Review the generated Markdown file before acting on suggestions

### Integration Tips
- Add to pre-commit hooks for automatic review
- Include in GitHub Actions for PR reviews
- Combine with other static analysis tools for comprehensive coverage

## Limitations

- **API Rate Limits**: Subject to Anthropic's API rate limiting
- **Token Limits**: Large files may exceed the 1500 token response limit
- **Git Dependency**: Diff mode requires Git repository context
- **Python Focus**: Optimized for Python files but can handle other languages

## Notes

- The `docs/` directory is created automatically if it doesn't exist
- Each run overwrites the previous review file
- The tool assumes Python syntax highlighting but works with other languages
- Consider adjusting the `max_tokens` parameter for longer reviews

## Troubleshooting

**Common Issues:**
- **"No API key found"**: Ensure `.env` file contains valid `ANTHROPIC_API_KEY`
- **"No diff available"**: Check if you're in a Git repository with changes
- **"File not found"**: Verify file paths are correct and accessible
- **API errors**: Check your Anthropic account status and API key validity