<!-- Auto-generated by Claude on 2025-06-01 18:24 -->

# Claude Review Tool Documentation

## Overview

The Claude Review Tool is a Python script that leverages the Anthropic Claude API to perform automated code reviews. It can analyze either specific source files or Git diffs, providing structured feedback in Markdown format.

## Purpose

This tool serves as an automated code review assistant that:
- Analyzes Python source code for bugs, clarity, and style issues
- Reviews Git diffs to provide feedback on code changes
- Generates structured, readable feedback in Markdown format
- Integrates into development workflows for consistent code quality

## Features

- **Dual Mode Operation**: Works with either specified files or Git diffs
- **Markdown Output**: Generates well-formatted documentation
- **Git Integration**: Automatically detects and reviews code changes
- **Configurable**: Uses environment variables for API configuration
- **Error Handling**: Gracefully handles missing files and API errors

## Dependencies

```python
import os
import sys
import anthropic
from dotenv import load_dotenv
from datetime import datetime
import subprocess
```

### Required Packages
- `anthropic` - Claude API client
- `python-dotenv` - Environment variable management

## Configuration

### Environment Variables

Create a `.env` file with the following variables:

```bash
ANTHROPIC_API_KEY=your_claude_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, defaults to specified model
```

## Usage

### Mode 1: File Review
Review specific source files:
```bash
python claude_review.py file1.py file2.py file3.py
```

### Mode 2: Git Diff Review
Review changes in Git repository:
```bash
python claude_review.py
```

## Key Functions

### `load_code(file_paths)`
Combines multiple source files into a single Markdown-formatted string.

**Parameters:**
- `file_paths` (list): List of file paths to process

**Returns:**
- `str`: Markdown-formatted string containing all file contents

**Features:**
- Skips missing files with warning messages
- Formats each file with appropriate Markdown syntax highlighting

### `get_git_diff()`
Retrieves Git diff output using subprocess calls.

**Returns:**
- `str`: Git diff content or empty string if unavailable

**Behavior:**
- First attempts `git diff origin/main...HEAD`
- Falls back to `git diff HEAD^` if origin/main doesn't exist
- Returns empty string if both commands fail

### `main()`
Primary execution function that orchestrates the review process.

**Key Responsibilities:**
- Environment setup and API client initialization
- Mode detection (file review vs. Git diff)
- Claude API interaction
- Output file generation

## Output

The tool generates a Markdown file at `docs/claude_review.md` containing:

- **Header**: "ðŸ§  Claude Review" with timestamp
- **Structured Feedback**: Claude's analysis covering:
  - Bugs or logic issues
  - Code clarity assessment
  - Suggested improvements
  - Style consistency recommendations

## Error Handling

- **Missing Files**: Warns and skips non-existent files
- **Git Errors**: Gracefully handles Git command failures
- **API Errors**: Catches and reports Claude API exceptions
- **No Diff Available**: Creates stub review when no changes detected

## Implementation Notes

### Code Review Focus Areas
The tool instructs Claude to focus on:
- **Bug Detection**: Logic errors and potential runtime issues
- **Code Clarity**: Readability and maintainability
- **Improvements**: Optimization and best practice suggestions
- **Style Consistency**: Adherence to coding standards

### File Organization
- Creates `docs/` directory automatically
- Overwrites previous reviews (consider versioning for production use)
- Uses consistent timestamp formatting

## Suggestions for Enhancement

### Security
- **API Key Management**: Consider using more secure credential storage for production
- **Input Validation**: Add validation for file paths and Git repository status

### Functionality
- **Configuration File**: Add support for custom review criteria
- **Multiple Output Formats**: Support for JSON, HTML, or other formats
- **Batch Processing**: Handle large repositories more efficiently
- **Integration**: Add hooks for CI/CD pipelines

### Error Handling
- **Retry Logic**: Implement retry mechanism for API failures
- **Logging**: Add comprehensive logging for debugging
- **Validation**: Verify Git repository state before processing

### Performance
- **File Size Limits**: Add checks for large files that might exceed API limits
- **Caching**: Cache results for unchanged files
- **Parallel Processing**: Process multiple files concurrently

## Example Usage Workflow

1. **Setup Environment**:
   ```bash
   pip install anthropic python-dotenv
   echo "ANTHROPIC_API_KEY=your_key" > .env
   ```

2. **Review Current Changes**:
   ```bash
   python claude_review.py
   ```

3. **Check Output**:
   ```bash
   cat docs/claude_review.md
   ```

This tool provides a solid foundation for automated code review integration and can be easily extended to meet specific project requirements.