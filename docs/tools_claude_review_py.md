<!-- Auto-generated by Claude on 2025-06-22 16:23 -->

# Claude Review Tool Documentation

## Overview

The Claude Review Tool is a Python script that leverages Anthropic's Claude AI to perform automated code reviews. It can operate in two modes: reviewing specific source files or analyzing Git diffs. The tool generates structured feedback in Markdown format, making it easy to integrate into development workflows.

## Purpose

- **Automated Code Review**: Get AI-powered feedback on code quality, bugs, and improvements
- **Git Integration**: Review changes in pull requests or commits automatically
- **Documentation Generation**: Output structured reviews in Markdown format for easy sharing and archiving

## Requirements

- Python 3.x
- Anthropic API key
- Git (for diff mode)
- Required packages: `anthropic`, `python-dotenv`

## Environment Setup

Create a `.env` file in your project root:

```env
ANTHROPIC_API_KEY=your_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, defaults to this model
```

## Usage

### Mode 1: File Review
Review specific files by passing them as arguments:

```bash
python claude_review.py file1.py file2.py file3.py
```

### Mode 2: Git Diff Review
Review Git changes by running without arguments:

```bash
python claude_review.py
```

## Key Functions

### `load_code(file_paths)`

Combines multiple source files into a single Markdown-formatted string for review.

**Parameters:**
- `file_paths` (list): List of file paths to process

**Returns:**
- `str`: Markdown-formatted string containing all file contents

**Features:**
- Handles missing files gracefully with warnings
- Formats code in proper Markdown code blocks
- Assumes Python syntax highlighting (hardcoded)

### `get_git_diff()`

Retrieves Git diff output with fallback strategies for different repository states.

**Returns:**
- `str`: Git diff content or empty string if unavailable

**Fallback Strategy:**
1. First attempts: `git diff origin/main...HEAD`
2. If failed, tries: `git diff HEAD^`
3. Returns empty string if both fail

## Output

The tool generates a Markdown file at `docs/claude_review.md` containing:

- **Header**: "🧠 Claude Review" with timestamp
- **Structured Feedback**: AI-generated review focusing on:
  - Bugs or logic issues
  - Code clarity and readability
  - Suggested improvements
  - Style consistency

## Review Focus Areas

The AI reviewer is prompted to analyze:

- **🐛 Bug Detection**: Logic errors and potential runtime issues
- **📖 Code Clarity**: Readability and maintainability concerns
- **✨ Improvements**: Optimization and best practice suggestions
- **🎨 Style Consistency**: Code formatting and naming conventions

## Error Handling

- **Missing Files**: Warns about inaccessible files but continues processing
- **Git Errors**: Gracefully handles repositories without proper Git history
- **API Errors**: Displays error messages and exits cleanly
- **No Diff Available**: Creates a stub review file when no changes are detected

## Notes and Suggestions

### ⚠️ Current Limitations

1. **Language Detection**: Code highlighting is hardcoded to Python
2. **Token Limits**: Maximum response limited to 1,500 tokens
3. **File Type Support**: Optimized for Python files but can handle any text files

### 💡 Improvement Suggestions

1. **Dynamic Language Detection**: 
   ```python
   # Add file extension mapping
   LANGUAGE_MAP = {'.py': 'python', '.js': 'javascript', '.java': 'java'}
   ```

2. **Configurable Token Limits**:
   ```python
   max_tokens = int(os.getenv("ANTHROPIC_MAX_TOKENS", "1500"))
   ```

3. **Custom Review Templates**: Allow different review focuses based on project type

4. **Integration Options**: Add support for GitHub Actions, GitLab CI, or other CI/CD systems

### 🔧 Usage Tips

- **Large Files**: Consider splitting large files or increasing token limits
- **Private Repositories**: Ensure your API key has appropriate permissions
- **Batch Processing**: For multiple reviews, consider rate limiting to avoid API throttling

## Integration Examples

### GitHub Actions
```yaml
- name: Run Claude Review
  run: |
    python claude_review.py
    cat docs/claude_review.md >> $GITHUB_STEP_SUMMARY
```

### Pre-commit Hook
```bash
#!/bin/bash
python claude_review.py $(git diff --cached --name-only --diff-filter=AM)
```