<!--
This documentation was auto-generated by Claude on 2025-05-31T16-12-40.
Source file: ./tools/claude_review.py
-->

# Claude Code Review Script

A Python script that leverages Anthropic's Claude AI to perform code reviews on individual files or Git diffs.

## Overview

This script provides automated code review functionality using Claude AI. It supports two modes of operation:
- **Manual File Review**: Review specific files by providing file paths as arguments
- **Git Diff Review**: Automatically review changes between Git revisions

## Features

- 🤖 AI-powered code review using Claude
- 📁 Review single or multiple files
- 🔄 Automatic Git diff analysis
- 📝 Markdown-formatted output
- 🛡️ Error handling and fallback mechanisms
- ⏰ Timestamped review files

## Requirements

### Dependencies

```
anthropic
python-dotenv
```

### Environment Variables

Create a `.env` file in the project root:

```env
ANTHROPIC_API_KEY=your_anthropic_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, defaults to claude-sonnet-4-20250514
```

## Installation

1. Install required packages:
   ```bash
   pip install anthropic python-dotenv
   ```

2. Set up your environment variables in a `.env` file

3. Ensure Git is installed and configured (for diff mode)

## Usage

### Mode 1: Manual File Review

Review specific files by providing their paths as command-line arguments:

```bash
python review_script.py file1.py file2.py
```

**Example:**
```bash
python review_script.py src/main.py utils/helpers.py
```

### Mode 2: Git Diff Review

Run without arguments to automatically review Git changes:

```bash
python review_script.py
```

The script will attempt to review changes in the following order:
1. `git diff origin/main...HEAD` - Changes between origin/main and current HEAD
2. `git diff HEAD^` - Changes in the last commit (fallback)

## Output

Reviews are saved as Markdown files in the `output/` directory with timestamps:

- **File reviews**: `claude_review_{filename}_{timestamp}.md`
- **Git diff reviews**: `claude_review_git_diff_{type}_{timestamp}.md`

### Sample Output Structure

The generated reviews focus on:
- 🐛 Bugs or logic issues
- 🔍 Code clarity and readability  
- 💡 Suggested improvements
- 🎨 Style consistency

## Error Handling

The script includes robust error handling:

- **Missing files**: Skips non-existent files with warnings
- **Git failures**: Falls back to previous commit diff
- **API errors**: Exits gracefully with error messages
- **No diff available**: Creates stub output to prevent CI failures

## File Structure

```
project/
├── review_script.py
├── .env
├── output/
│   └── claude_review_*.md
└── requirements.txt
```

## Configuration

### Model Selection

Change the Claude model by setting the `ANTHROPIC_MODEL` environment variable:

```env
ANTHROPIC_MODEL=claude-3-opus-20240229
```

### Output Directory

The script automatically creates an `output/` directory. To change this, modify the following line:

```python
os.makedirs("output", exist_ok=True)
```

## Exit Codes

- `0`: Success
- `1`: API error or other failure

## Limitations

- Requires valid Anthropic API key and sufficient credits
- Git diff mode requires a Git repository with commit history
- File content is limited by Claude's token limits (currently set to 1500 max tokens for responses)

## Version Information

- **Version**: 1.0.0
- **Author**: André Wolke
- **Date**: 2025-05-31

## Contributing

When modifying the script, ensure:
- Error handling remains robust
- Output format stays consistent
- Both review modes continue to work
- Environment variable handling is secure