<!--
This documentation was auto-generated by Claude on 2025-05-31T15-41-12.
Source file: ./tools/claude_folder_review_batched.py
-->

# Code Review Tool Documentation

## Overview

A Python script that performs automated code reviews using Anthropic's Claude AI model. The tool analyzes source code files in a specified directory, batching them to stay within token limits, and generates detailed review reports in Markdown format.

**Author:** Andr√© Wolke  
**Version:** 1.0.0  
**Date:** 2025-05-31

## Features

- **Automated Code Review**: Leverages Claude AI for intelligent code analysis
- **Batch Processing**: Automatically splits large codebases into manageable chunks
- **Multi-language Support**: Reviews various file types including Python, JavaScript, TypeScript, HTML, CSS, JSON, Go, Java, and YAML
- **Smart Filtering**: Excludes test files and irrelevant content
- **Structured Output**: Generates organized Markdown reports with timestamps

## Prerequisites

- Python 3.6+
- Required packages:
  - `anthropic`
  - `python-dotenv`
- Anthropic API key

## Installation

1. Install required dependencies:
```bash
pip install anthropic python-dotenv
```

2. Create a `.env` file in the project root:
```env
ANTHROPIC_API_KEY=your_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514
```

## Usage

### Basic Usage

```bash
python code_review.py [folder_path]
```

### Examples

```bash
# Review current directory's parent folder
python code_review.py

# Review specific folder
python code_review.py /path/to/your/codebase

# Review relative path
python code_review.py ../my-project
```

## Configuration

### Environment Variables

| Variable | Description | Default |
|----------|-------------|---------|
| `ANTHROPIC_API_KEY` | Your Anthropic API key | Required |
| `ANTHROPIC_MODEL` | Claude model to use | `claude-sonnet-4-20250514` |

### Supported File Types

The tool processes the following file extensions:
- **Python**: `.py`
- **JavaScript/TypeScript**: `.js`, `.ts`, `.tsx`, `.jsx`
- **Web**: `.html`, `.css`
- **Data**: `.json`, `.yaml`, `.yml`
- **Other Languages**: `.go`, `.java`

### File Exclusions

Files are automatically excluded if they:
- Contain "test" in the filename (case-insensitive)
- Start with "test_"
- Are located in directories containing "test"

## Output

### Directory Structure

```
output/
‚îî‚îÄ‚îÄ folder_review/
    ‚îú‚îÄ‚îÄ batch_01_2025-05-31T14-30-15.md
    ‚îú‚îÄ‚îÄ batch_02_2025-05-31T14-30-45.md
    ‚îî‚îÄ‚îÄ ...
```

### Review Content

Each batch report includes analysis of:
- **Code Organization**: Structure and file organization patterns
- **Bug Patterns**: Potential issues and vulnerabilities
- **Architecture Weaknesses**: Design flaws and improvement opportunities
- **Modularization Suggestions**: Recommendations for better code structure

## Technical Details

### Token Management

- **Maximum Tokens per Batch**: 10,000 tokens
- **Token Estimation**: Approximately 4 characters per token
- **Response Limit**: 2,000 tokens per Claude response

### Batching Algorithm

The script intelligently groups files into batches:

1. Reads each file and estimates token count
2. Groups files until approaching the 10k token limit
3. Creates new batch when limit would be exceeded
4. Processes each batch sequentially

### Error Handling

- **File Reading Errors**: Logged and skipped, processing continues
- **API Errors**: Reported per batch, other batches continue processing
- **Empty Directory**: Script exits with error message

## Example Output

```
üîç Found 23 valid source files in: ../my-project

üì¶ Processing batch 1 of 3...
‚úÖ Batch 1 saved to output/folder_review/batch_01_2025-05-31T14-30-15.md
üì¶ Processing batch 2 of 3...
‚úÖ Batch 2 saved to output/folder_review/batch_02_2025-05-31T14-30-45.md
üì¶ Processing batch 3 of 3...
‚úÖ Batch 3 saved to output/folder_review/batch_03_2025-05-31T14-31-12.md
üéâ All batches complete in 02:34
```

## API Usage and Costs

- Uses Anthropic's Claude API
- Token usage depends on codebase size
- Each batch consumes up to 10k input tokens + 2k output tokens
- Monitor your API usage through Anthropic's dashboard

## Limitations

- **Token Limits**: Large files may need manual splitting
- **Language Support**: Limited to predefined file extensions
- **API Dependencies**: Requires active internet connection and valid API key
- **Processing Time**: Large codebases may take several minutes

## Troubleshooting

### Common Issues

**No files found**
- Check folder path exists
- Verify files have supported extensions
- Ensure files aren't excluded by test filters

**API Authentication errors**
- Verify `ANTHROPIC_API_KEY` in `.env` file
- Check API key validity and permissions

**Token limit exceeded**
- Script automatically handles batching
- Very large individual files may cause issues

### Debug Information

The script provides real-time feedback:
- File discovery count
- Batch processing progress
- Error messages with file paths
- Total processing time

## Contributing

To extend functionality:

1. **Add File Types**: Modify `valid_exts` tuple
2. **Customize Exclusions**: Update `is_excluded()` function  
3. **Adjust Prompts**: Modify the Claude prompt for different review focus
4. **Change Batching**: Adjust `MAX_TOKENS` constant