<!--
This documentation was auto-generated by Claude on 2025-05-31T15-24-22.
Source file: ./tools/claude_review.py
-->

# Code Review Tool Documentation

## Overview

A Python script that provides automated code review capabilities using Anthropic's Claude AI. The tool supports two modes of operation: reviewing specific files or analyzing Git diffs to provide structured feedback on code changes.

## Features

- **Dual Review Modes**: Review individual files or Git diffs
- **AI-Powered Analysis**: Leverages Claude AI for comprehensive code review
- **Markdown Output**: Generates structured, readable review reports
- **Git Integration**: Automatically detects and reviews code changes
- **Error Handling**: Graceful fallback mechanisms for Git operations

## Prerequisites

- Python 3.6+
- Required packages:
  - `anthropic`
  - `python-dotenv`
- Git (for diff mode)
- Anthropic API key

## Installation

1. Install required dependencies:
```bash
pip install anthropic python-dotenv
```

2. Set up environment variables in a `.env` file:
```env
ANTHROPIC_API_KEY=your_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Optional, defaults to specified model
```

## Usage

### Mode 1: File Review

Review one or more specific files:

```bash
python review_tool.py file1.py file2.py
```

**Example:**
```bash
python review_tool.py src/main.py utils/helpers.py
```

### Mode 2: Git Diff Review

Review changes in your Git repository:

```bash
python review_tool.py
```

The tool will attempt to review changes using the following priority:
1. `git diff origin/main...HEAD` (changes against main branch)
2. `git diff HEAD^` (changes in the last commit)

## Output

Reviews are saved to the `output/` directory with timestamped filenames:

- **File reviews**: `claude_review_{filename1}_{filename2}_{timestamp}.md`
- **Git diff reviews**: `claude_review_git_diff_{source}_{timestamp}.md`
- **No diff available**: `claude_review_nodiff_{timestamp}.md`

## Review Focus Areas

The Claude AI reviewer analyzes code for:

- **Bugs and Logic Issues**: Potential runtime errors or logical flaws
- **Code Clarity**: Readability and maintainability concerns
- **Suggested Improvements**: Optimization and enhancement opportunities
- **Style Consistency**: Code formatting and naming conventions

## Configuration

### Environment Variables

| Variable | Description | Default |
|----------|-------------|---------|
| `ANTHROPIC_API_KEY` | Your Anthropic API key | Required |
| `ANTHROPIC_MODEL` | Claude model to use | `claude-sonnet-4-20250514` |

### API Parameters

- **Max Tokens**: 1500 (configurable in code)
- **Model**: Configurable via environment variable
- **Output Format**: Markdown

## Error Handling

The script includes comprehensive error handling:

- **Missing Files**: Skips non-existent files with warnings
- **Git Failures**: Falls back to alternative Git commands
- **API Errors**: Reports Claude API issues and exits gracefully
- **No Changes**: Creates stub output for CI/CD compatibility

## Directory Structure

```
project/
├── review_tool.py
├── .env
├── output/
│   ├── claude_review_main_py_2025-05-31T14-30-15.md
│   └── claude_review_git_diff_origin_main_2025-05-31T14-35-22.md
└── ...
```

## Exit Codes

- `0`: Success or graceful handling (no diff available)
- `1`: API error or critical failure

## Example Output

The tool generates structured Markdown reports like:

```markdown
# Code Review Report

## Summary
The code shows good structure but has several areas for improvement...

## Issues Found
### Bug: Potential null pointer exception
- **File**: src/main.py:45
- **Issue**: Variable may be undefined...

## Suggestions
1. Add input validation...
2. Consider using type hints...
```

## Version Information

- **Version**: 1.0.0
- **Author**: André Wolke
- **Date**: 2025-05-31

## Troubleshooting

### Common Issues

1. **API Key Error**: Ensure `ANTHROPIC_API_KEY` is set in `.env`
2. **Git Not Found**: Install Git or run in file mode
3. **Permission Errors**: Check write permissions for `output/` directory
4. **File Not Found**: Verify file paths are correct and accessible

### Debug Tips

- Check that the `.env` file is in the same directory as the script
- Verify Git repository is properly initialized
- Ensure sufficient API credits are available